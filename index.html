<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ценови листи за дистрибутори</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600&display=swap" rel="stylesheet">
  <style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',sans-serif}
  body{background:linear-gradient(135deg,#FFF,#F8F9FA);color:#1A1A1A;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:15px;line-height:1.6}
  .login-container{background:#FDFDFD;border:1px solid #E9ECEF;border-radius:16px;padding:30px;width:100%;max-width:400px;box-shadow:0 8px 24px rgba(0,0,0,.1);text-align:center;margin-top:20px}
  .top-bar{height:6px;background:linear-gradient(90deg,#D4AF37,#F4D03F,#D4AF37);border-radius:6px 6px 0 0;margin:-30px -30px 25px -30px}
  h1{background:linear-gradient(90deg,#1A1A1A,#4A4A4A);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:600;font-size:1.7rem;margin:15px 0}
  input{width:100%;padding:16px;margin:12px 0;border:1px solid #CED4DA;border-radius:10px;font-size:1.1rem}
  button{width:100%;padding:16px;background:linear-gradient(135deg,#D4AF37,#F4D03F);color:#1A1A1A;font-weight:600;border:none;border-radius:10px;font-size:1.2rem;cursor:pointer;margin-top:15px;transition:transform .2s}
  button:hover{transform:translateY(-2px)}
  .error{color:#E63946;margin-top:12px;font-size:.95rem;display:none}
  .content{width:100%;max-width:1350px;margin:30px auto;padding:20px 90px 20px 15px;display:flex;flex-direction:column;align-items:center;gap:45px;box-sizing:border-box}
  .main-title{text-align:center;font-size:2rem;margin:0 0 20px 0;background:linear-gradient(90deg,#1A1A1A,#4A4A4A);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:600}
    .dds{font-weight:600;color:#D4AF37;text-align:center;margin:0 0 40px 0;font-size:1.1rem}
    .accordion-list{display:flex;flex-direction:column;gap:30px;width:100%}
    .accordion{background:#FDFDFD;border:1px solid #E9ECEF;border-radius:12px;margin:0 auto;overflow:hidden;box-shadow:0 3px 8px rgba(0,0,0,.06);width:100%;max-width:1200px}
  .accordion-header{background:linear-gradient(135deg,#1A1A1A,#2C2C2C);color:white;padding:18px 20px;font-weight:600;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-size:1.35rem;transition:background .3s}
  .accordion-header:hover{background:linear-gradient(135deg,#2C2C2C,#3A3A3A)}
  .accordion-header::after{content:"−";font-size:1.4rem;font-weight:bold;margin-left:auto}
  .novo-badge{background:#E63946;color:white;padding:4px 12px;border-radius:4px;font-size:0.85rem;font-weight:600;margin-left:10px;text-transform:uppercase;flex-shrink:0}
  .product-banner{width:100%;max-width:900px;height:auto;border-radius:12px;margin:0 auto 25px;box-shadow:0 4px 12px rgba(0,0,0,.1);display:block}
  .dreveni-extras{align-items:center;text-align:center;display:flex;flex-direction:column;gap:10px;margin:15px 0}
  .dreveni-extras label{justify-content:center;display:flex;align-items:center;gap:10px;cursor:pointer;padding:8px 12px;border-radius:8px;transition:background .2s;width:100%;max-width:400px;margin:0 auto}
  .dreveni-extras label:hover{background:#F0F3F5}
  .dreveni-extras input[type="checkbox"],.dreveni-extras input[type="radio"]{width:18px;height:18px;cursor:pointer;accent-color:#D4AF37}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
  .accordion-content{padding:0 20px;max-height:0;overflow:hidden;transition:max-height .5s ease,padding .5s ease;background:#FDFDFD}
  .accordion-content.open{padding:30px 20px;max-height:8000px}
  .box-gallery{display:flex;flex-wrap:wrap;gap:25px;justify-content:center;margin:20px 0}
  .box-item{text-align:center;flex:1 1 160px;max-width:180px}
  .box-item img{width:160px;height:160px;object-fit:cover;border-radius:50%;box-shadow:0 6px 16px rgba(0,0,0,.15);transition:transform .3s}
  .box-item img:hover{transform:scale(1.05)}
  .box-item p{margin-top:12px;font-weight:600;font-size:.95rem;color:#1A1A1A}
  .table-container {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-x;  /* Добавено: По-добър touch скрол на мобилни */
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,.08);
    margin: 20px auto;
    width: 100%;
    /* Стилизиран скролбар за видимост */
    scrollbar-width: thin;
    scrollbar-color: #D4AF37 #f1f1f1;
  }
  .table-container::-webkit-scrollbar {
    height: 8px;  /* По-дебел скролбар на мобилни */
  }
  .table-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }
  .table-container::-webkit-scrollbar-thumb {
    background: #D4AF37;
    border-radius: 10px;
  }
  .table-container::-webkit-scrollbar-thumb:hover {
    background: #F4D03F;
  }

  table {
    width: 100%;
    min-width: 800px;  /* Увеличено: За да се скроли (адаптирайте според колони – ~40px на колона x 20 колони) */
    border-collapse: collapse;
    font-size: clamp(0.7rem, 2vw, 0.85rem) !important;
  }

  th {
    background: #1A1A1A;
    color: white;
    padding: 8px 6px !important;  /* Леко увеличен padding за четимост */
    text-align: center;
    font-size: clamp(0.75rem, 2vw, 0.9rem) !important;
    font-weight: 600;
    white-space: nowrap;
  }

  td {
    padding: 6px 6px !important;
    border-bottom: 1px solid #E9ECEF;
    text-align: center;
    font-size: clamp(0.65rem, 1.8vw, 0.8rem) !important;
    white-space: nowrap;  /* За цени като "21.07€" да не се прекъсват */
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  tr:nth-child(even) { background: #F8F9FA; }
  tr:hover { background: #F0F3F5; }

  th:nth-child(1), td:nth-child(1) { min-width: 60px !important; }
  th:nth-child(2), td:nth-child(2) { min-width: 40px !important; font-weight: 700; color: #D4AF37; }
  th:nth-child(3), td:nth-child(3) { min-width: 30px !important; }
  th:nth-child(4), td:nth-child(4) { min-width: 40px !important; }

  /* For coefficient tables (fewer columns) */
  th:nth-child(1), td:nth-child(1) { min-width: 80px !important; }
  th:nth-child(2), td:nth-child(2) { min-width: 60px !important; }
  th:nth-child(3), td:nth-child(3) { min-width: auto !important; white-space: normal; }
  .notes{background:#F8F9FA;border-left:5px solid #D4AF37;padding:18px;font-size:clamp(.85rem,2.5vw,.95rem);border-radius:0 10px 10px 0;margin:25px auto;line-height:1.8;text-align:center;max-width:900px}
  .examples-title{margin:30px 0 15px;font-size:1.2rem;color:#1A1A1A;text-align:center;font-weight:600}
  .examples-gallery{display:flex;overflow-x:auto;gap:20px;padding:20px 0;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;scrollbar-width:thin}
  .example-item{flex:0 0 auto;scroll-snap-align:center}
  .example-item img{max-width:400px;width:100%;height:300px;object-fit:cover;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.15);transition:transform .3s;cursor:pointer}
  .example-item img:hover{transform:scale(1.02)}
  .examples-gallery::-webkit-scrollbar{height:6px}
  .examples-gallery::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px}
  .examples-gallery::-webkit-scrollbar-thumb{background:#D4AF37;border-radius:10px}
  h3{margin:25px 0 12px;font-size:1.3rem;color:#1A1A1A;text-align:center;font-weight:600}
  .calculator{background:#F0F3F5;border:1px solid #E9ECEF;border-radius:12px;padding:20px;margin:20px 0;box-shadow:0 3px 8px rgba(0,0,0,.06);text-align:center}
  .calc-input{display:flex;flex-direction:column;gap:12px;max-width:320px;margin:0 auto}
  .calc-notes{width:100%;padding:10px 12px;border:1px solid #CED4DA;border-radius:8px;font-size:0.95rem;font-family:inherit;resize:vertical;min-height:44px}
  .calc-notes::placeholder{color:#888}
  .calc-notes-label{font-size:0.9rem;color:#555;text-align:left;margin-top:4px}
  .kornizi-notes-input{width:100%;min-width:120px;padding:6px 8px;border:1px solid #CED4DA;border-radius:6px;font-size:0.85rem}
  .kornizi-add-btn{min-width:36px;height:36px;padding:0;border:none;border-radius:8px;background:linear-gradient(135deg,#D4AF37,#F4D03F);color:#1A1A1A;font-weight:700;font-size:1.2rem;cursor:pointer;transition:transform .2s;display:inline-flex;align-items:center;justify-content:center}
  .kornizi-add-btn:hover{transform:scale(1.1)}
  .calc-checkboxes{display:flex;flex-direction:column;gap:10px;text-align:center;font-size:.95rem;color:#333;margin-top:15px;align-items:center;justify-content:center}
  .calc-checkboxes label{display:flex;align-items:center;justify-content:center;gap:10px;line-height:1.5;cursor:pointer;padding:8px 12px;border-radius:8px;transition:background .2s;width:100%;max-width:400px}
  .calc-checkboxes label:hover{background:#F0F3F5}
  .calc-checkboxes input[type="checkbox"],.calc-checkboxes input[type="radio"]{width:18px;height:18px;cursor:pointer;accent-color:#D4AF37}
  .calc-result{margin-top:15px;font-size:1.3rem;font-weight:700;color:#D4AF37;min-height:50px;word-wrap:break-word;white-space:normal;padding:12px;background:#fff;border:1px solid #E9ECEF;border-radius:10px}
  .history{margin-top:20px;text-align:center;font-size:.9rem;color:#555;max-width:320px;margin-left:auto;margin-right:auto;max-height:200px;overflow-y:auto;border:1px solid #E9ECEF;padding:12px;border-radius:10px;background:#fff}
  .history strong{display:block;text-align:center;margin-bottom:10px;font-size:1rem;color:#1A1A1A;font-weight:600}
  .history-item{padding:6px 0;border-bottom:1px dashed #E9ECEF;text-align:center}
  .pdf-button{width:100%;max-width:320px;margin:0 auto 15px auto;padding:14px;border-radius:10px;border:1px solid #D4AF37;background:#fff;color:#1A1A1A;font-weight:600;font-size:1.05rem;cursor:pointer;transition:background .2s,transform .2s;display:block}
  .pdf-button:hover{background:#FFF6D5;transform:translateY(-1px)}
  .download-button{width:100%;max-width:320px;margin:20px auto 25px auto;padding:14px 20px;border-radius:10px;border:none;background:#2196F3;color:#fff;font-weight:600;font-size:1.05rem;cursor:pointer;transition:background .2s,transform .2s,box-shadow .2s;display:block;box-shadow:0 2px 6px rgba(33,150,243,0.3)}
  .download-button:hover{background:#1976D2;transform:translateY(-2px);box-shadow:0 4px 12px rgba(33,150,243,0.4)}
  .cart-icon{position:fixed;top:20px;right:20px;width:60px;height:60px;background:linear-gradient(135deg,#D4AF37,#F4D03F);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.2);z-index:1000;transition:transform .2s}
  .cart-icon:hover{transform:scale(1.1)}
  .cart-icon svg{width:30px;height:30px;fill:#1A1A1A}
  .cart-badge{position:absolute;top:-5px;right:-5px;background:#E63946;color:white;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600}
  .cart-sidebar{position:fixed;top:0;right:-400px;width:400px;max-width:90vw;height:100vh;background:#FDFDFD;box-shadow:-2px 0 10px rgba(0,0,0,.1);z-index:1001;transition:right .3s;overflow-y:auto;display:flex;flex-direction:column}
  .cart-sidebar.open{right:0}
  .cart-header{background:linear-gradient(135deg,#1A1A1A,#2C2C2C);color:white;padding:20px;display:flex;justify-content:space-between;align-items:center}
  .cart-header h2{margin:0;font-size:1.5rem}
  .cart-close{background:none;border:none;color:white;font-size:28px;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center}
  .cart-content{flex:1;padding:20px;overflow-y:auto}
  .cart-item{background:#fff;border:1px solid #E9ECEF;border-radius:10px;padding:15px;margin-bottom:15px}
  .cart-item-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .cart-item-title{font-weight:600;color:#1A1A1A;font-size:1rem;flex:1;text-align:center}
  .cart-item-remove{background:none;border:none;color:#E63946;cursor:pointer;font-size:20px;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center}
  .cart-item-details{font-size:0.9rem;color:#666;margin-bottom:10px;text-align:center}
  .cart-item-price{font-weight:600;color:#D4AF37;font-size:1.1rem;text-align:center}
  .cart-footer{background:#F8F9FA;padding:20px;border-top:1px solid #E9ECEF}
  .cart-total{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;font-size:1.2rem;font-weight:600}
  .cart-total-label{color:#1A1A1A}
  .cart-total-amount{color:#D4AF37;font-size:1.5rem}
  .cart-actions{display:flex;gap:10px}
  .cart-button{flex:1;padding:14px;border-radius:10px;border:none;font-weight:600;font-size:1rem;cursor:pointer;transition:transform .2s}
  .cart-button-clear{background:#E9ECEF;color:#1A1A1A}
  .cart-button-checkout{background:linear-gradient(135deg,#D4AF37,#F4D03F);color:#1A1A1A}
  .cart-button:hover{transform:translateY(-2px)}
  .cart-empty{text-align:center;padding:40px 20px;color:#666}
  .cart-empty svg{width:80px;height:80px;fill:#E9ECEF;margin-bottom:20px}
  .add-to-cart-btn{width:100%;max-width:200px;padding:12px;background:linear-gradient(135deg,#D4AF37,#F4D03F);color:#1A1A1A;font-weight:600;border:none;border-radius:8px;cursor:pointer;margin:10px auto 0 auto;display:block;transition:transform .2s}
  .add-to-cart-btn:hover{transform:translateY(-2px)}
  .order-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:2000;align-items:center;justify-content:center}
  .order-modal.open{display:flex}
  .order-modal-content{background:#FDFDFD;border-radius:16px;padding:30px;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,.2);position:relative}
  .order-modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:2px solid #E9ECEF}
  .order-modal-header h2{margin:0;font-size:1.8rem;color:#1A1A1A}
  .order-modal-close{background:none;border:none;font-size:32px;cursor:pointer;color:#666;padding:0;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s}
  .order-modal-close:hover{background:#E9ECEF}
  .order-form-group{margin-bottom:20px}
  .order-form-group label{display:block;margin-bottom:8px;font-weight:600;color:#1A1A1A;font-size:1rem}
  .order-form-group input,.order-form-group textarea{width:100%;padding:14px;border:1px solid #CED4DA;border-radius:10px;font-size:1rem;font-family:'Roboto',sans-serif;box-sizing:border-box}
  .order-form-group input:focus,.order-form-group textarea:focus{outline:none;border-color:#D4AF37}
  .order-form-group textarea{min-height:120px;resize:vertical}
  .order-items-summary{background:#F8F9FA;border-radius:10px;padding:20px;margin-bottom:25px;max-height:300px;overflow-y:auto}
  .order-item-summary{margin-bottom:15px;padding-bottom:15px;border-bottom:1px solid #E9ECEF}
  .order-item-summary:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
  .order-item-summary-title{font-weight:600;color:#1A1A1A;margin-bottom:8px;text-align:center}
  .order-item-summary-details{font-size:.9rem;color:#666;margin-bottom:5px;line-height:1.5;text-align:center}
  .order-item-summary-price{font-weight:600;color:#D4AF37;font-size:1.1rem;text-align:center}
  .order-total{display:flex;justify-content:space-between;align-items:center;padding:15px;background:linear-gradient(135deg,#D4AF37,#F4D03F);border-radius:10px;margin-bottom:25px}
  .order-total-label{font-weight:600;color:#1A1A1A;font-size:1.2rem}
  .order-total-amount{font-weight:700;color:#1A1A1A;font-size:1.5rem}
  .order-submit-btn{width:100%;padding:16px;background:linear-gradient(135deg,#1A1A1A,#2C2C2C);color:white;font-weight:600;border:none;border-radius:10px;font-size:1.2rem;cursor:pointer;transition:transform .2s;margin-top:10px}
  .order-submit-btn:hover{transform:translateY(-2px)}
  .order-submit-btn:disabled{opacity:.6;cursor:not-allowed}
  .order-success{display:none;text-align:center;padding:40px 20px}
  .order-success.show{display:block}
  .order-success-icon{width:80px;height:80px;margin:0 auto 20px;background:#D4AF37;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:40px;color:white}
  .order-success h3{margin-bottom:10px;color:#1A1A1A;font-size:1.5rem}
  .order-success p{color:#666;font-size:1.1rem}
  .calc-input input,
  .calc-input select,
  .calc-input button {
    width: 100%;
    padding: 16px;
    margin: 0;
    border: 1px solid #CED4DA;
    border-radius: 10px;
    font-size: 1.1rem;
    box-sizing: border-box;
    font-family: 'Roboto', sans-serif;
  }
  .calc-input input:focus,
  .calc-input select:focus {
    outline: none;
    border-color: #D4AF37;
  }
  .lameli-visualization{background:#fff;border:2px solid #D4AF37;border-radius:12px;padding:20px;margin:20px 0;text-align:center}
  .lameli-info{margin-bottom:15px;font-size:1.1rem;font-weight:600;color:#1A1A1A}
  .lameli-container{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;align-items:flex-end;min-height:180px;padding:20px;background:#F8F9FA;border-radius:8px}
  .lamela-item{background:transparent;border:2px solid #CED4DA;border-radius:6px;width:26px;height:150px;flex-shrink:0;transition:border-color .2s,transform .2s;cursor:pointer;position:relative}
  .lamela-item:hover{transform:translateY(-2px);border-color:#D4AF37}
  .perde-color-picker{display:none;background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:10px;padding:12px 16px 12px 16px;margin:16px 0 0 0;margin-right:80px;text-align:center;max-width:calc(100% - 80px);width:100%;overflow:visible;box-shadow:0 4px 14px rgba(0,0,0,.04);box-sizing:border-box}
  .perde-color-title{font-weight:600;color:#1A1A1A;margin-bottom:6px;font-size:1rem}
  .perde-color-swatches{display:grid;grid-template-columns:repeat(auto-fill,minmax(46px,46px));grid-auto-rows:auto;gap:4px;justify-content:start;justify-items:center;align-items:center;width:100%;margin:0 auto;min-height:0;max-width:100%;padding:0 12px 0 0;box-sizing:border-box;overflow:visible}
  .perde-color-option{display:flex;align-items:center;justify-content:center;min-width:0;overflow:visible}
  .perde-color-swatch{width:46px;min-width:46px;height:20px;border-radius:3px;border:1px solid rgba(0,0,0,.15);cursor:pointer;transition:transform .2s,border-color .2s,box-shadow .2s;position:relative;display:flex;align-items:center;justify-content:center;font-size:.45rem;font-weight:600;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.8),0 -1px 1px rgba(0,0,0,.5);box-sizing:border-box;overflow:visible;flex-shrink:0}
  .perde-color-swatch[data-code="BR-01"],.perde-color-swatch[data-code="BR-02"],.perde-color-swatch[data-code="DT-01"],.perde-color-swatch[data-code="DT-02"],.perde-color-swatch[data-code="ND-01"],.perde-color-swatch[data-code="ND-02"],.perde-color-swatch[data-code="DJ-I-01"],.perde-color-swatch[data-code="DJ-I-02"],.perde-color-swatch[data-code="DJ-I-03"],.perde-color-swatch[data-code="DJ-E-01"],.perde-color-swatch[data-code="DJ-E-02"],.perde-color-swatch[data-code="DJ-E-03"],.perde-color-swatch[data-code="DJ-D-01"],.perde-color-swatch[data-code="DJ-D-02"],.perde-color-swatch[data-code="DJ-D-03"],.perde-color-swatch[data-code="SM-01"],.perde-color-swatch[data-code="SM-02"],.perde-color-swatch[data-code="SM-03"],.perde-color-swatch[data-code="SM-04"],.perde-color-swatch[data-code="SM-05"],.perde-color-swatch[data-code="SM-07"],.perde-color-swatch[data-code="SM-09"],.perde-color-swatch[data-code="SM-10"],.perde-color-swatch[data-code="SM-16"],.perde-color-swatch[data-code="SM-17"],.perde-color-swatch[data-code="SM-20"],.perde-color-swatch[data-code="SM-22"],.perde-color-swatch[data-code="SM-27"],.perde-color-swatch[data-code="SMF-01"],.perde-color-swatch[data-code="SMF-02"],.perde-color-swatch[data-code="SMF-03"],.perde-color-swatch[data-code="SMF-07"],.perde-color-swatch[data-code="SMF-08"],.perde-color-swatch[data-code="SMF-09"],.perde-color-swatch[data-code="SMF-10"],.perde-color-swatch[data-code="SMF-11"],.perde-color-swatch[data-code="SMF-12"],.perde-color-swatch[data-code="SMF-14"],.perde-color-swatch[data-code="SMF-16"],.perde-color-swatch[data-code="SMF-17"],.perde-color-swatch[data-code="JP-01"],.perde-color-swatch[data-code="JP-02"],.perde-color-swatch[data-code="MC-01"],.perde-color-swatch[data-code="MC-02"]{color:#1A1A1A;text-shadow:0 1px 2px rgba(255,255,255,.9),0 -1px 2px rgba(0,0,0,.3)}
  .perde-color-swatch.active{border-color:#D4AF37;box-shadow:0 0 0 2px rgba(212,175,55,.25);transform:translateY(-1px)}
  .perde-color-selected{margin-top:6px;font-size:.9rem;color:#666;text-align:center}
  .perde-color-actions{display:flex;justify-content:center;align-items:center;gap:12px;margin-top:10px}
  .perde-clear-btn{background:#E9ECEF;color:#1A1A1A;border:1px solid #CED4DA;border-radius:8px;padding:8px 16px;font-weight:600;font-size:.9rem;cursor:pointer;transition:background .2s,border-color .2s}
  .perde-clear-btn:hover{background:#DEE2E6;border-color:#ADB5BD}
  .perde-symmetry-toggle{display:flex;align-items:center;gap:8px;font-weight:600;color:#1A1A1A;background:#F8F9FA;border:2px solid #E5E5E5;border-radius:999px;padding:8px 18px;cursor:pointer;transition:border-color .2s}
  .perde-symmetry-toggle input{appearance:none;width:18px;height:18px;border-radius:50%;border:2px solid #CED4DA;display:inline-flex;align-items:center;justify-content:center;position:relative;background:#fff;transition:background .2s,border-color .2s}
  .perde-symmetry-toggle input:checked{background:#D4AF37;border-color:#D4AF37}
  .perde-symmetry-toggle input::after{content:"✓";width:100%;height:100%;border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;opacity:0;transition:opacity .2s}
  .perde-symmetry-toggle input:checked::after{opacity:1}
  .lamela-summary{margin-top:10px;font-weight:600;color:#1A1A1A;text-align:center}
  .calc-input button {
    background: linear-gradient(135deg, #D4AF37, #F4D03F);
    color: #1A1A1A;
    font-weight: 600;
    border: none;
    cursor: pointer;
    margin-top: 8px;
    transition: transform .2s;
  }
  .calc-input button:hover {
    transform: translateY(-2px);
  }
  .product-image{margin:30px auto;max-width:100%;text-align:center}
  .product-image img{max-width:100%;height:auto;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1);cursor:pointer}
  select {
    width: 100%;
    padding: 16px;
    margin: 12px 0;
    border: 1px solid #CED4DA;
    border-radius: 10px;
    font-size: 1.1rem;
    background-color: #fff;
    appearance: none;
    cursor: pointer;
  }
  select:focus {
    outline: none;
    border-color: #D4AF37;
  }
  @media(max-width:600px){
    .box-item img{width:130px;height:130px}
    .accordion-header{font-size:1.25rem;padding:16px}
    .main-title{font-size:1.8rem}
    .dds{font-size:1rem}
    .notes{font-size:.9rem;padding:16px}
    .examples-title{font-size:1.1rem}
    h3{font-size:1.2rem}
    .examples-gallery{gap:15px}
    /* Оптимизация за мобилни таблици */
    table { 
      min-width: 750px;  /* Намалено леко за по-добър скрол, но все още твърдо */
      font-size: 0.65rem !important;  /* По-малък шрифт за повече място */
    }
    th, td { 
      padding: 4px 3px !important;  /* По-тесни клетки */
      font-size: 0.6rem !important;  /* Още по-малък за цени */
      min-width: 35px !important;  /* Минимална ширина на колони */
    }
    .table-container {
      -webkit-overflow-scrolling: touch;
      touch-action: pan-x pan-y;  /* Поддръжка за вертикален + хоризонтален */
      scrollbar-width: auto;  /* По-дебел скролбар на Firefox Mobile */
    }
    .table-container::-webkit-scrollbar { height: 10px; }  /* По-дебел на iOS/Android */
  }
  .info-header {
    background: #FDFDFD;
    border: 1px solid #E9ECEF;
    border-radius: 16px;
    padding: 40px 30px;
    width: 100%;
    max-width: 600px;
    box-shadow: 0 8px 24px rgba(0,0,0,.1);
    text-align: center;
    margin: 20px auto;
    position: relative;
  }
  .info-header .top-bar {
    height: 6px;
    background: linear-gradient(90deg, #D4AF37, #F4D03F, #D4AF37);
    border-radius: 6px 6px 0 0;
    margin: -40px -30px 30px -30px;
  }
  .info-header img {
    max-width: 300px;
    height: auto;
    margin-bottom: 20px;
  }
  .info-header h2 {
    font-size: 1.5rem;
    margin: 20px 0 15px 0;
    font-weight: 600;
    background: linear-gradient(90deg, #1A1A1A, #4A4A4A);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }
  .info-header p {
    font-size: 1rem;
    line-height: 1.6;
    color: #1A1A1A;
    margin: 10px 0;
  }
  .info-header .close-info {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 28px;
    cursor: pointer;
    color: #1A1A1A;
    background: none;
    border: none;
    width: auto;
    padding: 0;
    transition: color 0.2s;
  }
  .info-header .close-info:hover {
    color: #E63946;
  }
  .info-header button.info-button {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #D4AF37, #F4D03F);
    color: #1A1A1A;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    font-size: 1.2rem;
    cursor: pointer;
    margin-top: 20px;
    transition: transform 0.2s;
  }
  .info-header button.info-button:hover {
    transform: translateY(-2px);
  }
</style>
</head>
<body>
  <div class="info-header" id="infoScreen" style="display:none;">
    <div class="top-bar"></div>
    <button class="close-info" onclick="closeInfo()">×</button>
    <img src="https://i.imgur.com/5moWMa3.png" alt="Modern Decor Logo">
    <h2>Информация</h2>
    <p>Актуални ценови листи за дистрибутори.</p>
    <p>Тук можете да намерите актуални цени за всички продукти.</p>
    <p>Всички цени са с включено ДДС.</p>
    <p style="margin-top: 20px; font-size: 1.1rem; font-weight: 600; color: #1A1A1A;">Ценова листа 2026</p>
    <button class="download-button" onclick="downloadInfoPageAsImage()" style="margin-top: 15px;">Download</button>
    <button class="info-button" onclick="closeInfo()">Продължи</button>
  </div>
  <div class="login-container" id="loginScreen">
    <div class="top-bar"></div>
    <h1>ДОСТЪП ЗА ДИСТРИБУТОРИ</h1>
    <input type="text" id="username" placeholder="Име" />
    <input type="password" id="password" placeholder="Парола" />
    <button onclick="login()">ВЛЕЗ</button>
    <p class="error" id="errorMsg">Грешно име или парола!</p>
  </div>
  <div class="content" id="priceList">
    <div class="top-bar" style="width:100%;max-width:1350px;margin:0 auto;"></div>
    <h1 class="main-title">ЦЕНОВИ ЛИСТИ ЗА ДИСТРИБУТОРИ</h1>
    <p class="dds">ВСИЧКИ ЦЕНИ СА С ВКЛЮЧЕНО ДДС</p>
    <button class="download-button" onclick="downloadAllPagesAsImages()" style="max-width:400px;margin-bottom:30px;">Download Всички Страници</button>
    <!-- Cart Icon -->
    <div class="cart-icon" onclick="toggleCart()">
      <svg viewBox="0 0 24 24">
        <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
      </svg>
      <span class="cart-badge" id="cartBadge" style="display:none;">0</span>
    </div>
    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
      <div class="cart-header">
        <h2>Кошница</h2>
        <button class="cart-close" onclick="toggleCart()">×</button>
      </div>
      <div class="cart-content" id="cartContent">
        <div class="cart-empty">
          <svg viewBox="0 0 24 24">
            <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
          </svg>
          <p>Кошницата е празна</p>
        </div>
      </div>
      <div class="cart-footer" id="cartFooter" style="display:none;">
        <div class="cart-total">
          <span class="cart-total-label">Общо:</span>
          <span class="cart-total-amount" id="cartTotal">0.00 €</span>
        </div>
        <div class="cart-actions">
          <button class="cart-button cart-button-clear" onclick="clearCart()">Изчисти</button>
          <button class="cart-button cart-button-checkout" onclick="checkout()">Поръчай</button>
        </div>
      </div>
    </div>
    <!-- Модална форма за поръчка -->
    <div class="order-modal" id="orderModal">
      <div class="order-modal-content">
        <div class="order-modal-header">
          <h2>Поръчка</h2>
          <button class="order-modal-close" onclick="closeOrderModal()">&times;</button>
        </div>
        <div id="orderFormContainer">
          <div class="order-items-summary" id="orderItemsSummary"></div>
          <form id="orderForm" onsubmit="submitOrder(event)">
            <div class="order-form-group">
              <label for="orderClientNumber">Клиентски номер *</label>
              <input type="text" id="orderClientNumber" name="clientNumber" required placeholder="Вашият клиентски номер">
            </div>
            <div class="order-form-group">
              <label for="orderAddress">Адрес за доставка</label>
              <textarea id="orderAddress" name="address" placeholder="Адрес за доставка (по избор)"></textarea>
            </div>
            <div class="order-form-group">
              <label for="orderNotes">Бележки</label>
              <textarea id="orderNotes" name="notes" placeholder="Допълнителни бележки или инструкции (по избор)"></textarea>
            </div>
            <div class="order-total">
              <span class="order-total-label">Общо:</span>
              <span class="order-total-amount" id="orderTotal">0.00 €</span>
            </div>
            <button type="submit" class="order-submit-btn" id="orderSubmitBtn">Изпрати поръчка</button>
          </form>
        </div>
        <div class="order-success" id="orderSuccess">
          <div class="order-success-icon">✓</div>
          <h3>Поръчката е изпратена успешно!</h3>
          <p>Ще се свържем с вас скоро за потвърждение.</p>
        </div>
      </div>
    </div>
    <div class="accordion-list">
    <!-- 1. РОЛО МИНИ -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Роло Мини</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Роло Мини</h3>
          <div class="calc-input">
            <input type="number" id="mini-width" placeholder="Ширина (см)" min="1">
            <input type="number" id="mini-height" placeholder="Височина (см)" min="1">
            <select id="mini-fabric" required>
              <option value="" disabled selected>Изберете плат... *</option>
              <option value="Yildiz">Yildiz</option>
              <option value="Panama">Panama</option>
              <option value="Panama Pearl*">Panama Pearl*</option>
              <option value="Yildiz Sedef">Yildiz Sedef</option>
              <option value="Line Harmony">Line Harmony</option>
              <option value="Mat Linen">Mat Linen</option>
              <option value="Yildiz Blackout">Yildiz Blackout</option>
              <option value="Yildiz Blackout Sedef">Yildiz Blackout Sedef</option>
              <option value="Focus Blackout">Focus Blackout</option>
              <option value="Focus Sedef Blackout">Focus Sedef Blackout</option>
              <option value="Monaco Blackout">Monaco Blackout</option>
              <option value="Lugano Blackout">Lugano Blackout</option>
              <option value="Pes Screen">Pes Screen</option>
              <option value="YS Screen">YS Screen</option>
              <option value="Glarus">Glarus</option>
              <option value="Uster">Uster</option>
              <option value="Lancy">Lancy</option>
              <option value="Basel Blackout">Basel Blackout</option>
              <option value="KS Screen">KS Screen</option>
              <option value="CS Screen">CS Screen</option>
              <option value="Blackout Screen">Blackout Screen</option>
            </select>
            <input type="text" id="mini-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <select id="mini-color" required>
              <option value="" disabled selected>Цвят на компонентите... *</option>
              <option value="white">Бял</option>
              <option value="brown">Кафяв</option>
            </select>
            <select id="mini-control" required>
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateMini()">Изчисли</button>
          </div>
          <div class="calc-result" id="mini-result">—</div>
          <button class="add-to-cart-btn" onclick="addMiniToCart()" id="mini-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="mini-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('rolo-mini-content', 'Роло Мини')">Download</button>
        <div id="rolo-mini-content">
          <h3>Цени за Роло Мини </h3>
          <div class="table-container"><table id="rolo-mini-table"></table></div>
<h3>Коефициенти за платове - Роло Мини</h3>
<div class="table-container">
  <table>
    <tr><th>Група</th><th>Коефициент</th><th>Платове</th></tr>
    <tr><td>1</td><td>1.0</td><td>Yildiz</td></tr>
    <tr><td>2</td><td>1.2</td><td>Panama, Panama Pearl*, Yildiz Sedef, Line Harmony, Mat Linen</td></tr>
    <tr><td>3</td><td>1.4</td><td>Yildiz Blackout, Yildiz Blackout Sedef, Focus Blackout, Focus Sedef Blackout, Monaco Blackout, Lugano Blackout, Pes Screen, YS Screen, Glarus, Uster, Lancy</td></tr>
    <tr><td>4</td><td>1.5</td><td>Basel Blackout, KS Screen, CS Screen</td></tr>
    <tr><td>5</td><td>1.6</td><td>Blackout Screen</td></tr>
  </table>
</div>
<div class="notes">
          * Странично водене с PVC планка и корда – 2,13 €/бр<br>
          * Размер на крайните тапи: напред 4 см × височина 3,6 см<br>
          * Максимална височина, на която се събират платовете: 220 см<br><br>
          <strong>Как да премерим правилно?</strong><br>
          1. <strong>Ширина</strong> – премерете разстоянието от външната страна на левия до десния стъклодържач. Необходимо е да застъпите върху стъклодържачите поне по 1 см, за да няма просвет на светлина. Тази измерена ширина е размера на плата Ви!<br>
          <strong>Габаритната ширина на щората е с 3,5 см по-широка от размера на плата!</strong><br>
          2. <strong>Височина</strong> – премерете разстоянието от външната страна на долния до горния стъклодържач. Необходимо е да застъпите върху стъклодържачите поне по 2 см, за да няма просвет на светлина.<br>
          3. За управление на щората погледнато от помещението определете дали да бъде ляво или дясно.<br><br>
          <strong>Измерените по този начин щори се подават като размер на плат на щората.</strong><br>
          Ако се подават габаритни размери на щората, е необходимо да добавите по 3,5 см спрямо взетите размер на плат.<br><br>
          <strong>ВНИМАНИЕ:</strong> При щори Роло Мини е възможно щората да опира на страничния зид на прозореца!<br><br>
          * Под 50 см → закръгля се на 50 см | Над 230 см → не се поддържа
<div class="examples-gallery">
          <div class="example-item"><img src="https://i.imgur.com/UXHacDZ.jpg" alt="Роло щора – монтаж 1"></div>
          <div class="example-item"><img src="https://i.imgur.com/iqcXeX5.jpg" alt="Роло щора – монтаж 2"></div>
          <div class="example-item"><img src="https://i.imgur.com/0UdC9DX.jpg" alt="Роло щора – монтаж 3"></div>
        </div>
        </div>
       
 </div>
      </div>
    </div>
    <!-- 2. ДЕН И НОЩ МИНИ -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Ден и Нощ Мини</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Ден и Нощ Мини</h3>
          <div class="calc-input">
            <input type="number" id="dn-width" placeholder="Ширина (см)" min="1">
            <input type="number" id="dn-height" placeholder="Височина (см)" min="1">
            <select id="dn-fabric" required>
              <option value="" disabled selected>Изберете плат... *</option>
              <option value="Eco Series">Eco Series</option>
              <option value="Modern Decor">Modern Decor</option>
              <option value="Charm GE">Charm GE</option>
              <option value="Charm GK">Charm GK</option>
              <option value="Charm AS">Charm AS</option>
              <option value="St.Galen">St.Galen</option>
              <option value="Montaro">Montaro</option>
              <option value="Urban">Urban</option>
              <option value="Rare">Rare</option>
              <option value="Keten">Keten</option>
              <option value="Craft">Craft</option>
              <option value="Raw">Raw</option>
              <option value="Naturel">Naturel</option>
              <option value="Tiffany">Tiffany</option>
              <option value="Piritli">Piritli</option>
              <option value="Bamboo Curtain">Bamboo Curtain</option>
              <option value="New Wave Versa">New Wave Versa</option>
              <option value="Best">Best</option>
              <option value="Arbon">Arbon</option>
              <option value="Kugel">Kugel</option>
              <option value="Passion">Passion</option>
              <option value="Imagine">Imagine</option>
              <option value="Eden">Eden</option>
              <option value="Pearl">Pearl</option>
              <option value="Smart">Smart</option>
              <option value="Baskili Zebra TD">Baskili Zebra TD</option>
              <option value="Baskili Zebra PLS">Baskili Zebra PLS</option>
              <option value="Blackout">Blackout</option>
              <option value="Keten Baskili">Keten Baskili</option>
              <option value="Peimo">Peimo</option>
              <option value="Nordem">Nordem</option>
              <option value="Biel Blackout">Biel Blackout</option>
              <option value="Bonn Blackout">Bonn Blackout</option>
            </select>
            <input type="text" id="dn-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <select id="dn-color" required>
              <option value="" disabled selected>Цвят на компонентите... *</option>
              <option value="white">Бял</option>
              <option value="brown">Кафяв</option>
            </select>
            <select id="dn-control" required>
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateDN()">Изчисли</button>
          </div>
          <div class="calc-result" id="dn-result">—</div>
          <button class="add-to-cart-btn" onclick="addDnMiniToCart()" id="dn-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="dn-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('dn-mini-content', 'Ден и Нощ Мини')">Download</button>
        <div id="dn-mini-content">
          <h3>Цени за Ден и Нощ Мини</h3>
          <div class="table-container"><table id="dn-mini-table"></table></div>
<h3>Коефициенти за платове - Ден и Нощ Мини</h3>
<div class="table-container">
  <table>
    <tr><th>Група</th><th>Коефициент</th><th>Платове</th></tr>
    <tr><td>1</td><td>1.0</td><td>Eco Series, Modern Decor</td></tr>
    <tr><td>2</td><td>1.2</td><td>Charm GE, GK, AS</td></tr>
    <tr><td>3</td><td>1.3</td><td>St.Galen, Montaro, Urban, Rare, Keten, Craft, Raw, Naturel, Tiffany, Piritli, Bamboo Curtain, New Wave Versa, Best, Arbon, Kugel</td></tr>
    <tr><td>4</td><td>1.4</td><td>Passion, Imagine, Eden, Pearl, Smart, Passion</td></tr>
    <tr><td>5</td><td>1.6</td><td>Baskili Zebra TD, Baskili Zebra PLS</td></tr>
    <tr><td>6</td><td>1.65</td><td>Blackout, Keten Baskili, Pelmo, Nordern</td></tr>
    <tr><td>7</td><td>1.75</td><td>Biel Blackout, Bonn Blackout</td></tr>
  </table>
</div>
        <div class="notes">
          * Странично водене с PVC планка и корда – 2,13 €/бр<br>
          * Размер на крайните тапи: напред 4 см × височина 3,6 см<br>
          * Максимална височина, на която се събират платовете: 220 см<br><br>
          <strong>Как да премерим правилно?</strong><br>
          1. <strong>Ширина</strong> – премерете разстоянието от външната страна на левия до десния стъклодържач. Необходимо е да застъпите върху стъклодържачите поне по 1 см, за да няма просвет на светлина. Тази измерена ширина е размера на плата Ви!<br>
          <strong>Габаритната ширина на щората е с 3,5 см по-широка от размера на плата!</strong><br>
          2. <strong>Височина</strong> – премерете разстоянието от външната страна на долния до горния стъклодържач. Необходимо е да застъпите върху стъклодържачите поне по 2 см, за да няма просвет на светлина.<br>
          3. За управление на щората погледнато от помещението определете дали да бъде ляво или дясно.<br><br>
          <strong>Измерените по този начин щори се подават като размер на плат на щората.</strong><br>
          Ако се подават габаритни размери на щората, е необходимо да добавите по 3,5 см спрямо взетите размер на плат.<br><br>
          <strong>ВНИМАНИЕ:</strong> При щори Роло Мини е възможно щората да опира на страничния зид на прозореца!<br><br>
          * Под 50 см → закръгля се на 50 см | Над 230 см → не се поддържа
                * Под 50 см → закръгля се на 50 см | Над 230 см → не се поддържа
<div class="examples-gallery">
          <div class="example-item"><img src="https://i.imgur.com/V91HBPD.jpg" alt="Роло щора – монтаж 1"></div>
        
          <div class="example-item"><img src="https://i.imgur.com/0UdC9DX.jpg" alt="Роло щора – монтаж 3"></div>
        </div>
        </div>
  
</div>
      </div>
    </div>
    <!-- 3. Роло Елеганс 29mm -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Роло Елеганс 29mm</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Роло Елеганс 29mm</h3>
          <div class="calc-input">
            <input type="number" id="elegans-width" placeholder="Ширина (см)" min="1">
            <input type="number" id="elegans-height" placeholder="Височина (см)" min="1">
            <select id="elegans-fabric" required>
              <option value="" disabled selected>Изберете плат... *</option>
              <option value="Yildiz">Yildiz</option>
              <option value="Yildiz Sedef">Yildiz Sedef</option>
              <option value="Panama">Panama</option>
              <option value="Panama Pearl">Panama Pearl</option>
              <option value="Line Harmony">Line Harmony</option>
              <option value="Mat Linen">Mat Linen</option>
              <option value="Yildiz Blackout">Yildiz Blackout</option>
              <option value="Yildiz Blackout Sedef">Yildiz Blackout Sedef</option>
              <option value="Focus Blackout">Focus Blackout</option>
              <option value="Focus Sedef Blackout">Focus Sedef Blackout</option>
              <option value="Monaco Blackout">Monaco Blackout</option>
              <option value="Lugano Blackout">Lugano Blackout</option>
              <option value="Pes Screen">Pes Screen</option>
              <option value="YS Screen">YS Screen</option>
              <option value="Glarus">Glarus</option>
              <option value="Uster">Uster</option>
              <option value="Lancy">Lancy</option>
              <option value="Basel Blackout">Basel Blackout</option>
              <option value="KS Screen">KS Screen</option>
              <option value="CS Screen">CS Screen</option>
              <option value="Blackout Screen">Blackout Screen</option>
            </select>
            <input type="text" id="elegans-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <select id="elegans-color" required>
              <option value="" disabled selected>Цвят на компонентите... *</option>
              <option value="white">Бял</option>
              <option value="brown">Кафяв</option>
              <option value="anthracite">Антрацит</option>
              <option value="golden_oak">Златен дъб</option>
              <option value="walnut">Орех</option>
            </select>
            <select id="elegans-control" required>
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateElegans()">Изчисли</button>
          </div>
          <div class="calc-result" id="elegans-result">—</div>
          <button class="add-to-cart-btn" onclick="addElegansToCart()" id="elegans-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="elegans-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('elegans-content', 'Роло Елеганс 29mm')">Download</button>
        <div id="elegans-content">
          <h3>Цени за Роло Елеганс 29mm</h3>
          <div class="table-container"><table id="elegans-table"></table></div>
<h3>Коефициенти за платове - Роло Елеганс 29mm</h3>
<div class="table-container">
  <table>
    <tr><th>Група</th><th>Плат</th><th>Бял</th><th>Кафяв</th><th>Антрацит</th><th>Златен дъб</th><th>Орех</th></tr>
    <tr><td>1</td><td>Yildiz</td><td>1</td><td>1.05</td><td>1.05</td><td>1.3</td><td>1.3</td></tr>
    <tr><td>2</td><td>Yildiz Sedef, Panama, Panama Pearl, Line Harmony, Mat Linen</td><td>1.1</td><td>1.15</td><td>1.15</td><td>1.4</td><td>1.4</td></tr>
    <tr><td>3</td><td>Yildiz Blackout, Yildiz Blackout Sedef, Focus Blackout, Focus Sedef Blackout, Monaco Blackout, Lugano Blackout, Pes Screen, YS Screen, Glarus, Uster, Lancy</td><td>1.3</td><td>1.35</td><td>1.35</td><td>1.6</td><td>1.6</td></tr>
    <tr><td>4</td><td>Basel Blackout, KS Screen, CS Screen</td><td>1.4</td><td>1.45</td><td>1.45</td><td>1.7</td><td>1.7</td></tr>
    <tr><td>5</td><td>Blackout Screen</td><td>1.5</td><td>1.55</td><td>1.55</td><td>1.8</td><td>1.8</td></tr>
  </table>
</div>
        <h3>Кутии и механизми</h3>
        <div class="box-gallery">
          <div class="box-item"><img src="https://i.imgur.com/DBgYRg6.jpg" alt="Бял"><p>Бял</p></div>
          <div class="box-item"><img src="https://i.imgur.com/SQD4m0s.jpg" alt="Кафяв"><p>Кафяв</p></div>
          <div class="box-item"><img src="https://i.imgur.com/gw8QVzk.jpg" alt="Антрацит"><p>Антрацит</p></div>
          <div class="box-item"><img src="https://i.imgur.com/e1uJECk.jpg" alt="Златен дъб"><p>Златен дъб</p></div>
          <div class="box-item"><img src="https://i.imgur.com/9XtFYZ8.jpg" alt="Орех"><p>Орех</p></div>
        </div>        <h3>Максимална височина за събиране на платове в кутията</h3>
        <div class="table-container">
          <table>
  <tr>
    <th>Платове</th>
    <th>Елеганс 29mm</th>
    <th>Елеганс + 45mm</th>
  </tr>
  <tr>
    <td>Focus Blackout, Focus Sef Blackout, Monaco Blackout, Basel Blackout, Blackout Screen</td>
    <td>135 см</td>
    <td>185 см</td>
  </tr>
  <tr>
    <td>Panama, Panama Pearl, Yildiz Blackout, Yildiz Blackout Sef, Lugano Pearl, Yildiz Sun Blackout, YS Blackout Sef, Lugano Blackout, Sun Screen, YS Screen</td>
    <td>140 см</td>
    <td>190 см</td>
  </tr>
  <tr>
    <td>Pes Screen</td>
    <td>200 см</td>
    <td>250 см</td>
  </tr>
  <tr>
    <td>Mat Linen</td>
    <td>220 см</td>
    <td>270 см</td>
  </tr>
  <tr>
    <td>Yildiz, Yildiz Sef, Line Harmony</td>
    <td>230 см</td>
    <td>280 см</td>
  </tr>
</table>        </div>
        <div class="notes">
          Възможно е да се монтира на стъклото или в касетата с монтажни профили.<br><br>
          Как да премерим правилно?<br>
          1. Ширина - премерите разстоянието от вътрешната страна на левия до десния стъклодържач и намалете с 1 см. Това е ширината на плата за съответната щора за да може да се движи свободно между стъклодържачите *габаритната ширина на касетата със стикерните конзоли е с 5cm по-широка от размера на плата<br>
          2. Височина - премерите разстоянието от вътрешната страна на долния до горния стъклодържач и увеличете с 1.5cm (за да може да се застъпи върху горния стъклодържач със самата щора в монтажно положение<br>
          3. За управление на щора погледнато от помещението определете дали да бъде ляво или дясно<br>
          4.Уверете се дълбочината на стъклодържача да бъде поне 1.5CM<br><br>
          Измерените по този начин щори се подават като размер на плат на щората.Ако се подават габаритни размери на щората, забинете трябва да се извади от ширината на поръчката<br>
          При подаване на габаритен размер единствената разлика е в ширината на поръчката!<br>
          Та е с 5cm разлика повече в ширина спрямо размера на плата!<br>
          Щора "Ден и Нощ" Елеганс е възможно да опира на стъклото при пускане на плат!
        <div class="examples-gallery">
          <div class="example-item"><img src="https://i.imgur.com/n1NbL7S.jpg" alt="Роло щора – монтаж 1"></div>
                  </div>

</div>
</div>
      </div>
    </div>
    <!-- 4.Ден и Нощ Елеганс 29mm -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Ден и Нощ Елеганс 29mm</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Ден и Нощ Елеганс 29mm</h3>
          <div class="calc-input">
            <input type="number" id="dn-elegans-width" placeholder="Ширина (см)" min="1">
            <input type="number" id="dn-elegans-height" placeholder="Височина (см)" min="1">
            <select id="dn-elegans-fabric" required>
              <option value="" disabled selected>Изберете плат... *</option>
              <option value="Eco Series">Eco Series</option>
              <option value="Modern Décor">Modern Décor</option>
              <option value="Charm GE">Charm GE</option>
              <option value="Charm GK">Charm GK</option>
              <option value="Charm AS">Charm AS</option>
              <option value="St.Galen">St.Galen</option>
              <option value="Montana">Montana</option>
              <option value="Urban">Urban</option>
              <option value="Rare">Rare</option>
              <option value="Keten">Keten</option>
              <option value="Craft">Craft</option>
              <option value="Raw">Raw</option>
              <option value="Nature">Nature</option>
              <option value="Tiffany">Tiffany</option>
              <option value="Piriti">Piriti</option>
              <option value="Bamboo Curtain">Bamboo Curtain</option>
              <option value="New Wave">New Wave</option>
              <option value="Versa">Versa</option>
              <option value="Best">Best</option>
              <option value="Arbon">Arbon</option>
              <option value="Passion">Passion</option>
              <option value="Imagine">Imagine</option>
              <option value="Eden">Eden</option>
              <option value="Pearl">Pearl</option>
              <option value="Smart">Smart</option>
              <option value="Baskili Zebra TD">Baskili Zebra TD</option>
              <option value="Baskili Zebra PL5">Baskili Zebra PL5</option>
              <option value="Blackout">Blackout</option>
              <option value="Keten Baskili">Keten Baskili</option>
              <option value="Pelmo">Pelmo</option>
              <option value="Nordern">Nordern</option>
              <option value="Biel Blackout">Biel Blackout</option>
              <option value="Bonn Blackout">Bonn Blackout</option>
            </select>
            <input type="text" id="dn-elegans-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <select id="dn-elegans-color" required>
              <option value="" disabled selected>Цвят на компонентите... *</option>
              <option value="white">Бял</option>
              <option value="brown">Кафяв</option>
              <option value="anthracite">Антрацит</option>
              <option value="golden_oak">Златен дъб</option>
              <option value="walnut">Орех</option>
            </select>
            <select id="dn-elegans-control" required>
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateDNElegans()">Изчисли</button>
          </div>
          <div class="calc-result" id="dn-elegans-result">—</div>
          <button class="add-to-cart-btn" onclick="addDnElegansToCart()" id="dn-elegans-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="dn-elegans-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('dn-elegans-content', 'Ден и Нощ Елеганс 29mm')">Download</button>
        <div id="dn-elegans-content">
          <h3>Цени за Ден и Нощ Елеганс 29mm</h3>
          <div class="table-container"><table id="dn-elegans-table"></table></div>
<h3>Коефициенти за платове -Ден и Нощ Елеганс 29mm</h3>
<div class="table-container">
  <table>
    <tr><th>Група</th><th>Плат</th><th>Бял</th><th>Кафяв</th><th>Антрацит</th><th>Златен дъб</th><th>Орех</th></tr>
    <tr><td>1</td><td>Eco Series, Modern Décor</td><td>1</td><td>1.05</td><td>1.05</td><td>1.3</td><td>1.3</td></tr>
    <tr><td>2</td><td>Charm GE,GK,AS</td><td>1.1</td><td>1.15</td><td>1.15</td><td>1.4</td><td>1.4</td></tr>
    <tr><td>3</td><td>St.Galen, Montana, Urban, Rare, Keten Craft, Raw, Nature, Tiffany, Piriti, Bamboo Curtain, New Wave, Versa, Best, Arbon</td><td>1.2</td><td>1.25</td><td>1.25</td><td>1.5</td><td>1.5</td></tr>
    <tr><td>4</td><td>Passion, Imagine, Eden, Pearl, Smart, Passion</td><td>1.3</td><td>1.35</td><td>1.35</td><td>1.6</td><td>1.6</td></tr>
    <tr><td>5</td><td>Baskili Zebra TD, Baskili Zebra PL5</td><td>1.4</td><td>1.45</td><td>1.45</td><td>1.7</td><td>1.7</td></tr>
    <tr><td>6</td><td>Blackout, Keten Baskili, Pelmo, Nordern</td><td>1.5</td><td>1.55</td><td>1.55</td><td>1.8</td><td>1.8</td></tr>
    <tr><td>7</td><td>Biel Blackout, Bonn Blackout</td><td>1.6</td><td>1.65</td><td>1.65</td><td>1.9</td><td>1.9</td></tr>
  </table>
</div>
        <h3>Кутии и механизми</h3>
        <div class="box-gallery">
          <div class="box-gallery">
          <div class="box-item"><img src="https://i.imgur.com/DBgYRg6.jpg" alt="Бял"><p>Бял</p></div>
          <div class="box-item"><img src="https://i.imgur.com/SQD4m0s.jpg" alt="Кафяв"><p>Кафяв</p></div>
          <div class="box-item"><img src="https://i.imgur.com/gw8QVzk.jpg" alt="Антрацит"><p>Антрацит</p></div>
          <div class="box-item"><img src="https://i.imgur.com/e1uJECk.jpg" alt="Златен дъб"><p>Златен дъб</p></div>
          <div class="box-item"><img src="https://i.imgur.com/9XtFYZ8.jpg" alt="Орех"><p>Орех</p></div>
        </div>
        <h3>Максимална височина за събиране на платове в кутията</h3>
        <div class="table-container">
          <table>
            <tr><th>Платове</th><th>Елеганс 29mm</th><th>Елеганс+ 45mm</th></tr>
            <tr><td>St.Galen, Pirilti, Pearl, Smart</td><td>75 см</td><td>150 см</td></tr>
            <tr><td>Nordern, Arbon, Kugel, Urban, Rare, Keten Craft, Raw, Natural, Tiffany, Montaro</td><td>80 см</td><td>170 см</td></tr>
            <tr><td>Bonn Blackout, Biel Blackout, Keten Baskili PLS, Imagine, Versa, Passion, Eden, Bamboo Curtain, Blackout, Best</td><td>90 см</td><td>180 см</td></tr>
            <tr><td>Charm, Pelmo, New Wave</td><td>110 см</td><td>190 см</td></tr>
            <tr><td>Eco Series, Modern Décor, Baskili TD, Baskili PLS, Baskili Duz</td><td>165 см</td><td>220 см</td></tr>
          </table>
        </div>
        <div class="notes">
          Система, Модел на плата Възможно е да се монтира на стъклото или в касетата с монтажни профили.<br><br>
          Как да премерим правилно?<br>
          1. Ширина - премерите разстоянието от вътрешната страна на левия до десния стъклодържач и намалете с 1 см. Това е ширината на плата за съответната щора за да може да се движи свободно между стъклодържачите *габаритната ширина на касетата със стикерните конзоли е с 5cm по-широка от размера на плата<br>
          2. Височина - премерите разстоянието от вътрешната страна на долния до горния стъклодържач и увеличете с 1.5cm (за да може да се застъпи върху горния стъклодържач със самата щора в монтажно положение<br>
          3. За управление на щора погледнато от помещението определете дали да бъде ляво или дясно<br>
          4.Уверете се дълбочината на стъклодържача да бъде поне 1.5CM<br><br>
          Измерените по този начин щори се подават като размер на плат на щората.Ако се подават габаритни размери на щората, забинете трябва да се извади от ширината на поръчката<br>
          При подаване на габаритен размер единствената разлика е в ширината на поръчката!<br>
          Та е с 5cm разлика повече в ширина спрямо размера на плата!<br>
          Щора "Ден и Нощ" Елеганс е възможно да опира на стъклото при пускане на плат!
<div class="examples-gallery">      
<div class="example-item"><img src="https://i.imgur.com/iadgQL6.jpg" alt="Роло щора – монтаж 1"></div>
                  </div>  
</div>
</div>
      </div>
    </div>
    <!-- 5. Роло Елеганс+ (45мм кутия) -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)"> Роло Елеганс+ (45мм кутия)</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Роло Елеганс+ (45мм кутия)</h3>
          <div class="calc-input">
            <input type="number" id="rolo-plus-width" placeholder="Ширина (см)" min="1">
            <input type="number" id="rolo-plus-height" placeholder="Височина (см)" min="1">
            <select id="rolo-plus-fabric" required>
              <option value="" disabled selected>Изберете плат... *</option>
              <option value="Yildiz">Yildiz</option>
              <option value="Yildiz Sedef">Yildiz Sedef</option>
              <option value="Panama">Panama</option>
              <option value="Panama Pearl">Panama Pearl</option>
              <option value="Line Harmony">Line Harmony</option>
              <option value="Mat Linen">Mat Linen</option>
              <option value="Yildiz Blackout">Yildiz Blackout</option>
              <option value="Yildiz Blackout Sedef">Yildiz Blackout Sedef</option>
              <option value="Focus Blackout">Focus Blackout</option>
              <option value="Focus Sedef Blackout">Focus Sedef Blackout</option>
              <option value="Monaco Blackout">Monaco Blackout</option>
              <option value="Lugano Blackout">Lugano Blackout</option>
              <option value="Pes Screen">Pes Screen</option>
              <option value="YS Screen">YS Screen</option>
              <option value="Glarus">Glarus</option>
              <option value="Uster">Uster</option>
              <option value="Lancy">Lancy</option>
              <option value="Basel Blackout">Basel Blackout</option>
              <option value="KS Screen">KS Screen</option>
              <option value="CS Screen">CS Screen</option>
              <option value="Blackout Screen">Blackout Screen</option>
            </select>
            <input type="text" id="rolo-plus-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <select id="rolo-plus-color" required>
              <option value="" disabled selected>Цвят на компонентите... *</option>
              <option value="white">Бял</option>
              <option value="brown">Кафяв</option>
              <option value="anthracite">Антрацит</option>
              <option value="golden_oak">Златен дъб</option>
              <option value="walnut">Орех</option>
            </select>
            <select id="rolo-plus-control" required>
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateRoloPlus()">Изчисли</button>
          </div>
          <div class="calc-result" id="rolo-plus-result">—</div>
          <button class="add-to-cart-btn" onclick="addRoloPlusToCart()" id="rolo-plus-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="rolo-plus-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('rolo-plus-content', 'Роло Елеганс+ (45мм кутия)')">Download</button>
        <div id="rolo-plus-content">
          <h3>Цени за Роло Елеганс+ (45мм кутия)</h3>
          <div class="table-container"><table id="rolo-plus-table"></table></div>
<h3>Коефициенти за платове - Роло Елеганс+ (45мм кутия)</h3>
<div class="table-container">
  <table>
    <tr><th>Група</th><th>Плат</th><th>Бял</th><th>Кафяв</th><th>Антрацит</th><th>Златен дъб</th><th>Орех</th></tr>
    <tr><td>1</td><td>Yildiz</td><td>1</td><td>1.05</td><td>1.05</td><td>1.3</td><td>1.3</td></tr>
    <tr><td>2</td><td>Yildiz Sedef, Panama, Panama Pearl, Line Harmony, Mat Linen</td><td>1.1</td><td>1.15</td><td>1.15</td><td>1.4</td><td>1.4</td></tr>
    <tr><td>3</td><td>Yildiz Blackout, Yildiz Blackout Sedef, Focus Blackout, Focus Sedef Blackout, Monaco Blackout, Lugano Blackout, Pes Screen, YS Screen, Glarus, Uster, Lancy</td><td>1.3</td><td>1.35</td><td>1.35</td><td>1.6</td><td>1.6</td></tr>
    <tr><td>4</td><td>Basel Blackout, KS Screen, CS Screen</td><td>1.4</td><td>1.45</td><td>1.45</td><td>1.7</td><td>1.7</td></tr>
    <tr><td>5</td><td>Blackout Screen</td><td>1.5</td><td>1.55</td><td>1.55</td><td>1.8</td><td>1.8</td></tr>
  </table>
</div>
        <h3>Кутии и механизми</h3>
        <div class="box-gallery">

<div class="box-item"><img src="https://i.imgur.com/pgbghxa.jpg" alt="Бял"><p>Бял</p></div>          
<div class="box-item"><img src="https://i.imgur.com/UaFwGUs.jpg" alt="Златен Дъб"><p>Златен Дъб</p></div>
<div class="box-item"><img src="https://i.imgur.com/AoThqIF.jpg" alt="Орех"><p> Орех</p></div>
<div class="box-item"><img src="https://i.imgur.com/abPET53.jpg" alt="Антрацит"><p>Антрацит</p></div> 
<div class="box-item"><img src="https://i.imgur.com/4uxq20P.jpg" alt="Кафяв"><p>Кафяв</p></div>
          
        </div>
        <h3>Максимална височина за събиране на платове в кутията</h3>
        <div class="table-container">
          <table>
  <tr>
    <th>Платове</th>
    <th>Елеганс 29mm</th>
    <th>Елеганс + 45mm</th>
  </tr>
  <tr>
    <td>Focus Blackout, Focus Sef Blackout, Monaco Blackout, Basel Blackout, Blackout Screen</td>
    <td>135 см</td>
    <td>185 см</td>
  </tr>
  <tr>
    <td>Panama, Panama Pearl, Yildiz Blackout, Yildiz Blackout Sef, Lugano Pearl, Yildiz Sun Blackout, YS Blackout Sef, Lugano Blackout, Sun Screen, YS Screen</td>
    <td>140 см</td>
    <td>190 см</td>
  </tr>
  <tr>
    <td>Pes Screen</td>
    <td>200 см</td>
    <td>250 см</td>
  </tr>
  <tr>
    <td>Mat Linen</td>
    <td>220 см</td>
    <td>270 см</td>
  </tr>
  <tr>
    <td>Yildiz, Yildiz Sef, Line Harmony</td>
    <td>230 см</td>
    <td>280 см</td>
  </tr>
</table>
        </div>
        <div class="notes">
        Възможно е да се монтира на стъклото или в касетата с монтажни профили.<br><br>
          Как да премерим правилно?<br>
          1. Ширина - премерите разстоянието от вътрешната страна на левия до десния стъклодържач и намалете с 1 см. Това е ширината на плата за съответната щора за да може да се движи свободно между стъклодържачите *габаритната ширина на касетата със стикерните конзоли е с 5cm по-широка от размера на плата<br>
          2. Височина - премерите разстоянието от вътрешната страна на долния до горния стъклодържач и увеличете с 1.5cm (за да може да се застъпи върху горния стъклодържач със самата щора в монтажно положение<br>
          3. За управление на щора погледнато от помещението определете дали да бъде ляво или дясно<br>
          4.Уверете се дълбочината на стъклодържача да бъде поне 1.5CM<br><br>
          Измерените по този начин щори се подават като размер на плат на щората.Ако се подават габаритни размери на щората, забинете трябва да се извади от ширината на поръчката<br>
          При подаване на габаритен размер единствената разлика е в ширината на поръчката!<br>
          Та е с 5cm разлика повече в ширина спрямо размера на плата!<br>
          Щора "Ден и Нощ" Елеганс е възможно да опира на стъклото при пускане на плат!
<div class="examples-gallery">
<div class="example-item"><img src="https://i.imgur.com/DMSSRK9.jpg" alt="Роло щора – монтаж 1"></div>
                </div>  
        </div>
</div>
      </div>
    </div>
    <!-- 6.Ден и Нощ Елеганс+ (45мм кутия) -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Ден и Нощ Елеганс+ (45мм кутия)</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Ден и Нощ Елеганс+ (45мм кутия)</h3>
          <div class="calc-input">
            <input type="number" id="dnn-plus-width" placeholder="Ширина (см)" min="1">
            <input type="number" id="dnn-plus-height" placeholder="Височина (см)" min="1">
            <select id="dnn-plus-fabric" required>
              <option value="" disabled selected>Изберете плат... *</option>
              <option value="Eco Series">Eco Series</option>
              <option value="Modern Decor">Modern Decor</option>
              <option value="Charm GE">Charm GE</option>
              <option value="Charm GK">Charm GK</option>
              <option value="Charm AS">Charm AS</option>
              <option value="St.Galen">St.Galen</option>
              <option value="Montaro">Montaro</option>
              <option value="Urban">Urban</option>
              <option value="Rare">Rare</option>
              <option value="Keten">Keten</option>
              <option value="Craft">Craft</option>
              <option value="Raw">Raw</option>
              <option value="Natural">Natural</option>
              <option value="Tiffany">Tiffany</option>
              <option value="Piriti">Piriti</option>
              <option value="Bamboo Curtain">Bamboo Curtain</option>
              <option value="New Wave">New Wave</option>
              <option value="Versa">Versa</option>
              <option value="Best">Best</option>
              <option value="Arbon">Arbon</option>
              <option value="Kugel">Kugel</option>
              <option value="Passion">Passion</option>
              <option value="Imagine">Imagine</option>
              <option value="Eden">Eden</option>
              <option value="Pearl">Pearl</option>
              <option value="Smart">Smart</option>
              <option value="Baskili Zebra TD">Baskili Zebra TD</option>
              <option value="Baskili Zebra PLS">Baskili Zebra PLS</option>
              <option value="Blackout">Blackout</option>
              <option value="Keten Baskili">Keten Baskili</option>
              <option value="Peimo">Peimo</option>
              <option value="Nordern">Nordern</option>
              <option value="Biel Blackout">Biel Blackout</option>
              <option value="Bonn Blackout">Bonn Blackout</option>
            </select>
            <input type="text" id="dnn-plus-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <select id="dnn-plus-color" required>
              <option value="" disabled selected>Цвят на компонентите... *</option>
              <option value="white">Бял</option>
              <option value="brown">Кафяв</option>
              <option value="anthracite">Антрацит</option>
              <option value="golden_oak">Златен дъб</option>
              <option value="walnut">Орех</option>
            </select>
            <select id="dnn-plus-control" required>
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateDnnPlus()">Изчисли</button>
          </div>
          <div class="calc-result" id="dnn-plus-result">—</div>
          <button class="add-to-cart-btn" onclick="addDnnPlusToCart()" id="dnn-plus-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="dnn-plus-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('dnn-plus-content', 'Ден и Нощ Елеганс+ (45мм кутия)')">Download</button>
        <div id="dnn-plus-content">
          <h3>Цени за Ден и Нощ Елеганс+ (45мм кутия)</h3>
          <div class="table-container"><table id="dnn-plus-table"></table></div>
<h3>Коефициенти за платове -  Ден и Нощ Елеганс+ (45мм кутия)</h3>
<div class="table-container">
  <table>
    <tr><th>Група</th><th>Плат</th><th>Бял</th><th>Кафяв</th><th>Антрацит</th><th>Златен дъб</th><th>Орех</th></tr>
    <tr><td>1</td><td>Eco Series, Modern Decor</td><td>1</td><td>1.05</td><td>1.05</td><td>1.3</td><td>1.3</td></tr>
    <tr><td>2</td><td>Charm GE, GK AS</td><td>1.1</td><td>1.15</td><td>1.15</td><td>1.4</td><td>1.4</td></tr>
    <tr><td>3</td><td>St Galen, Montaro, Urban, Rare, Keten Craft, Raw, Natural, Tiffany, Piriti, Bamboo Curtain, New Wave, Versa, Best, Arbon, Kugel</td><td>1.2</td><td>1.25</td><td>1.25</td><td>1.5</td><td>1.5</td></tr>
    <tr><td>4</td><td>Passion, Imagine, Eden, Pearl, Smart</td><td>1.3</td><td>1.35</td><td>1.35</td><td>1.6</td><td>1.6</td></tr>
    <tr><td>5</td><td>Baskili Zebra TD, Baskili Zebra PLS</td><td>1.4</td><td>1.45</td><td>1.45</td><td>1.7</td><td>1.7</td></tr>
    <tr><td>6</td><td>Blackout, Keten Baskili, Peimo, Nordern</td><td>1.5</td><td>1.55</td><td>1.55</td><td>1.8</td><td>1.8</td></tr>
    <tr><td>7</td><td>Biel Blackout, Bonn Blackout</td><td>1.6</td><td>1.65</td><td>1.65</td><td>1.9</td><td>1.9</td></tr>
  </table>
</div>
        <h3>Кутии и механизми</h3>
        <div class="box-gallery">
        <div class="box-item"><img src="https://i.imgur.com/pgbghxa.jpg" alt="Бял"><p>Бял</p></div>          
<div class="box-item"><img src="https://i.imgur.com/UaFwGUs.jpg" alt="Златен Дъб"><p>Златен Дъб</p></div>
<div class="box-item"><img src="https://i.imgur.com/AoThqIF.jpg" alt="Орех"><p> Орех</p></div>
<div class="box-item"><img src="https://i.imgur.com/abPET53.jpg" alt="Антрацит"><p>Антрацит</p></div> 
<div class="box-item"><img src="https://i.imgur.com/4uxq20P.jpg" alt="Кафяв"><p>Кафяв</p></div>
                  </div>
        <h3>Максимална височина за събиране на платове в кутията</h3>
        <div class="table-container">
          <table>
            <tr><th>Платове</th><th>Elegans 29mm</th><th>Elegans+ 45mm</th></tr>
            <tr><td>St.Galen, Pirilti, Pearl, Smart</td><td>75 см</td><td>150 см</td></tr>
            <tr><td>Nordern, Arbon, Kugel, Urban, Rare, Keten Craft, Raw, Natural, Tiffany, Montaro</td><td>80 см</td><td>170 см</td></tr>
            <tr><td>Bonn Blackout, Biel Blackout, Keten Baskili PLS, Imagine, Versa, Passion, Eden, Bamboo Curtain, Blackout, Best</td><td>90 см</td><td>180 см</td></tr>
            <tr><td>Charm, Pelmo, New Wave</td><td>110 см</td><td>190 см</td></tr>
            <tr><td>Eco Series, Modern Décor, Baskili TD, Baskili PLS, Baskili Duz</td><td>165 см</td><td>220 см</td></tr>
          </table>
        </div>
        <div class="notes">
         Възможно е да се монтира на стъклото или в касетата с монтажни профили.<br><br>
          Как да премерим правилно?<br>
          1. Ширина - премерите разстоянието от вътрешната страна на левия до десния стъклодържач и намалете с 1 см. Това е ширината на плата за съответната щора за да може да се движи свободно между стъклодържачите *габаритната ширина на касетата със стикерните конзоли е с 5cm по-широка от размера на плата<br>
          2. Височина - премерите разстоянието от вътрешната страна на долния до горния стъклодържач и увеличете с 1.5cm (за да може да се застъпи върху горния стъклодържач със самата щора в монтажно положение<br>
          3. За управление на щора погледнато от помещението определете дали да бъде ляво или дясно<br>
          4.Уверете се дълбочината на стъклодържача да бъде поне 1.5CM<br><br>
          Измерените по този начин щори се подават като размер на плат на щората.Ако се подават габаритни размери на щората, забинете трябва да се извади от ширината на поръчката<br>
          При подаване на габаритен размер единствената разлика е в ширината на поръчката!<br>
          Та е с 5cm разлика повече в ширина спрямо размера на плата!<br>
          Щора "Ден и Нощ" Елеганс е възможно да опира на стъклото при пускане на плат!
<div class="examples-gallery">
          <div class="example-item"><img src="https://i.imgur.com/n1NbL7S.jpg" alt="Роло щора – монтаж 1"></div>
                  </div>

        </div>
      </div>
    </div>
</div>
    <!-- 3. РОЛЕТНИ ЩОРИ -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Ролетни щори</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Ролетни щори</h3>
          <div class="calc-input">
            <input type="number" id="roletni-width" placeholder="Ширина (см)" min="1" oninput="handleRoletniWidthChange()">
            <input type="number" id="roletni-height" placeholder="Височина (см)" min="1" oninput="handleRoletniHeightChange()">
            <select id="roletni-series">
              <option value="" disabled selected>Изберете серия...</option>
              <option value="yildiz_m">YILDIZ SERİSİ (Mat Polyester)</option>
              <option value="yildiz_color">YILDIZ SERİSİ (Renkli)</option>
              <option value="yildiz_sedef">YILDIZ SEDEF SERİSİ</option>
              <option value="panama">PANAMA SERİSİ</option>
              <option value="panama_pearl">PANAMA PEARL SERİSİ</option>
              <option value="mat_linen">MAT LINEN SERİSİ</option>
              <option value="line_harmony">LINE HARMONY SERİSİ</option>
              <option value="glarus">GLARUS SERİSİ</option>
              <option value="lancy">LANCY SERİSİ</option>
              <option value="yildiz_blackout">YILDIZ BLACKOUT SERİSİ</option>
              <option value="yildiz_blackout_sedef">YILDIZ BLACKOUT SEDEF SERİSİ</option>
              <option value="focus_blackout">FOCUS BLACKOUT SERİSİ</option>
              <option value="focus_sedef_blackout">FOCUS SEDEF BLACKOUT SERİSİ</option>
              <option value="monaco_blackout">MONACO BLACKOUT SERİSİ</option>
              <option value="lugano_blackout">LUGANO BLACKOUT SERİSİ</option>
              <option value="uster_blackout">USTER BLACKOUT SERİSİ</option>
              <option value="basel_blackout">BASEL BLACKOUT SERİSİ</option>
              <option value="blackout_screen">BLACKOUT SCREEN SERİSİ</option>
              <option value="pes_screen">PES SCREEN SERİSİ</option>
              <option value="ys_screen">YS SCREEN SERİSİ</option>
              <option value="ks_screen">KS SCREEN SERİSİ</option>
              <option value="cs_screen">CS SCREEN SERİSİ</option>
            </select>
            <input type="text" id="roletni-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <div class="calc-checkboxes">
              <label><input type="checkbox" class="roletni-extra" value="box_closed">Затворена кутия (+4.56 €/л.м.)</label>
              <label><input type="checkbox" class="roletni-extra" value="box_fabric">Кутия с плат (+13.44 €/л.м.)</label>
              <label><input type="radio" name="roletni-jumbo" class="roletni-extra" value="jumbo38">Джъмбо механизъм 38mm (+4.56 €/л.м.)</label>
              <label><input type="radio" name="roletni-jumbo" class="roletni-extra" value="jumbo47">Джъмбо механизъм 47mm (+6.78 €/л.м.)</label>
              <label><input type="checkbox" class="roletni-extra" value="chain_metal">Метална верижка (+3.42 €/бр)</label>
            </div>
            <select id="roletni-control" required>
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateRoletni()">Изчисли</button>
          </div>
          <div class="calc-result" id="roletni-result">—</div>
          <button class="add-to-cart-btn" onclick="addRoletniToCart()" id="roletni-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="roletni-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('roletni-content', 'Ролетни щори')">Download</button>
        <div id="roletni-content">
        <h3>Кутии и механизми</h3>
        <div class="box-gallery">
          <div class="box-item"><img src="https://i.imgur.com/uVJctYX.jpg" alt="Стандарт"><p>Стандарт – без кутия / с шина/</p></div>
          <div class="box-item"><img src="https://i.imgur.com/kFteABO.jpg" alt="Кутия с плат"><p>Кутия с плат</p></div>
          <div class="box-item"><img src="https://i.imgur.com/CGVcaiC.jpg" alt="Затворена кутия (бяла)"><p>Затворена кутия (бяла)</p></div>
          <div class="box-item"><img src="https://i.imgur.com/3ITdkeP.jpg" alt="Затворена кутия (инокс)"><p>Затворена кутия (инокс)</p></div>
        </div>
        <div class="table-container">
          <table id="roletni-price-table"></table>
        </div>
        <div class="notes">
          Минимална ширина: 100 см | Минимална височина: 200 см<br>
          Закръгляне: нагоре до 10 см<br>
          При височина >200 см и ширина >140 см → ширина = 200 см<br>
          Затворена кутия: +4.56 €/л.м. | Кутия с плат: +13.44 €/л.м.<br>
          Джъмбо механизъм (38mm): +4.56 €/л.м. | (47mm): +6.78 €/л.м.<br>
          Метална верижка: +3.42 €/бр
        </div>
        <div class="examples-title">Примери за монтаж</div>
        <div class="examples-gallery">
          <div class="example-item"><img src="https://i.imgur.com/GyRrjEo.jpg" alt="Роло щора – монтаж 1"></div>
          <div class="example-item"><img src="https://i.imgur.com/ffGhY7K.jpg" alt="Роло щора – монтаж 2"></div>
          <div class="example-item"><img src="https://i.imgur.com/8tiwKyn.jpg" alt="Роло щора – монтаж 3"></div>
        </div>
        </div>
      </div>
    </div>
    <!-- 6. ЩОРА "ДЕН И НОЩ" -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Щора "Ден и Нощ"</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Щора "Ден и Нощ"</h3>
          <div class="calc-input">
            <input type="number" id="day-night-width" placeholder="Ширина (см)" min="1" oninput="handleDayNightWidthChange()">
            <input type="number" id="day-night-height" placeholder="Височина (см)" min="1" oninput="handleDayNightHeightChange()">
            <select id="day-night-series">
              <option value="" disabled selected>Изберете серия...</option>
              <option value="eco">ECO SERİSİ</option>
              <option value="modern">MODERN DECOR</option>
              <option value="charm_ge">CHARM GE SERİSİ</option>
              <option value="charm_gk">CHARM GK SERİSİ</option>
              <option value="charm_as">CHARM AS SERİSİ</option>
              <option value="eden">EDEN SERİSİ</option>
              <option value="imagine">IMAGINE SERİSİ</option>
              <option value="smart">SMART SERİSİ</option>
              <option value="st_gallen">ST. GALLEN SERİSİ</option>
              <option value="montaro">MONTARO SERİSİ</option>
              <option value="bamboo_curtain">BAMBOO CURTAIN</option>
              <option value="passion">PASSION SERİSİ</option>
              <option value="baskili_duz">BASKILI ZEBRA DÜZ</option>
              <option value="arbon">ARBON SERİSİ</option>
              <option value="kugel">KUGEL SERİSİ</option>
              <option value="urban">URBAN SERİSİ</option>
              <option value="rare">RARE SERİSİ</option>
              <option value="keten_craft">KETEN CRAFT</option>
              <option value="new_wave">NEW WAVE SERİSİ</option>
              <option value="pearl">PEARL SERİSİ</option>
              <option value="raw">RAW SERİSİ</option>
              <option value="naturel">NATUREL SERİSİ</option>
              <option value="tiffany">TIFFANY SERİSİ</option>
              <option value="pirilti">PIRILTI SERİSİ</option>
              <option value="versa">VERSA SERİSİ</option>
              <option value="best">BEST SERİSİ</option>
              <option value="blackout">BLACKOUT SERİSİ</option>
              <option value="pelmo">PELMO SERİSİ</option>
              <option value="nordend">NORDEND SERİSİ</option>
              <option value="baskili_td">BASKLI ZEBRA TD SERİSİ</option>
              <option value="baskili_pls">BASKILI ZEBRA PLS SERİSİ</option>
              <option value="biel_blackout">BİEL BLACKOUT SERİSİ</option>
              <option value="keten_baskili_pls">KETEN BASKILI PLS SERİSİ</option>
              <option value="bonn_blackout">BONN BLACKOUT SERİSİ</option>
              <option value="silhouette">BANTLI SİLÜET BR SERİSİ</option>
            </select>
            <input type="text" id="day-night-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <div class="calc-checkboxes">
              <label><input type="checkbox" class="day-night-extra" value="box_closed">Затворена кутия (+4.56 €/л.м.)</label>
              <label><input type="checkbox" class="day-night-extra" value="box_fabric">Кутия с плат (+13.44 €/л.м.)</label>
              <label><input type="radio" name="day-night-jumbo" class="day-night-extra" value="jumbo38">Джъмбо механизъм 38mm (+4.56 €/л.м.)</label>
              <label><input type="radio" name="day-night-jumbo" class="day-night-extra" value="jumbo47">Джъмбо механизъм 47mm (+6.78 €/л.м.)</label>
              <label><input type="checkbox" class="day-night-extra" value="chain_metal">Метална верижка (+3.42 €/бр)</label>
            </div>
            <select id="day-night-control" required>
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateDayNight()">Изчисли</button>
          </div>
          <div class="calc-result" id="day-night-result">—</div>
          <button class="add-to-cart-btn" onclick="addDayNightToCart()" id="day-night-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="day-night-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('day-night-content', 'Щора Ден и Нощ')">Download</button>
        <div id="day-night-content">
        <h3>Кутии и механизми</h3>
        <div class="box-gallery">
          <div class="box-item"><img src="https://i.imgur.com/uVJctYX.jpg" alt="Стандарт"><p>Стандарт – без кутия / с шина/</p></div>
          <div class="box-item"><img src="https://i.imgur.com/kFteABO.jpg" alt="Кутия с плат"><p>Кутия с плат</p></div>
          <div class="box-item"><img src="https://i.imgur.com/CGVcaiC.jpg" alt="Затворена кутия (бяла)"><p>Затворена кутия (бяла)</p></div>
          <div class="box-item"><img src="https://i.imgur.com/3ITdkeP.jpg" alt="Затворена кутия (инокс)"><p>Затворена кутия (инокс)</p></div>
        </div>
        <div class="table-container">
          <table id="daynight-price-table"></table>
        </div>
        <div class="notes">
          Минимална ширина: 100 см | Минимална височина: 200 см<br>
          Закръгляне: нагоре до 10 см<br>
          При височина >200 см и ширина >140 см → ширина = 200 см<br>
          Затворена кутия: +4.56 €/л.м. | Кутия с плат: +13.44 €/л.м.<br>
          Джъмбо механизъм (38mm): +4.56 €/л.м. | (47mm): +6.78 €/л.м.<br>
          Метална верижка: +3.42 €/бр
        </div>
        <div class="examples-title">Примери за монтаж</div>
        <div class="examples-gallery">
          <div class="example-item"><img src="https://i.imgur.com/RQYOwXx.jpg" alt="Ден и Нощ – монтаж 1"></div>
          <div class="example-item"><img src="https://i.imgur.com/jqRUpmK.jpg" alt="Ден и Нощ – монтаж 2"></div>
          <div class="example-item"><img src="https://i.imgur.com/rV5ymJ8.jpg" alt="Ден и Нощ – монтаж 3"></div>
        </div>
        </div>
      </div>
    </div>
    <!-- 7. ДВОЙНО РОЛО -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Двойно Роло (тюлени ролетни платове)</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Двойно Роло</h3>
          <div class="calc-input" style="display:flex;flex-direction:column;align-items:center;gap:15px;">
            <input type="number" id="double-rolo-width" placeholder="Ширина (см)" min="1" style="width:100%;max-width:300px;">
            <input type="number" id="double-rolo-height" placeholder="Височина (см)" min="1" style="width:100%;max-width:300px;">
            <select id="double-rolo-back-fabric" required style="width:100%;max-width:300px;">
              <option value="" disabled selected>Заден плат... *</option>
              <option value="yildiz_m">YILDIZ SERİSİ (Mat Polyester)</option>
              <option value="yildiz_color">YILDIZ SERİSİ (Renkli)</option>
              <option value="yildiz_sedef">YILDIZ SEDEF SERİSİ</option>
              <option value="panama">PANAMA SERİSİ</option>
              <option value="panama_pearl">PANAMA PEARL SERİSİ</option>
              <option value="mat_linen">MAT LINEN SERİSİ</option>
              <option value="line_harmony">LINE HARMONY SERİSİ</option>
              <option value="glarus">GLARUS SERİSİ</option>
              <option value="lancy">LANCY SERİSİ</option>
              <option value="yildiz_blackout">YILDIZ BLACKOUT SERİSİ</option>
              <option value="yildiz_blackout_sedef">YILDIZ BLACKOUT SEDEF SERİSİ</option>
              <option value="focus_blackout">FOCUS BLACKOUT SERİSİ</option>
              <option value="focus_sedef_blackout">FOCUS SEDEF BLACKOUT SERİSİ</option>
              <option value="monaco_blackout">MONACO BLACKOUT SERİSİ</option>
              <option value="lugano_blackout">LUGANO BLACKOUT SERİSİ</option>
              <option value="uster_blackout">USTER BLACKOUT SERİSİ</option>
              <option value="basel_blackout">BASEL BLACKOUT SERİSİ</option>
              <option value="blackout_screen">BLACKOUT SCREEN SERİSİ</option>
              <option value="pes_screen">PES SCREEN SERİSİ</option>
              <option value="ys_screen">YS SCREEN SERİSİ</option>
              <option value="ks_screen">KS SCREEN SERİSİ</option>
              <option value="cs_screen">CS SCREEN SERİSİ</option>
            </select>
            <select id="double-rolo-transparent-fabric" required style="width:100%;max-width:300px;">
              <option value="" disabled selected>Прозрачен плат... *</option>
              <option value="yo">YO SER.</option>
              <option value="rte">RTE SER.</option>
              <option value="yt">YT SER.</option>
              <option value="beauty">BEAUTY SERİSİ</option>
              <option value="elite">ELITE SERİSİ</option>
              <option value="kl">KL SERİSİ</option>
              <option value="st">ST SERİSİ</option>
              <option value="linda">LINDA SERİSİ</option>
            </select>
            <input type="text" id="double-rolo-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)" style="width:100%;max-width:300px;">
            <select id="double-rolo-control" required style="width:100%;max-width:300px;">
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateDoubleRolo()" style="width:100%;max-width:300px;">Изчисли</button>
          </div>
          <div class="calc-checkboxes" style="display:flex;flex-direction:column;align-items:center;gap:10px;margin:20px 0;">
            <label><input type="checkbox" class="double-rolo-extra" value="box_closed">Затворена кутия (+4.56 €/л.м.)</label>
            <label><input type="checkbox" class="double-rolo-extra" value="box_fabric">Кутия с плат (+13.44 €/л.м.)</label>
            <label><input type="radio" name="double-rolo-jumbo" class="double-rolo-extra" value="jumbo38">Джъмбо механизъм 38mm (+4.56 €/л.м.)</label>
            <label><input type="radio" name="double-rolo-jumbo" class="double-rolo-extra" value="jumbo47">Джъмбо механизъм 47mm (+6.78 €/л.м.)</label>
            <label><input type="checkbox" class="double-rolo-extra" value="chain_metal">Метална верижка (+3.42 €/бр)</label>
          </div>
          <div class="calc-result" id="double-rolo-result">—</div>
          <button class="add-to-cart-btn" onclick="addDoubleRoloToCart()" id="double-rolo-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="double-rolo-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('double-rolo-content', 'Двойно Роло')">Download</button>
        <div id="double-rolo-content">
        <h3>Кутии и механизми</h3>
        <div class="box-gallery">
          <div class="box-item"><img src="https://i.imgur.com/2rfIuIq.jpg" alt="Стандарт"><p>Стандарт – без кутия / с шина/</p></div>
          <div class="box-item"><img src="https://i.imgur.com/pZjD1dt.jpg" alt="Затворена кутия (бяла)"><p>Затворена кутия (бяла)</p></div>
          <div class="box-item"><img src="https://i.imgur.com/0FZlos5.jpg" alt="Кутия с плат"><p>Кутия с плат</p></div>
        </div>
        <div class="table-container">
          <table id="double-rolo-price-table"></table>
        </div>
        <div class="notes">
          Минимална ширина: 100 см | Минимална височина: 200 см<br>
          Закръгляне: нагоре до 10 см<br>
          При височина >200 см и ширина >140 см → ширина = 200 см<br>
          Комбинирай с платове от "Роло Щора" за крайна цена
        </div>
        <div class="examples-title">Примери за монтаж</div>
        <div class="examples-gallery">
          <div class="example-item"><img src="https://i.imgur.com/ngFFcsg.jpg" alt="Двойно роло – монтаж 1"></div>
          <div class="example-item"><img src="https://i.imgur.com/3EHZ73h.jpg" alt="Двойно роло – монтаж 2"></div>
          <div class="example-item"><img src="https://i.imgur.com/lhY8R2Z.jpg" alt="Двойно роло – монтаж 3"></div>
        </div>
        </div>
      </div>
    </div>
    <!-- 8. ПЛИСЕ -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Плисе</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Плисе</h3>
          <div class="calc-input">
            <input type="number" id="plise-width" placeholder="Ширина (см)" min="1">
            <input type="number" id="plise-height" placeholder="Височина (см)" min="1">
            <div class="calc-checkboxes">
              <label><input type="checkbox" id="plise-double" onchange="toggleDoublePlise()">Двойно плисе</label>
            </div>
            <select id="plise-series">
              <option value="" disabled selected>Изберете серия...</option>
              <option value="diamond">DIAMOND</option>
              <option value="blackout">BLACKOUT</option>
              <option value="tulle">TULLE</option>
              <option value="lund">LUND</option>
              <option value="nora">NORA</option>
              <option value="hanko">HANKO</option>
              <option value="etna">ETNA</option>
              <option value="rio">RIO</option>
              <option value="randers">RANDERS</option>
              <option value="honeycomb">HONEYCOMB</option>
              <option value="lizbon">LIZBON</option>
              <option value="toronto">TORONTO</option>
              <option value="dublin">DUBLIN</option>
              <option value="milano">MILANO</option>
            </select>
            <input type="text" id="plise-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <select id="plise-thin-series" style="display:none;">
              <option value="" disabled selected>Изберете тънък плат...</option>
              <option value="tulle">TULLE</option>
              <option value="etna">ETNA</option>
            </select>
            <select id="plise-profile-color">
              <option value="" disabled selected>Изберете цвят на профила (опционално)...</option>
              <option value="white">Бял</option>
              <option value="cream">Крем</option>
              <option value="black">Черен</option>
              <option value="anthracite">Антрацит</option>
              <option value="brown">Кафяв</option>
              <option value="grey">Сив</option>
              <option value="bronze">Бронз</option>
            </select>
            <div class="calc-checkboxes">
              <label><input type="radio" name="plise-profile" class="plise-extra" value="clip_profile">Цял профил + клипсове (+3.00 €/m²)</label>
              <label><input type="radio" name="plise-profile" class="plise-extra" value="tape_profile">Цял профил + двойнозалепващо (+3.00 €/m²)</label>
            </div>
            <button onclick="calculatePlise()">Изчисли</button>
          </div>
          <div class="calc-result" id="plise-result">—</div>
          <button class="add-to-cart-btn" onclick="addPliseToCart()" id="plise-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="plise-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('plise-content', 'Плисе')">Download</button>
        <div id="plise-content">
        <div class="table-container">
          <table id="plise-price-table"></table>
        </div>
        <div class="notes">
          Цвят на профили: бял, крем, черен, антрацит, кафяв, сив, бронз<br>
          Минимум за изчисление: 1m²<br>
          Оскъпяване за цял профил и закопчаване с клипсове: +3.00 €/m²<br>
          Оскъпяване за цял профил и вариант с двойно залепващо захващане: +3.00 €/m²
        </div>
        <div class="examples-title">Примери за монтаж</div>
        <div class="examples-gallery">
          <div class="example-item"><img src="https://i.imgur.com/IFAbNwy.jpg" alt="Плисе – монтаж 1"></div>
          <div class="example-item"><img src="https://i.imgur.com/JipA5Ee.jpg" alt="Плисе – монтаж 2"></div>
          <div class="example-item"><img src="https://i.imgur.com/B3Gt7hu.jpg" alt="Плисе – монтаж 3"></div>
        </div>
        </div>
      </div>
    </div>
    <!-- 9. ПЕРДЕ-ЩОРА -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Перде-Щора</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за Перде-Щора</h3>
          <div class="calc-input">
            <input type="number" id="perde-width" placeholder="Ширина (см)" min="1">
            <input type="number" id="perde-height" placeholder="Височина (см)" min="1">
            <select id="perde-series">
              <option value="" disabled selected>Изберете серия...</option>
              <option value="dt">DT</option>
              <option value="nd">ND</option>
              <option value="dj-i">DJ-I</option>
              <option value="dj-e">DJ-E</option>
              <option value="dj-d">DJ-D</option>
              <option value="sm">SM</option>
              <option value="br">BR</option>
              <option value="mc">MC (тесни платове)</option>
              <option value="smf">SMF</option>
              <option value="jp">JP VERDUO (цв.печат)</option>
            </select>
            <input type="text" id="perde-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <div class="calc-checkboxes">
              <label><input type="radio" name="perde-shape" id="perde-standard" value="standard" checked>Стандартно</label>
              <label><input type="radio" name="perde-shape" id="perde-nonstandard" value="skosheni">Скосени (+30%)</label>
            </div>
            <select id="perde-control" required>
              <option value="" disabled selected>Събиране... *</option>
              <option value="kum_vuzheto">Събиране към въжето</option>
              <option value="sreshtu_vuzheto">Събиране срещу въжето</option>
              <option value="razdelno">Разделно събиране</option>
            </select>
            <button onclick="calculatePerde()">Изчисли</button>
          </div>
          <div class="calc-result" id="perde-result">—</div>
          <div class="perde-color-picker" id="perde-color-picker">
            <div class="perde-color-title">Изберете код и цвят на плата:</div>
            <div class="perde-color-swatches" id="perde-color-swatches"></div>
            <div class="perde-color-selected" id="perde-color-selected">Няма избран цвят</div>
            <div class="perde-color-actions">
              <label class="perde-symmetry-toggle">
                <input type="checkbox" id="perde-symmetry-toggle" checked>
                <span>Симетрично разпределение</span>
              </label>
              <button class="perde-clear-btn" id="perde-clear-btn" onclick="clearPerdeColors()">Изчисти</button>
            </div>
          </div>
          <div class="lameli-visualization" id="perde-lameli-visualization" style="display:none;">
            <div class="lameli-info" id="perde-lameli-info">Брой ламели: <span id="perde-lameli-count">0</span></div>
            <div class="lameli-container" id="perde-lameli-container"></div>
          </div>
          <div class="lamela-summary" id="perde-lamela-summary">Разпределение: —</div>
          <button class="add-to-cart-btn" onclick="addPerdeToCart()" id="perde-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="perde-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('perde-content', 'Перде-Щора')">Download</button>
        <div id="perde-content">
        <div class="table-container">
          <table id="perde-price-table">
            <tr><th>Серия</th><th>Цена (€)</th><th>Ед.</th><th>Срок</th></tr>
            <!-- Таблицата ще се актуализира динамично -->
          </table>
        </div>
        <div class="notes">
          При смятане минималната ширина е 100 см, минималната височина е 200 см.<br>
          Широчината и височината се закръглят на 10-тия см.<br>
          Максимална широчина: 600 см | Максимална височина: 700 см.<br>
          JP/Brilliant: мин. височина 300 см.<br>
          Скосени: 30%.<br>
          <strong>ТЕХНИЧЕСКИ ДАННИ НА РЕЛСАТА:</strong><br>
          Широчина: 4.5 см | Височина: 5.0 см | Отстояние между куките: 10.6 см / 8.5 см (за MC)
        </div>
        <div class="examples-title">Примери за монтаж</div>
        <div class="examples-gallery">
          <div class="example-item"><img src="https://i.imgur.com/2f4CoPj.jpg" alt="Перде-щора – монтаж 1"></div>
          <div class="example-item"><img src="https://i.imgur.com/UvQ9pMc.jpg" alt="Перде-щора – монтаж 2"></div>
          <div class="example-item"><img src="https://i.imgur.com/jEgTXR4.jpg" alt="Перде-щора – монтаж 3"></div>
        </div>
        </div>
      </div>
    </div>
    <!-- 10. КОМАРНИЦИ -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Комарници</div>
      <div class="accordion-content">
        <div class="calculator">
          <h3>Калкулатор за комарници</h3>
          <div class="calc-input">
            <select id="type">
              <option value="single">Еднокрилен</option>
              <option value="double">Двукрилен</option>
            </select>
            <select id="profile">
              <option value="white">Бял профил</option>
              <option value="color">Цветен профил</option>
              <option value="flander">Фладер</option>
            </select>
            <input type="text" id="mosquito-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <input type="text" id="width" placeholder="Ширина (напр. 123.5 см)" />
            <input type="text" id="height" placeholder="Височина (напр. 187.2 см)" />
            <button onclick="calculate()">Изчисли</button>
          </div>
          <div class="calc-result" id="result">—</div>
          <button class="add-to-cart-btn" onclick="addMosquitoToCart()" id="mosquito-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('mosquito-content', 'Комарници')">Download</button>
        <div id="mosquito-content">
        <h3>Еднокрилен комарник – Бял профил </h3>
        <div class="table-container"><table id="single-white-table"></table></div>
        <h3>Двукрилен комарник – Бял профил </h3>
        <div class="table-container"><table id="double-white-table"></table></div>
        <h3>Еднокрилен комарник – Цветни-КРЕМ,СИВ,АНТРАЦИТ,КАФЯВ,ЧЕРЕН</h3>
        <div class="table-container"><table id="single-color-table"></table></div>
        <h3>Двукрилен комарник – Цветни-КРЕМ,СИВ,АНТРАЦИТ,КАФЯВ,ЧЕРЕН</h3>
        <div class="table-container"><table id="double-color-table"></table></div>
        <h3>Еднокрилен комарник – Фладер-ЗЛАТЕН ДЪБ, АНТИЧЕН ДЪБ,ИНОКС И БРОНЗ</h3>
        <div class="table-container"><table id="single-flander-table"></table></div>
        <h3>Двукрилен комарник – Фладер-ЗЛАТЕН ДЪБ, АНТИЧЕН ДЪБ,ИНОКС И БРОНЗ</h3>
        <div class="table-container"><table id="double-flander-table"></table></div>
        <div class="notes">
          *ДИСТРИБУТОРСКА ЦЕНОВА ЛИСТА С ВКЛЮЧЕНО ДДС<br>
          Цени за парче | Профил 18mm
        </div>
        <div class="product-image">
          <img src="https://i.imgur.com/DvtkEI1.jpg" alt="Комарници – визуализация" id="fullscreen-img" class="fullscreen-trigger">
        </div>
        </div>
      </div>
    </div>
    <!-- Корнизи и механизми -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Корнизи и механизми</div>
      <div class="accordion-content">
        <button class="download-button" onclick="downloadProductAsImage('kornizi-content', 'Корнизи и механизми')">Download</button>
        <div id="kornizi-content">
          <h3>Корнизи и моторизирани механизми – дистрибуторска цена 2026 г.</h3>
          <div class="table-container"><table id="kornizi-table"></table></div>
          <div class="notes">* ДИСТРИБУТОРСКА ЦЕНОВА ЛИСТА С ВКЛЮЧЕНО ДДС | Цени в €</div>
        </div>
      </div>
    </div>
    <!-- Дървени Щори -->
    <div class="accordion">
      <div class="accordion-header" onclick="toggleAccordion(this)">Дървени Щори<span class="novo-badge">ново</span></div>
      <div class="accordion-content">
        <img src="https://i.imgur.com/ZIZnWsS.jpg" alt="Дървени Щори Банер" class="product-banner">
        <div class="calculator">
          <h3>Калкулатор за Дървени Щори</h3>
          <div class="calc-input">
            <input type="number" id="dreveni-width" placeholder="Ширина (см)" min="1">
            <input type="number" id="dreveni-height" placeholder="Височина (см)" min="1">
            <select id="dreveni-type" required>
              <option value="" disabled selected>Изберете вид от MJ серията... *</option>
              <option value="MJ 501">MJ 501</option>
              <option value="MJ 502">MJ 502</option>
              <option value="MJ 503">MJ 503</option>
              <option value="MJ 504">MJ 504</option>
              <option value="MJ 505">MJ 505</option>
              <option value="MJ 506">MJ 506</option>
              <option value="MJ 507">MJ 507</option>
              <option value="MJ 508">MJ 508</option>
              <option value="MJ 510">MJ 510</option>
              <option value="MJ 511">MJ 511</option>
            </select>
            <input type="text" id="dreveni-notes" class="calc-notes" placeholder="Бележки / Номер на плат (по избор)">
            <select id="dreveni-control" required>
              <option value="" disabled selected>Управление... *</option>
              <option value="left">Ляво</option>
              <option value="right">Дясно</option>
            </select>
            <button onclick="calculateDreveni()">Изчисли</button>
          </div>
          <div class="calc-checkboxes dreveni-extras">
            <label><input type="checkbox" class="dreveni-extra" data-label="Колани" data-value="5">Колани (+5 €/м²)</label>
            <label><input type="checkbox" class="dreveni-extra" data-label="Управление със синджир(редуктор)" data-value="3.5">Управление със синджир (+3.50 €/м²)</label>
          </div>
          <div class="calc-result" id="dreveni-result">—</div>
          <button class="add-to-cart-btn" onclick="addDreveniToCart()" id="dreveni-add-cart" style="display:none;">Добави в кошницата</button>
          <div class="history" id="dreveni-history"><strong>Последни резултати:</strong></div>
        </div>
        <button class="download-button" onclick="downloadProductAsImage('dreveni-content', 'Дървени Щори')">Download</button>
        <div id="dreveni-content">
        <h3>Цена: 66 €/m²</h3>
        <div class="notes">
          Цена за квадратен метър: 66 €<br>
          Минимална поръчка: 1 m²<br>
        </div>
        <h3>Типове Дървени Щори</h3>
        <div class="box-gallery">
          <div class="box-item"><img src="https://i.imgur.com/MEI3HE6.jpg" alt="MJ 501" class="fullscreen-trigger"><p>MJ 501</p></div>
          <div class="box-item"><img src="https://i.imgur.com/oLfLXAv.jpg" alt="MJ 502" class="fullscreen-trigger"><p>MJ 502</p></div>
          <div class="box-item"><img src="https://i.imgur.com/x2OReaa.jpg" alt="MJ 503" class="fullscreen-trigger"><p>MJ 503</p></div>
          <div class="box-item"><img src="https://i.imgur.com/GQSokEp.jpg" alt="MJ 504" class="fullscreen-trigger"><p>MJ 504</p></div>
          <div class="box-item"><img src="https://i.imgur.com/yUVVqLr.jpg" alt="MJ 505" class="fullscreen-trigger"><p>MJ 505</p></div>
          <div class="box-item"><img src="https://i.imgur.com/GfVnEz1.jpg" alt="MJ 506" class="fullscreen-trigger"><p>MJ 506</p></div>
          <div class="box-item"><img src="https://i.imgur.com/dO4wbs5.jpg" alt="MJ 507" class="fullscreen-trigger"><p>MJ 507</p></div>
          <div class="box-item"><img src="https://i.imgur.com/K5PTxlF.jpg" alt="MJ 508" class="fullscreen-trigger"><p>MJ 508</p></div>
          <div class="box-item"><img src="https://i.imgur.com/W6hBRrK.jpg" alt="MJ 510" class="fullscreen-trigger"><p>MJ 510</p></div>
          <div class="box-item"><img src="https://i.imgur.com/524XBzW.jpg" alt="MJ 511" class="fullscreen-trigger"><p>MJ 511</p></div>
        </div>
        </div>
      </div>
    </div>
    </div>
  </div>
  <!-- FULLSCREEN MODAL -->
  <div id="fullscreen-modal" class="fullscreen-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:9999;align-items:center;justify-content:center;">
    <span class="close-modal" style="position:absolute;top:20px;right:30px;color:white;font-size:40px;cursor:pointer;">x</span>
    <img src="" alt="Full screen" id="fullscreen-content" style="max-width:90%;max-height:90%;object-fit:contain;">
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    // Cart functionality
    let cart = [];
    
    function toggleCart() {
      const sidebar = document.getElementById("cartSidebar");
      sidebar.classList.toggle("open");
    }
    
    function addToCart(productName, price, details = {}) {
      const item = {
        id: Date.now(),
        name: productName,
        price: parseFloat(price),
        details: details,
        quantity: 1
      };
      cart.push(item);
      updateCartDisplay();
      showCartNotification();
    }
    function addMiniToCart() {
      if (!lastMiniResult) return;
      addToCart(lastMiniResult.name, lastMiniResult.price, lastMiniResult.details);
    }
    function addDnMiniToCart() {
      if (!lastDnMiniResult) return;
      addToCart(lastDnMiniResult.name, lastDnMiniResult.price, lastDnMiniResult.details);
    }
    function addElegansToCart() {
      if (!lastElegansResult) return;
      addToCart(lastElegansResult.name, lastElegansResult.price, lastElegansResult.details);
    }
    function addDnElegansToCart() {
      if (!lastDnElegansResult) return;
      addToCart(lastDnElegansResult.name, lastDnElegansResult.price, lastDnElegansResult.details);
    }
    function addRoloPlusToCart() {
      if (!lastRoloPlusResult) return;
      addToCart(lastRoloPlusResult.name, lastRoloPlusResult.price, lastRoloPlusResult.details);
    }
    function addDnnPlusToCart() {
      if (!lastDnnPlusResult) return;
      addToCart(lastDnnPlusResult.name, lastDnnPlusResult.price, lastDnnPlusResult.details);
    }
    function addRoletniToCart() {
      if (!lastRoletniResult) return;
      addToCart(lastRoletniResult.name, lastRoletniResult.price, lastRoletniResult.details);
    }
    function addDayNightToCart() {
      if (!lastDayNightResult) return;
      addToCart(lastDayNightResult.name, lastDayNightResult.price, lastDayNightResult.details);
    }
    function addDoubleRoloToCart() {
      if (!lastDoubleRoloResult) return;
      addToCart(lastDoubleRoloResult.name, lastDoubleRoloResult.price, lastDoubleRoloResult.details);
    }
    function addPliseToCart() {
      if (!lastPliseResult) return;
      addToCart(lastPliseResult.name, lastPliseResult.price, lastPliseResult.details);
    }
    function addPerdeToCart() {
      if (!lastPerdeResult) return;
      if (!ensureLamelaColoringComplete(true)) return;
      const distribution = getLamelaDistributionText();
      if (perdeColoringRequired) {
        lastPerdeResult.details = lastPerdeResult.details || {};
        lastPerdeResult.details["Разпределение"] = distribution || "Не е завършено";
      }
      addToCart(lastPerdeResult.name, lastPerdeResult.price, lastPerdeResult.details);
    }
    function addMosquitoToCart() {
      if (!lastMosquitoResult) return;
      addToCart(lastMosquitoResult.name, lastMosquitoResult.price, lastMosquitoResult.details);
    }
    function addDreveniToCart() {
      if (!lastDreveniResult) return;
      addToCart(lastDreveniResult.name, lastDreveniResult.price, lastDreveniResult.details);
    }
    
    function removeFromCart(itemId) {
      cart = cart.filter(item => item.id !== itemId);
      updateCartDisplay();
    }
    
    function clearCart(silent = false) {
      if (!silent && !confirm("Сигурни ли сте, че искате да изчистите кошницата?")) {
        return;
      }
      cart = [];
      updateCartDisplay();
    }
    
    function updateCartDisplay() {
      const cartContent = document.getElementById("cartContent");
      const cartFooter = document.getElementById("cartFooter");
      const cartBadge = document.getElementById("cartBadge");
      const cartTotal = document.getElementById("cartTotal");
      
      if (cart.length === 0) {
        cartContent.innerHTML = `
          <div class="cart-empty">
            <svg viewBox="0 0 24 24">
              <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
            <p>Кошницата е празна</p>
          </div>
        `;
        cartFooter.style.display = "none";
        cartBadge.style.display = "none";
      } else {
        let total = 0;
        cartContent.innerHTML = cart.map(item => {
          const itemTotal = item.price * item.quantity;
          total += itemTotal;
          const detailsHtml = Object.keys(item.details).length > 0 
            ? `<div class="cart-item-details">${Object.entries(item.details).map(([key, val]) => `<strong>${key}:</strong> ${val}`).join('<br>')}</div>`
            : '';
          return `
            <div class="cart-item">
              <div class="cart-item-header">
                <div class="cart-item-title">${item.name}</div>
                <button class="cart-item-remove" onclick="removeFromCart(${item.id})">×</button>
              </div>
              ${detailsHtml}
              <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
                <div>
                  <span style="color:#666;font-size:0.9rem;">Количество: ${item.quantity}</span>
                </div>
                <div class="cart-item-price">${itemTotal.toFixed(2)} €</div>
              </div>
            </div>
          `;
        }).join('');
        cartTotal.textContent = total.toFixed(2) + " €";
        cartFooter.style.display = "block";
        cartBadge.textContent = cart.length;
        cartBadge.style.display = "flex";
      }
    }
    
    function showCartNotification() {
      const badge = document.getElementById("cartBadge");
      badge.style.animation = "none";
      setTimeout(() => {
        badge.style.animation = "pulse 0.5s";
      }, 10);
    }
    
    function checkout() {
      if (cart.length === 0) {
        alert("Кошницата е празна!");
        return;
      }
      openOrderModal();
    }
    
    function openOrderModal() {
      const modal = document.getElementById("orderModal");
      const itemsSummary = document.getElementById("orderItemsSummary");
      const orderTotal = document.getElementById("orderTotal");
      const orderForm = document.getElementById("orderForm");
      const orderSuccess = document.getElementById("orderSuccess");
      const orderFormContainer = document.getElementById("orderFormContainer");
      const submitBtn = document.getElementById("orderSubmitBtn");
      
      // Показване на формата и скриване на успешното съобщение
      orderFormContainer.style.display = "block";
      orderSuccess.classList.remove("show");
      
      // Възстановяване на бутона при отваряне на формата
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = "Изпрати поръчка";
      }
      
      // Генериране на резюме на артикулите
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      itemsSummary.innerHTML = cart.map(item => {
        const itemTotal = item.price * item.quantity;
        const detailsHtml = Object.keys(item.details).length > 0 
          ? `<div class="order-item-summary-details">${Object.entries(item.details).map(([key, val]) => `<strong>${key}:</strong> ${val}`).join('<br>')}</div>`
          : '';
        return `
          <div class="order-item-summary">
            <div class="order-item-summary-title">${item.name} x ${item.quantity}</div>
            ${detailsHtml}
            <div class="order-item-summary-price">${itemTotal.toFixed(2)} €</div>
          </div>
        `;
      }).join('');
      
      orderTotal.textContent = total.toFixed(2) + " €";
      modal.classList.add("open");
    }
    
    function closeOrderModal() {
      const modal = document.getElementById("orderModal");
      modal.classList.remove("open");
      // Ресет на формата
      document.getElementById("orderForm").reset();
      // Възстановяване на формата и скриване на успешното съобщение
      document.getElementById("orderFormContainer").style.display = "block";
      document.getElementById("orderSuccess").classList.remove("show");
      // Възстановяване на бутона за изпращане
      const submitBtn = document.getElementById("orderSubmitBtn");
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = "Изпрати поръчка";
      }
    }
    
    // Затваряне на модала при клик извън него
    document.addEventListener("DOMContentLoaded", function() {
      const modal = document.getElementById("orderModal");
      if (modal) {
        modal.addEventListener("click", function(e) {
          if (e.target === modal) {
            closeOrderModal();
          }
        });
      }
    });
    
    function submitOrder(event) {
      event.preventDefault();
      
      const submitBtn = document.getElementById("orderSubmitBtn");
      submitBtn.disabled = true;
      submitBtn.textContent = "Изпращане...";
      
      // Събиране на данните от формата
      const clientNumber = document.getElementById("orderClientNumber").value;
      const address = document.getElementById("orderAddress").value || "Не е посочен";
      const notes = document.getElementById("orderNotes").value || "Няма";
      
      // Форматиране на артикулите
      const itemsList = cart.map(item => {
        const itemTotal = item.price * item.quantity;
        const details = Object.keys(item.details).length > 0 
          ? Object.entries(item.details).map(([key, val]) => `${key}: ${val}`).join('; ')
          : 'Няма допълнителни детайли';
        return `${item.name} x ${item.quantity} (${item.price.toFixed(2)} €) = ${itemTotal.toFixed(2)} €\nДетайли: ${details}`;
      }).join('\n\n');
      
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2);
      
      // Форматиране на съобщението
      const message = `Нова поръчка от клиентски номер: ${clientNumber}

Контактна информация:
Клиентски номер: ${clientNumber}
Адрес: ${address}

Артикули:
${itemsList}

Обща сума: ${total} €

Бележки: ${notes}`;
      
      // Използване на FormSubmit (безплатен, неограничен)
      const formData = new FormData();
      formData.append('clientNumber', clientNumber);
      formData.append('address', address);
      formData.append('notes', notes);
      formData.append('items', itemsList);
      formData.append('total', total);
      formData.append('message', message);
      formData.append('_to', 'moderndecor.sofia@gmail.com');
      formData.append('_subject', `Нова поръчка от клиентски номер: ${clientNumber}`);
      formData.append('_template', 'table');
      formData.append('_captcha', 'false'); // Изключване на капча за по-бързо изпращане
      
      // Изпращане чрез FormSubmit
      fetch('https://formsubmit.co/ajax/moderndecor.sofia@gmail.com', {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log("FormSubmit success:", data);
        // Успешно изпратена поръчка
        document.getElementById("orderFormContainer").style.display = "none";
        document.getElementById("orderSuccess").classList.add("show");
        
        // Възстановяване на бутона (в случай че потребителят отвори формата отново)
        submitBtn.disabled = false;
        submitBtn.textContent = "Изпрати поръчка";
        
        // Пълно нулиране след 3 секунди
        setTimeout(() => {
          // Изчистване на кошницата (без потвърждение)
          clearCart(true);
          // Затваряне на модала
          closeOrderModal();
          // Затваряне на кошницата (ако е отворена)
          const cartSidebar = document.getElementById("cartSidebar");
          if (cartSidebar && cartSidebar.classList.contains("open")) {
            toggleCart();
          }
        }, 3000);
      })
      .catch(error => {
        // Грешка при изпращане - показване на детайли и алтернатива
        console.error("FormSubmit error:", error);
        console.error("Error details:", {
          message: error.message,
          stack: error.stack
        });
        
        // Показване на алтернативен метод (mailto)
        const mailtoSubject = encodeURIComponent(`Нова поръчка от клиентски номер: ${clientNumber}`);
        const mailtoBody = encodeURIComponent(message);
        const mailtoLink = `mailto:moderndecor.sofia@gmail.com?subject=${mailtoSubject}&body=${mailtoBody}`;
        
        const useMailto = confirm(
          "Възникна грешка при автоматично изпращане на поръчката.\n\n" +
          "Искате ли да отворите вашия имейл клиент за ръчно изпращане?\n\n" +
          "(Ако не, поръчката няма да бъде изпратена)"
        );
        
        if (useMailto) {
          window.location.href = mailtoLink;
          // След това все пак показваме успешно съобщение
          document.getElementById("orderFormContainer").style.display = "none";
          document.getElementById("orderSuccess").classList.add("show");
          setTimeout(() => {
            clearCart(true);
            closeOrderModal();
            const cartSidebar = document.getElementById("cartSidebar");
            if (cartSidebar && cartSidebar.classList.contains("open")) {
              toggleCart();
            }
          }, 3000);
        } else {
          submitBtn.disabled = false;
          submitBtn.textContent = "Изпрати поръчка";
        }
      });
    }
    
    const users = { "distributor": "12345", "distributor1": "123456" };
    document.querySelectorAll("#loginScreen input").forEach(input => {
      input.addEventListener("keydown", handleLoginEnter);
    });
    let currentUser = null; // Запазва текущия потребител
    let history = [];
    let miniHistory = [];
    let dnHistory = [];
    let elegansHistory = [];
    let dnElegansHistory = [];
    let roloPlusHistory = [];
    let dnnPlusHistory = [];
    let roletniHistory = [];
    let dayNightCalcHistory = [];
    let doubleRoloHistory = [];
    let pliseCalcHistory = [];
    let perdeCalcHistory = [];
    let selectedPerdeColor = null;
    let lamelaColors = [];
    let lamelaFirstFillDone = false;
    let symmetryEnabled = true;
    let perdeColoringRequired = false;
    let dreveniHistory = [];
    // Last calculated results for cart
    let lastMiniResult = null;
    let lastDnMiniResult = null;
    let lastElegansResult = null;
    let lastDnElegansResult = null;
    let lastRoloPlusResult = null;
    let lastDnnPlusResult = null;
    let lastRoletniResult = null;
    let lastDayNightResult = null;
    let lastDoubleRoloResult = null;
    let lastPliseResult = null;
    let lastPerdeResult = null;
    let lastMosquitoResult = null;
    let lastDreveniResult = null;
    const miniPriceTable = {
      50: {50:10.56,60:11.58,70:12.60,80:13.61,90:14.63,100:15.64,110:16.67,120:17.84,130:18.79,140:19.72,150:20.72},
      60: {50:10.85,60:11.92,70:13.00,80:14.06,90:15.13,100:16.20,110:17.29,120:18.54,130:19.55,140:20.52,150:21.57},
      70: {50:11.13,60:12.26,70:13.39,80:14.51,90:15.64,100:16.77,110:17.92,120:19.25,130:20.30,140:21.32,150:22.42},
      80: {50:11.41,60:12.60,70:13.79,80:14.97,90:16.15,100:17.33,110:18.54,120:19.96,130:21.06,140:22.11,150:23.27},
      90: {50:11.70,60:12.94,70:14.19,80:15.42,90:16.66,100:17.90,110:19.17,120:20.66,130:21.81,140:22.91,150:24.12},
      100: {50:11.98,60:13.28,70:14.58,80:15.87,90:17.17,100:18.46,110:19.79,120:21.37,130:22.56,140:23.71,150:24.97},
      110: {50:12.26,60:13.62,70:14.98,80:16.32,90:17.68,100:19.03,110:20.42,120:22.08,130:23.32,140:24.50,150:25.82},
      120: {50:12.54,60:13.96,70:15.38,80:16.78,90:18.19,100:19.60,110:21.04,120:22.78,130:24.07,140:25.30,150:26.67},
      130: {50:12.83,60:14.30,70:15.77,80:17.23,90:18.70,100:20.16,110:21.67,120:23.49,130:24.83,140:26.10,150:27.53},
      140: {50:13.11,60:14.63,70:16.17,80:17.67,90:19.20,100:20.72,110:22.28,120:24.19,130:25.57,140:26.88,150:28.37},
      150: {50:13.39,60:14.98,70:16.57,80:18.13,90:19.72,100:21.29,110:22.92,120:24.90,130:26.33,140:27.69,150:29.23},
      160: {50:13.67,60:15.31,70:16.96,80:18.58,90:20.22,100:21.85,110:23.53,120:25.60,130:27.08,140:28.48,150:30.07},
      170: {50:13.96,60:15.66,70:17.36,80:19.04,90:20.74,100:22.42,110:24.17,120:26.32,130:27.84,140:29.28,150:30.93},
      180: {50:14.24,60:16.00,70:17.76,80:19.49,90:21.25,100:22.99,110:24.79,120:27.03,130:28.60,140:30.08,150:31.78},
      190: {50:14.52,60:16.34,70:18.16,80:19.94,90:21.76,100:23.55,110:25.42,120:27.73,130:29.35,140:30.88,150:32.63},
      200: {50:14.80,60:16.67,70:18.55,80:20.39,90:22.26,100:24.11,110:26.03,120:28.43,130:30.10,140:31.66,150:33.47},
      210: {50:15.09,60:17.02,70:18.95,80:20.85,90:22.78,100:24.69,110:26.67,120:29.15,130:30.86,140:32.47,150:34.33},
      220: {50:15.37,60:17.35,70:19.34,80:21.29,90:23.28,100:25.24,110:27.28,120:29.84,130:31.60,140:33.26,150:35.17},
      230: {50:15.65,60:17.70,70:19.74,80:21.75,90:23.80,100:25.82,110:27.92,120:30.56,130:32.37,140:34.06,150:36.03}
    };
    const miniFabricCoeff = { 
      "Yildiz": 1.0,
      "Panama": 1.2,
      "Panama Pearl*": 1.2,
      "Yildiz Sedef": 1.2,
      "Line Harmony": 1.2,
      "Mat Linen": 1.2,
      "Yildiz Blackout": 1.4,
      "Yildiz Blackout Sedef": 1.4,
      "Focus Blackout": 1.4,
      "Focus Sedef Blackout": 1.4,
      "Monaco Blackout": 1.4,
      "Lugano Blackout": 1.4,
      "Pes Screen": 1.4,
      "YS Screen": 1.4,
      "Glarus": 1.4,
      "Uster": 1.4,
      "Lancy": 1.4,
      "Basel Blackout": 1.5,
      "KS Screen": 1.5,
      "CS Screen": 1.5,
      "Blackout Screen": 1.6
    };
    const dnPriceTable = {
      50: {50:13.60,60:15.13,70:16.62,80:17.87,90:19.27,100:20.52,110:22.04,120:23.23,130:24.75,140:26.06,150:27.29},
      60: {50:14.15,60:15.56,70:17.12,80:18.47,90:19.95,100:21.27,110:22.84,120:24.12,130:25.70,140:27.10,150:28.38},
      70: {50:14.50,60:15.99,70:17.72,80:19.06,90:20.64,100:22.01,110:23.68,120:24.99,130:26.68,140:28.17,150:29.48},
      80: {50:14.86,60:16.53,70:18.22,80:19.65,90:21.32,100:22.72,110:24.51,120:25.88,130:27.66,140:29.21,150:30.58},
      90: {50:15.24,60:16.88,70:18.76,80:20.25,90:21.97,100:23.46,110:25.34,120:26.74,130:28.64,140:30.25,150:31.68},
      100: {50:15.57,60:17.33,70:19.32,80:20.84,90:22.66,100:24.21,110:26.17,120:27.63,130:29.62,140:31.29,150:32.78},
      110: {50:15.96,60:17.77,70:19.83,80:21.43,90:23.34,100:24.92,110:27.00,120:28.52,130:30.60,140:32.36,150:33.88},
      120: {50:16.34,60:18.22,70:20.39,80:22.03,90:24.02,100:25.66,110:27.83,120:29.38,130:31.58,140:33.40,150:34.98},
      130: {50:16.67,60:18.90,70:20.93,80:22.62,90:24.68,100:26.40,110:28.66,120:30.27,130:32.56,140:34.44,150:36.17},
      140: {50:17.06,60:19.08,70:21.58,80:23.22,90:25.36,100:27.12,110:29.50,120:31.13,130:33.54,140:35.57,150:37.20},
      150: {50:17.41,60:19.50,70:21.99,80:23.81,90:26.04,100:27.86,110:30.33,120:32.02,130:34.49,140:36.61,150:38.24},
      160: {50:17.77,60:20.09,70:22.53,80:24.40,90:26.73,100:28.60,110:31.16,120:32.92,130:35.47,140:37.65,150:39.43},
      170: {50:18.16,60:20.39,70:23.06,80:25.00,90:27.41,100:29.31,110:31.99,120:33.78,130:36.45,140:38.69,150:40.47},
      180: {50:18.51,60:20.98,70:23.66,80:25.59,90:28.06,100:30.06,110:32.82,120:34.67,130:37.43,140:39.72,150:41.57},
      190: {50:18.90,60:21.28,70:24.10,80:26.19,90:28.75,100:30.80,110:33.62,120:35.56,130:38.53,140:40.76,150:42.70},
      200: {50:19.25,60:21.72,70:24.70,80:26.78,90:29.43,100:31.51,110:34.46,120:36.45,130:39.42,140:41.80,150:43.89},
      210: {50:19.64,60:22.17,70:25.14,80:27.37,90:30.11,100:32.25,110:35.29,120:37.34,130:40.46,140:42.84,150:44.93},
      220: {50:20.00,60:22.61,70:25.74,80:27.97,90:30.76,100:33.00,110:36.12,120:38.17,130:41.50,140:43.88,150:45.97},
      230: {50:20.38,60:23.06,70:26.27,80:28.56,90:31.45,100:33.71,110:36.95,120:39.12,130:42.39,140:45.07,150:47.15}
    };
    const dnFabricCoeff = { 
      "Eco Series": 1.0,
      "Modern Decor": 1.0,
      "Charm GE": 1.2,
      "Charm GK": 1.2,
      "Charm AS": 1.2,
      "St.Galen": 1.3,
      "Montaro": 1.3,
      "Urban": 1.3,
      "Rare": 1.3,
      "Keten": 1.3,
      "Craft": 1.3,
      "Raw": 1.3,
      "Naturel": 1.3,
      "Tiffany": 1.3,
      "Piritli": 1.3,
      "Bamboo Curtain": 1.3,
      "New Wave Versa": 1.3,
      "Best": 1.3,
      "Arbon": 1.3,
      "Kugel": 1.3,
      "Passion": 1.4,
      "Imagine": 1.4,
      "Eden": 1.4,
      "Pearl": 1.4,
      "Smart": 1.4,
      "Baskili Zebra TD": 1.6,
      "Baskili Zebra PLS": 1.6,
      "Blackout": 1.65,
      "Keten Baskili": 1.65,
      "Peimo": 1.65,
      "Nordem": 1.65,
      "Biel Blackout": 1.75,
      "Bonn Blackout": 1.75
    };
    const elegansPriceTable = {
      50: {50:16.41,60:17.95,70:19.48,80:21.00,90:22.54,100:24.06,110:25.61,120:27.30,130:28.77,140:30.22,150:31.73},
      60: {50:17.08,60:18.67,70:20.27,80:21.85,90:23.44,100:25.02,110:26.63,120:28.40,130:29.93,140:31.41,150:32.98},
      70: {50:17.75,60:19.40,70:21.05,80:22.69,90:24.34,100:25.98,110:27.65,120:29.51,130:31.08,140:32.61,150:34.23},
      80: {50:18.42,60:20.13,70:21.84,80:23.53,90:25.24,100:26.94,110:28.67,120:30.61,130:32.23,140:33.81,150:35.49},
      90: {50:19.09,60:20.86,70:22.63,80:24.38,90:26.15,100:27.90,110:29.70,120:31.72,130:33.39,140:35.00,150:36.74},
      100: {50:19.76,60:21.58,70:23.41,80:25.22,90:27.05,100:28.86,110:30.72,120:32.82,130:34.54,140:36.20,150:37.99},
      110: {50:20.43,60:22.31,70:24.20,80:26.06,90:27.95,100:29.82,110:31.74,120:33.93,130:35.69,140:37.40,150:39.24},
      120: {50:21.10,60:23.04,70:24.98,80:26.91,90:28.85,100:30.78,110:32.76,120:35.04,130:36.85,140:38.60,150:40.50},
      130: {50:21.77,60:23.77,70:25.77,80:27.75,90:29.75,100:31.74,110:33.78,120:36.14,130:38.00,140:39.79,150:41.75},
      140: {50:22.43,60:24.49,70:26.55,80:28.59,90:30.65,100:32.69,110:34.79,120:37.24,130:39.14,140:40.98,150:42.99},
      150: {50:23.10,60:25.22,70:27.34,80:29.44,90:31.56,100:33.66,110:35.82,120:38.35,130:40.31,140:42.19,150:44.26},
      160: {50:23.77,60:25.94,70:28.12,80:30.28,90:32.45,100:34.61,110:36.83,120:39.45,130:41.45,140:43.37,150:45.50},
      170: {50:24.44,60:26.68,70:28.92,80:31.13,90:33.36,100:35.58,110:37.86,120:40.56,130:42.61,140:44.58,150:46.76},
      180: {50:25.11,60:27.40,70:29.70,80:31.97,90:34.27,100:36.54,110:38.88,120:41.67,130:43.77,140:45.78,150:48.01},
      190: {50:25.78,60:28.13,70:30.49,80:32.81,90:35.17,100:37.50,110:39.90,120:42.77,130:44.92,140:46.98,150:49.27},
      200: {50:26.45,60:28.85,70:31.27,80:33.65,90:36.06,100:38.45,110:40.92,120:43.87,130:46.06,140:48.16,150:50.51},
      210: {50:27.12,60:29.59,70:32.06,80:34.50,90:36.97,100:39.42,110:41.94,120:44.98,130:47.23,140:49.37,150:51.77},
      220: {50:27.78,60:30.31,70:32.84,80:35.34,90:37.87,100:40.37,110:42.96,120:46.08,130:48.37,140:50.56,150:53.01},
      230: {50:28.46,60:31.04,70:33.63,80:36.19,90:38.78,100:41.34,110:46.28,120:47.19,130:49.53,140:51.76,150:54.28}
    };
    const elegansCoeff = {
      'Yildiz': { white: 1, brown: 1.05, anthracite: 1.05, 'golden_oak': 1.3, walnut: 1.3 },
      'Yildiz Sedef': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Panama': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Panama Pearl': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Line Harmony': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Mat Linen': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Yildiz Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Yildiz Blackout Sedef': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Focus Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Focus Sedef Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Monaco Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Lugano Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Pes Screen': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'YS Screen': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Glarus': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Uster': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Lancy': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Basel Blackout': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'KS Screen': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'CS Screen': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'Blackout Screen': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 }
    };
    const dnElegansPriceTable = {
      50: {50:18.13,60:19.94,70:21.87,80:23.56,90:25.40,100:27.09,110:29.06,120:30.69,130:32.65,140:34.40,150:36.06},
      60: {50:18.91,60:20.76,70:22.77,80:24.55,90:26.49,100:28.24,110:30.26,120:31.98,130:34.00,140:35.85,150:37.57},
      70: {50:19.66,60:21.59,70:23.77,80:25.55,90:27.57,100:29.38,110:31.50,120:33.25,130:35.39,140:37.32,150:39.07},
      80: {50:20.41,60:22.52,70:24.67,80:26.54,90:28.65,100:30.50,110:32.73,120:34.54,130:36.78,140:38.77,150:40.58},
      90: {50:21.19,60:23.27,70:25.60,80:27.53,90:29.71,100:31.64,110:33.97,120:35.81,130:38.16,140:40.22,150:42.09},
      100: {50:21.91,60:24.12,70:26.56,80:28.53,90:30.79,100:32.78,110:35.20,120:37.10,130:39.55,140:41.66,150:43.60},
      110: {50:22.69,60:24.96,70:27.47,80:29.52,90:31.88,100:33.90,110:36.44,120:38.40,130:40.94,140:43.14,150:45.10},
      120: {50:23.48,60:25.80,70:28.43,80:30.51,90:32.96,100:35.04,110:37.67,120:39.66,130:42.32,140:44.59,150:46.61},
      130: {50:24.20,60:26.89,70:29.36,80:31.51,90:34.01,100:36.19,110:38.91,120:40.96,130:43.71,140:46.03,150:48.21},
      140: {50:24.98,60:27.46,70:30.42,80:32.50,90:35.10,100:37.30,110:40.14,120:42.22,130:45.09,140:47.57,150:49.65},
      150: {50:25.73,60:28.27,70:31.23,80:33.49,90:36.18,100:38.45,110:41.38,120:43.52,130:46.45,140:49.02,150:51.10},
      160: {50:26.48,60:29.26,70:32.16,80:34.49,90:37.26,100:39.59,110:42.61,120:44.82,130:47.84,140:50.46,150:52.70},
      170: {50:27.26,60:29.95,70:33.09,80:35.48,90:38.35,100:40.70,110:43.85,120:46.08,130:49.22,140:51.91,150:54.14},
      180: {50:28.01,60:30.94,70:34.09,80:36.47,90:39.40,100:41.85,110:45.08,120:47.38,130:50.61,140:53.36,150:55.65},
      190: {50:28.80,60:31.64,70:34.93,80:37.47,90:40.49,100:42.99,110:46.29,120:48.67,130:52.12,140:54.80,150:57.19},
      200: {50:29.55,60:32.48,70:35.92,80:38.46,90:41.57,100:44.11,110:47.52,120:49.97,130:53.41,140:56.25,150:58.79},
      210: {50:30.33,60:33.32,70:36.76,80:39.45,90:42.65,100:45.25,110:48.76,120:51.26,130:54.86,140:57.70,150:60.23},
      220: {50:31.08,60:34.16,70:37.76,80:40.44,90:43.71,100:46.40,110:49.99,120:52.50,130:56.30,140:59.14,150:61.68},
      230: {50:31.86,60:35.00,70:38.69,80:41.44,90:44.79,100:47.51,110:51.23,120:53.85,130:57.60,140:60.74,150:63.28}
    };
    const dnElegansFabricCoeff = { "1":1.0, "2":1.1, "3":1.2, "4":1.3, "5":1.4, "6":1.5, "7":1.6 };
    const dnElegansCoeff = {
      'Eco Series': { white: 1, brown: 1.05, anthracite: 1.05, 'golden_oak': 1.3, walnut: 1.3 },
      'Modern Décor': { white: 1, brown: 1.05, anthracite: 1.05, 'golden_oak': 1.3, walnut: 1.3 },
      'Charm GE': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Charm GK': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Charm AS': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'St.Galen': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Montana': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Urban': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Rare': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Keten': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Craft': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Raw': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Nature': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Tiffany': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Piriti': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Bamboo Curtain': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'New Wave': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Versa': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Best': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Arbon': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Passion': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Imagine': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Eden': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Pearl': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Smart': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Baskili Zebra TD': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'Baskili Zebra PL5': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'Blackout': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 },
      'Keten Baskili': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 },
      'Pelmo': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 },
      'Nordern': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 },
      'Biel Blackout': { white: 1.6, brown: 1.65, anthracite: 1.65, 'golden_oak': 1.9, walnut: 1.9 },
      'Bonn Blackout': { white: 1.6, brown: 1.65, anthracite: 1.65, 'golden_oak': 1.9, walnut: 1.9 }
    };
    const roloPlusPriceTable = {
      50: {50:16.41,60:17.95,70:19.48,80:21.00,90:22.54,100:24.06,110:25.61,120:27.30,130:28.77,140:30.22,150:31.73},
      60: {50:17.08,60:18.67,70:20.27,80:21.85,90:23.44,100:25.02,110:26.63,120:28.40,130:29.93,140:31.41,150:32.98},
      70: {50:17.75,60:19.40,70:21.05,80:22.69,90:24.34,100:25.98,110:27.65,120:29.51,130:31.08,140:32.61,150:34.23},
      80: {50:18.42,60:20.13,70:21.84,80:23.53,90:25.24,100:26.94,110:28.67,120:30.61,130:32.23,140:33.81,150:35.49},
      90: {50:19.09,60:20.86,70:22.63,80:24.38,90:26.15,100:27.90,110:29.70,120:31.72,130:33.39,140:35.00,150:36.74},
      100: {50:19.76,60:21.58,70:23.41,80:25.22,90:27.05,100:28.86,110:30.72,120:32.82,130:34.54,140:36.20,150:37.99},
      110: {50:20.43,60:22.31,70:24.20,80:26.06,90:27.95,100:29.82,110:31.74,120:33.93,130:35.69,140:37.40,150:39.24},
      120: {50:21.10,60:23.04,70:24.98,80:26.91,90:28.85,100:30.78,110:32.76,120:35.04,130:36.85,140:38.60,150:40.50},
      130: {50:21.77,60:23.77,70:25.77,80:27.75,90:29.75,100:31.74,110:33.78,120:36.14,130:38.00,140:39.79,150:41.75},
      140: {50:22.43,60:24.49,70:26.55,80:28.59,90:30.65,100:32.69,110:34.79,120:37.24,130:39.14,140:40.98,150:42.99},
      150: {50:23.10,60:25.22,70:27.34,80:29.44,90:31.56,100:33.66,110:35.82,120:38.35,130:40.31,140:42.19,150:44.26},
      160: {50:23.77,60:25.94,70:28.12,80:30.28,90:32.45,100:34.61,110:36.83,120:39.45,130:41.45,140:43.37,150:45.50},
      170: {50:24.44,60:26.68,70:28.92,80:31.13,90:33.36,100:35.58,110:37.86,120:40.56,130:42.61,140:44.58,150:46.76},
      180: {50:25.11,60:27.40,70:29.70,80:31.97,90:34.27,100:36.54,110:38.88,120:41.67,130:43.77,140:45.78,150:48.01},
      190: {50:25.78,60:28.13,70:30.49,80:32.81,90:35.17,100:37.50,110:39.90,120:42.77,130:44.92,140:46.98,150:49.27},
      200: {50:26.45,60:28.85,70:31.27,80:33.65,90:36.06,100:38.45,110:40.92,120:43.87,130:46.06,140:48.16,150:50.51},
      210: {50:27.12,60:29.59,70:32.06,80:34.50,90:36.97,100:39.42,110:41.94,120:44.98,130:47.23,140:49.37,150:51.77},
      220: {50:27.78,60:30.31,70:32.84,80:35.34,90:37.87,100:40.37,110:42.96,120:46.08,130:48.37,140:50.56,150:53.01},
      230: {50:28.46,60:31.04,70:33.63,80:36.19,90:38.78,100:41.34,110:46.28,120:47.19,130:49.53,140:51.76,150:54.28}
    };
    const roloPlusFabricCoeff = { "1":1.0, "2":1.1, "3":1.3, "4":1.4, "5":1.5 };
    const roloPlusCoeff = {
      'Yildiz': { white: 1, brown: 1.05, anthracite: 1.05, 'golden_oak': 1.3, walnut: 1.3 },
      'Yildiz Sedef': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Panama': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Panama Pearl': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Line Harmony': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Mat Linen': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Yildiz Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Yildiz Blackout Sedef': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Focus Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Focus Sedef Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Monaco Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Lugano Blackout': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Pes Screen': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'YS Screen': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Glarus': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Uster': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Lancy': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Basel Blackout': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'KS Screen': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'CS Screen': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'Blackout Screen': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 }
    };
    const dnnPlusPriceTable = {
      50: {50:18.13,60:19.94,70:21.87,80:23.56,90:25.40,100:27.09,110:29.06,120:30.69,130:32.65,140:34.40,150:36.06},
      60: {50:18.91,60:20.76,70:22.77,80:24.55,90:26.49,100:28.24,110:30.26,120:31.98,130:34.00,140:35.85,150:37.57},
      70: {50:19.66,60:21.59,70:23.77,80:25.55,90:27.57,100:29.38,110:31.50,120:33.25,130:35.39,140:37.32,150:39.07},
      80: {50:20.41,60:22.52,70:24.67,80:26.54,90:28.65,100:30.50,110:32.73,120:34.54,130:36.78,140:38.77,150:40.58},
      90: {50:21.19,60:23.27,70:25.60,80:27.53,90:29.71,100:31.64,110:33.97,120:35.81,130:38.16,140:40.22,150:42.09},
      100: {50:21.91,60:24.12,70:26.56,80:28.53,90:30.79,100:32.78,110:35.20,120:37.10,130:39.55,140:41.66,150:43.60},
      110: {50:22.69,60:24.96,70:27.47,80:29.52,90:31.88,100:33.90,110:36.44,120:38.40,130:40.94,140:43.14,150:45.10},
      120: {50:23.48,60:25.80,70:28.43,80:30.51,90:32.96,100:35.04,110:37.67,120:39.66,130:42.32,140:44.59,150:46.61},
      130: {50:24.20,60:26.89,70:29.36,80:31.51,90:34.01,100:36.19,110:38.91,120:40.96,130:43.71,140:46.03,150:48.21},
      140: {50:24.98,60:27.46,70:30.42,80:32.50,90:35.10,100:37.30,110:40.14,120:42.22,130:45.09,140:47.57,150:49.65},
      150: {50:25.73,60:28.27,70:31.23,80:33.49,90:36.18,100:38.45,110:41.38,120:43.52,130:46.45,140:49.02,150:51.10},
      160: {50:26.48,60:29.26,70:32.16,80:34.49,90:37.26,100:39.59,110:42.61,120:44.82,130:47.84,140:50.46,150:52.70},
      170: {50:27.26,60:29.95,70:33.09,80:35.48,90:38.35,100:40.70,110:43.85,120:46.08,130:49.22,140:51.91,150:54.14},
      180: {50:28.01,60:30.94,70:34.09,80:36.47,90:39.40,100:41.85,110:45.08,120:47.38,130:50.61,140:53.36,150:55.65},
      190: {50:28.80,60:31.64,70:34.93,80:37.47,90:40.49,100:42.99,110:46.29,120:48.67,130:52.12,140:54.80,150:57.19},
      200: {50:29.55,60:32.48,70:35.92,80:38.46,90:41.57,100:44.11,110:47.52,120:49.97,130:53.41,140:56.25,150:58.79},
      210: {50:30.33,60:33.32,70:36.76,80:39.45,90:42.65,100:45.25,110:48.76,120:51.26,130:54.86,140:57.70,150:60.23},
      220: {50:31.08,60:34.16,70:37.76,80:40.44,90:43.71,100:46.40,110:49.99,120:52.50,130:56.30,140:59.14,150:61.68},
      230: {50:31.86,60:35.00,70:38.69,80:41.44,90:44.79,100:47.51,110:51.23,120:53.85,130:57.60,140:60.74,150:63.28}
    };
    const dnnPlusFabricCoeff = { "1":1.0, "2":1.1, "3":1.2, "4":1.3, "5":1.4, "6":1.5, "7":1.6 };
    const dnnPlusCoeff = {
      'Eco Series': { white: 1, brown: 1.05, anthracite: 1.05, 'golden_oak': 1.3, walnut: 1.3 },
      'Modern Décor': { white: 1, brown: 1.05, anthracite: 1.05, 'golden_oak': 1.3, walnut: 1.3 },
      'Modern Decor': { white: 1, brown: 1.05, anthracite: 1.05, 'golden_oak': 1.3, walnut: 1.3 },
      'Charm GE': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Charm GK': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'Charm AS': { white: 1.1, brown: 1.15, anthracite: 1.15, 'golden_oak': 1.4, walnut: 1.4 },
      'St.Galen': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Montana': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Montaro': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Urban': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Rare': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Keten': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Craft': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Raw': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Nature': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Natural': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Tiffany': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Piriti': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Bamboo Curtain': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'New Wave': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Versa': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Best': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Arbon': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Kugel': { white: 1.2, brown: 1.25, anthracite: 1.25, 'golden_oak': 1.5, walnut: 1.5 },
      'Passion': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Imagine': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Eden': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Pearl': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Smart': { white: 1.3, brown: 1.35, anthracite: 1.35, 'golden_oak': 1.6, walnut: 1.6 },
      'Baskili Zebra TD': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'Baskili Zebra PL5': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'Baskili Zebra PLS': { white: 1.4, brown: 1.45, anthracite: 1.45, 'golden_oak': 1.7, walnut: 1.7 },
      'Blackout': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 },
      'Keten Baskili': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 },
      'Pelmo': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 },
      'Peimo': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 },
      'Nordern': { white: 1.5, brown: 1.55, anthracite: 1.55, 'golden_oak': 1.8, walnut: 1.8 },
      'Biel Blackout': { white: 1.6, brown: 1.65, anthracite: 1.65, 'golden_oak': 1.9, walnut: 1.9 },
      'Bonn Blackout': { white: 1.6, brown: 1.65, anthracite: 1.65, 'golden_oak': 1.9, walnut: 1.9 }
    };
    const roletniSeries = {
      yildiz_m: { price: 10.50, label: "YILDIZ SERİSİ (Mat Polyester)" },
      yildiz_color: { price: 10.50, label: "YILDIZ SERİSİ (Renkli)" },
      yildiz_sedef: { price: 11.50, label: "YILDIZ SEDEF SERİSİ" },
      panama: { price: 11.50, label: "PANAMA SERİSİ" },
      panama_pearl: { price: 13.50, label: "PANAMA PEARL SERİSİ" },
      mat_linen: { price: 9.18, label: "MAT LINEN SERİSİ" },
      line_harmony: { price: 9.50, label: "LINE HARMONY SERİSİ" },
      glarus: { price: 12.86, label: "GLARUS SERİSİ" },
      lancy: { price: 14.69, label: "LANCY SERİSİ" },
      yildiz_blackout: { price: 15.50, label: "YILDIZ BLACKOUT SERİSİ" },
      yildiz_blackout_sedef: { price: 16.50, label: "YILDIZ BLACKOUT SEDEF SERİSİ" },
      focus_blackout: { price: 15.50, label: "FOCUS BLACKOUT SERİSİ" },
      focus_sedef_blackout: { price: 17.50, label: "FOCUS SEDEF BLACKOUT SERİSİ" },
      monaco_blackout: { price: 19.00, label: "MONACO BLACKOUT SERİSİ" },
      lugano_blackout: { price: 19.00, label: "LUGANO BLACKOUT SERİSİ" },
      uster_blackout: { price: 15.48, label: "USTER BLACKOUT SERİSİ" },
      basel_blackout: { price: 24.50, label: "BASEL BLACKOUT SERİSİ" },
      blackout_screen: { price: 29.50, label: "BLACKOUT SCREEN SERİSİ" },
      pes_screen: { price: 18.50, label: "PES SCREEN SERİSİ" },
      ys_screen: { price: 20.50, label: "YS SCREEN BLACKOUT" },
      sun_screen: { price: 29.00, label: "SUN SCREEN ORJ." },
      ks_screen: { price: 16.53, label: "KS SCREEN SERİSİ" },
      cs_screen: { price: 16.85, label: "CS SCREEN SERİSİ" }
    };
    const roletniExtras = {
      box_closed: { value: 4.56, type: "per_meter", label: "Затворена кутия (+4.56 €/л.м.)" },
      box_fabric: { value: 13.44, type: "per_meter", label: "Кутия с плат (+13.44 €/л.м.)" },
      jumbo38: { value: 4.56, type: "per_meter", label: "Джъмбо механизъм 38mm (+4.56 €/л.м.)" },
      jumbo47: { value: 6.78, type: "per_meter", label: "Джъмбо механизъм 47mm (+6.78 €/л.м.)" },
      chain_metal: { value: 3.42, type: "per_piece", label: "Метална верижка (+3.42 €/бр)" }
    };
    const dayNightSeries = {
      eco: { price: 13.50, label: "ECO SERİSİ" },
      modern: { price: 14.00, label: "MODERN DECOR" },
      charm_ge: { price: 15.00, label: "CHARM GE SERİSİ" },
      charm_gk: { price: 15.00, label: "CHARM GK SERİSİ" },
      charm_as: { price: 15.00, label: "CHARM AS SERİSİ" },
      eden: { price: 11.02, label: "EDEN SERİSİ" },
      imagine: { price: 11.49, label: "IMAGINE SERİSİ" },
      smart: { price: 13.18, label: "SMART SERİSİ" },
      st_gallen: { price: 20.50, label: "ST. GALLEN SERİSİ" },
      montaro: { price: 18.50, label: "MONTARO SERİSİ" },
      bamboo_curtain: { price: 14.55, label: "BAMBOO CURTAIN" },
      passion: { price: 14.69, label: "PASSION SERİSİ" },
      baskili_duz: { price: 15.01, label: "BASKILI ZEBRA DÜZ" },
      arbon: { price: 15.01, label: "ARBON SERİSİ" },
      kugel: { price: 15.01, label: "KUGEL SERİSİ" },
      urban: { price: 20.50, label: "URBAN SERİSİ" },
      rare: { price: 20.50, label: "RARE SERİSİ" },
      keten_craft: { price: 20.50, label: "KETEN CRAFT" },
      new_wave: { price: 15.31, label: "NEW WAVE SERİSİ" },
      pearl: { price: 15.62, label: "PEARL SERİSİ" },
      raw: { price: 20.50, label: "RAW SERİSİ" },
      naturel: { price: 20.50, label: "NATUREL SERİSİ" },
      tiffany: { price: 20.50, label: "TIFFANY SERİSİ" },
      pirilti: { price: 20.50, label: "PIRILTI SERİSİ" },
      versa: { price: 20.50, label: "VERSA SERİSİ" },
      best: { price: 20.50, label: "BEST SERİSİ" },
      blackout: { price: 15.92, label: "BLACKOUT SERİSİ" },
      pelmo: { price: 16.24, label: "PELMO SERİSİ" },
      nordend: { price: 17.61, label: "NORDEND SERİSİ" },
      baskili_td: { price: 17.61, label: "BASKLI ZEBRA TD SERİSİ" },
      baskili_pls: { price: 19.30, label: "BASKILI ZEBRA PLS SERİSİ" },
      biel_blackout: { price: 19.30, label: "BİEL BLACKOUT SERİSİ" },
      keten_baskili_pls: { price: 21.13, label: "KETEN BASKILI PLS SERİSİ" },
      bonn_blackout: { price: 21.43, label: "BONN BLACKOUT SERİSİ" },
      silhouette: { price: 34.60, label: "BANTLI SİLÜЕТ BR SERİSİ" }
    };
    const dayNightExtras = roletniExtras;
    const doubleRoloExtras = roletniExtras;
    const doubleRoloSeries = {
      yo: { price: 12.00, label: "YO SER." },
      rte: { price: 11.50, label: "RTE SER." },
      yt: { price: 13.50, label: "YT SER." },
      beauty: { price: 15.50, label: "BEAUTY SERİSİ" },
      elite: { price: 15.50, label: "ELITE SERİSİ" },
      kl: { price: 15.50, label: "KL SERİSİ" },
      st: { price: 15.50, label: "ST SERİSİ" },
      linda: { price: 17.00, label: "LINDA SERİSİ" }
    };
    const pliseSeries = {
      diamond: { price: 13.50, label: "DIAMOND" },
      blackout: { price: 27.00, label: "BLACKOUT" },
      tulle: { price: 13.50, label: "TULLE" },
      lund: { price: 15.50, label: "LUND" },
      nora: { price: 15.50, label: "NORA" },
      hanko: { price: 15.50, label: "HANKO" },
      etna: { price: 19.50, label: "ETNA" },
      rio: { price: 18.50, label: "RIO" },
      randers: { price: 23.50, label: "RANDERS" },
      honeycomb: { price: 29.50, label: "HONEYCOMB" },
      lizbon: { price: 20.50, label: "LIZBON" },
      toronto: { price: 15.50, label: "TORONTO" },
      dublin: { price: 17.50, label: "DUBLIN" },
      milano: { price: 18.50, label: "MILANO" }
    };
    const pliseExtras = {
      clip_profile: { value: 3.00, label: "Цял профил + клипсове (+3.00 €/m²)" },
      tape_profile: { value: 3.00, label: "Цял профил + двойнозалепващо (+3.00 €/m²)" }
    };
    // Цени за нормални потребители (2026)
    const perdeSeries = {
      dt: { price: 20.50, label: "DT" },
      nd: { price: 21.00, label: "ND" },
      "dj-i": { price: 21.00, label: "DJ-I" },
      "dj-e": { price: 21.00, label: "DJ-E" },
      "dj-d": { price: 21.00, label: "DJ-D" },
      sm: { price: 21.00, label: "SM" },
      br: { price: 21.00, label: "BR" },
      mc: { price: 23.50, label: "MC (тесни платове)" },
      smf: { price: 24.00, label: "SMF" },
      jp: { price: 33.50, label: "JP VERDUO (цв.печат)" }
    };
    
    // Цени за потребител "dist" (2026)
    const perdeSeriesDist = {
      dt: { price: 20.50, label: "DT" },
      nd: { price: 21.00, label: "ND" },
      "dj-i": { price: 21.00, label: "DJ-I" },
      "dj-e": { price: 21.00, label: "DJ-E" },
      "dj-d": { price: 21.00, label: "DJ-D" },
      sm: { price: 21.00, label: "SM" },
      br: { price: 21.00, label: "BR" },
      mc: { price: 23.50, label: "MC (тесни платове)" },
      smf: { price: 24.00, label: "SMF" },
      jp: { price: 33.50, label: "JP VERDUO (цв.печат)" }
    };
    const _perdeColorHex = ["#FDFDFD","#F2F1EE","#ECEBD8","#D6D4C4","#C4CBB8","#CCC89D","#A89B7A","#A89389","#939486","#9E9280","#5B3C3C","#B7BDC1","#BFB7C1","#8A8F90","#696969","#858890","#54565B","#303135","#1F2024","#161616","#DFCBDA","#DCA6CE","#5F1A4D","#BEA801","#A59730","#FA832F","#D6EFE9","#5C8952","#43653B","#058AA4","#024F5F","#6B0E0E"];
    function _perdePalette(prefix) {
      return _perdeColorHex.map(function(hex, i) { var n = String(i + 1).padStart(2, "0"); return { code: prefix + "-" + n, name: "", color: hex }; });
    }
    const _djPaletteHex = ["#F9F9F7","#EBE6E1","#EEDDD6","#B2A8A2","#8C7769","#6A4E3F","#A3A4A3","#C6A44A","#6F3A6F","#AE97A5","#C6B2C0","#6495ED","#3B67B0","#57636D","#3D3332"];
    function _djPalette(prefix) {
      return _djPaletteHex.map(function(hex, i) { var n = String(i + 1).padStart(2, "0"); return { code: prefix + "-" + n, name: "", color: hex }; });
    }
    const _smPaletteHex = ["#FAFAFA","#FFF8DC","#E0E0E0","#FAFAFA","#FAFAFA","#1E0A1E","#FAFAFA","#E8B4B8","#FAFAFA","#FAFAFA","#191970","#5C4033","#FF8C00","#FFD700","#556B2F","#FAFAFA","#FAFAFA","#D2B48C","#000000","#FAFAFA","#2F4F4F","#FAFAFA","#87CEEB","#E6A8D7","#808080","#B8B8E0","#FAFAFA"];
    function _smPalette(prefix) {
      return _smPaletteHex.map(function(hex, i) { var n = String(i + 1).padStart(2, "0"); return { code: prefix + "-" + n, name: "", color: hex }; });
    }
    const _smfPaletteHex = ["#F0F0F0","#B8B8B8","#E8D4C4","#5C4033","#2F4F4F","#787878","#FFFFFF","#FFF8DC","#BDB86B","#FFFFFF","#B0B0B0","#D2B48C","#8B7355","#FFFFFF","#1A2E1A","#F5E6F0","#E8C4D8","#9370DB","#4A3A4A","#B87070","#FFD700","#FF8C00","#1E90FF","#20B2AA","#556B2F","#228B22","#3D4A3D","#DC143C","#6B0E0E","#000000"];
    function _smfPalette(prefix) {
      return _smfPaletteHex.map(function(hex, i) { var n = String(i + 1).padStart(2, "0"); return { code: prefix + "-" + n, name: "", color: hex }; });
    }
    const perdeSeriesColors = {
      dt: [
        { code: "DT-01", name: "", color: "#FFFFFF" },
        { code: "DT-02", name: "", color: "#FFFBF0" },
        { code: "DT-03", name: "", color: "#3D2E1F" },
        { code: "DT-04", name: "", color: "#F0E0EC" },
        { code: "DT-05", name: "", color: "#FF8C00" },
        { code: "DT-06", name: "", color: "#000000" },
        { code: "DT-07", name: "", color: "#F5F0E0" },
        { code: "DT-08", name: "", color: "#D4E8B0" },
        { code: "DT-09", name: "", color: "#8B6914" },
        { code: "DT-10", name: "", color: "#B8860B" },
        { code: "DT-11", name: "", color: "#87CEEB" },
        { code: "DT-12", name: "", color: "#6A5ACD" },
        { code: "DT-13", name: "", color: "#FFFACD" },
        { code: "DT-14", name: "", color: "#FFD700" },
        { code: "DT-15", name: "", color: "#E8A317" },
        { code: "DT-16", name: "", color: "#CD5C5C" },
        { code: "DT-17", name: "", color: "#FFE4EC" },
        { code: "DT-18", name: "", color: "#E8A0B0" },
        { code: "DT-19", name: "", color: "#8B008B" },
        { code: "DT-20", name: "", color: "#4A0A4A" },
        { code: "DT-21", name: "", color: "#B8A0C8" },
        { code: "DT-22", name: "", color: "#E0F7FA" },
        { code: "DT-23", name: "", color: "#B0C4DE" },
        { code: "DT-24", name: "", color: "#3D4A2E" },
        { code: "DT-25", name: "", color: "#6B7A4A" },
        { code: "DT-26", name: "", color: "#228B22" },
        { code: "DT-27", name: "", color: "#20B2AA" },
        { code: "DT-28", name: "", color: "#40E0D0" },
        { code: "DT-29", name: "", color: "#48D1CC" },
        { code: "DT-30", name: "", color: "#2F4F4F" },
        { code: "DT-31", name: "", color: "#191970" },
        { code: "DT-32", name: "", color: "#800020" },
        { code: "DT-33", name: "", color: "#FFFFFF" },
        { code: "DT-34", name: "", color: "#C8B896" },
        { code: "DT-35", name: "", color: "#C8C0D8" },
        { code: "DT-36", name: "", color: "#2E1A0A" },
        { code: "DT-37", name: "", color: "#4A5568" },
        { code: "DT-38", name: "", color: "#2D3748" },
        { code: "DT-39", name: "", color: "#5C4033" },
        { code: "DT-40", name: "", color: "#E8E4E0" },
        { code: "DT-41", name: "", color: "#A0A0A0" },
        { code: "DT-42", name: "", color: "#708090" },
        { code: "DT-43", name: "", color: "#F5F5F5" }
      ],
      nd: [
        { code: "ND-01", name: "", color: "#FAFAF9" },
        { code: "ND-02", name: "", color: "#FFF8E0" },
        { code: "ND-03", name: "", color: "#E8E4F0" },
        { code: "ND-04", name: "", color: "#7A7685" },
        { code: "ND-05", name: "", color: "#4A4A38" },
        { code: "ND-06", name: "", color: "#E0E0E0" },
        { code: "ND-07", name: "", color: "#D4A800" },
        { code: "ND-08", name: "", color: "#FFFFFF" },
        { code: "ND-09", name: "", color: "#E8E0EC" },
        { code: "ND-10", name: "", color: "#FFFFFF" },
        { code: "ND-11", name: "", color: "#5A8B7A" },
        { code: "ND-12", name: "", color: "#1A2F4A" },
        { code: "ND-13", name: "", color: "#000000" },
        { code: "ND-14", name: "", color: "#D4C4A8" },
        { code: "ND-15", name: "", color: "#D0B898" },
        { code: "ND-16", name: "", color: "#B8864A" },
        { code: "ND-17", name: "", color: "#B0B0B0" },
        { code: "ND-18", name: "", color: "#2C2C2C" },
        { code: "ND-19", name: "", color: "#A00A2E" },
        { code: "ND-20", name: "", color: "#FF6600" },
        { code: "ND-21", name: "", color: "#8FBC00" },
        { code: "ND-22", name: "", color: "#2D5016" },
        { code: "ND-23", name: "", color: "#1E3A5F" },
        { code: "ND-24", name: "", color: "#6B0E0E" },
        { code: "ND-25", name: "", color: "#707070" },
        { code: "ND-26", name: "", color: "#FFFFFF" }
      ],
      "dj-i": _djPalette("DJ-I"),
      "dj-e": _djPalette("DJ-E"),
      "dj-d": _djPalette("DJ-D"),
      sm: _smPalette("SM"),
      smf: _smfPalette("SMF"),
      jp: _perdePalette("JP"),
      br: [
        { code: "BR-01", name: "", color: "#FDFDFD" },
        { code: "BR-02", name: "", color: "#F2F1EE" },
        { code: "BR-03", name: "", color: "#ECEBD8" },
        { code: "BR-04", name: "", color: "#D6D4C4" },
        { code: "BR-05", name: "", color: "#C4CBB8" },
        { code: "BR-06", name: "", color: "#CCC89D" },
        { code: "BR-07", name: "", color: "#A89B7A" },
        { code: "BR-08", name: "", color: "#A89389" },
        { code: "BR-09", name: "", color: "#939486" },
        { code: "BR-10", name: "", color: "#9E9280" },
        { code: "BR-11", name: "", color: "#5B3C3C" },
        { code: "BR-12", name: "", color: "#B7BDC1" },
        { code: "BR-13", name: "", color: "#BFB7C1" },
        { code: "BR-14", name: "", color: "#8A8F90" },
        { code: "BR-15", name: "", color: "#696969" },
        { code: "BR-16", name: "", color: "#858890" },
        { code: "BR-17", name: "", color: "#54565B" },
        { code: "BR-18", name: "", color: "#303135" },
        { code: "BR-19", name: "", color: "#1F2024" },
        { code: "BR-20", name: "", color: "#161616" },
        { code: "BR-21", name: "", color: "#DFCBDA" },
        { code: "BR-22", name: "", color: "#DCA6CE" },
        { code: "BR-23", name: "", color: "#5F1A4D" },
        { code: "BR-24", name: "", color: "#BEA801" },
        { code: "BR-25", name: "", color: "#A59730" },
        { code: "BR-26", name: "", color: "#FA832F" },
        { code: "BR-27", name: "", color: "#D6EFE9" },
        { code: "BR-28", name: "", color: "#5C8952" },
        { code: "BR-29", name: "", color: "#43653B" },
        { code: "BR-30", name: "", color: "#058AA4" },
        { code: "BR-31", name: "", color: "#024F5F" },
        { code: "BR-32", name: "", color: "#6B0E0E" }
      ],
      mc: _perdePalette("MC")
    };
    
    // Функция за получаване на правилните цени в зависимост от потребителя
    function getPerdeSeries() {
      return currentUser === "distributor1" ? perdeSeriesDist : perdeSeries;
    }
    
    // Функции за получаване на максималните размери от таблиците
    function getMaxDimensions(priceTable) {
      const heights = Object.keys(priceTable).map(Number).sort((a,b)=>a-b);
      const widths = Object.keys(priceTable[heights[0]]).map(Number).sort((a,b)=>a-b);
      return {
        maxHeight: Math.max(...heights),
        maxWidth: Math.max(...widths)
      };
    }
    
    // Максимални размери за всеки продукт
    const maxDimensions = {
      mini: getMaxDimensions(miniPriceTable), // height: 230, width: 150
      dn: getMaxDimensions(dnPriceTable), // height: 230, width: 150
      elegans: getMaxDimensions(elegansPriceTable), // height: 230, width: 150
      roloPlus: getMaxDimensions(roloPlusPriceTable), // height: 230, width: 150
      dnnPlus: getMaxDimensions(dnnPlusPriceTable), // height: 230, width: 150
      mosquito: { maxHeight: 230, maxWidth: 190 }, // Еднокрилен (17 височини, 15 ширини)
      mosquitoDouble: { maxHeight: 250, maxWidth: 260 }, // Двукрилен
      plise: { maxHeight: 350, maxWidth: 150 }, // Вече дефинирано
      roletni: { maxHeight: 300, maxWidth: 350 }, // Вече дефинирано
      dayNight: { maxHeight: 300, maxWidth: 350 }, // Вече дефинирано
      doubleRolo: { maxHeight: 300, maxWidth: 350 }, // Максимални размери
      perde: { maxHeight: 700, maxWidth: 600 } // Вече дефинирано
    };
    
    // Данни от Excel файла за максималните размери на платовете
    // stor = ролетни щори, tulStor = двойно роло, zebra = ден и нощ
    const fabricMaxDimensions = {
      stor: {
        "MAT LINEN": 260,
        "LINE HARMONY": 200,
        "GLARUS": 290,
        "BLACKOUT": 280,
        "YILDIZ": 300,
        "YILDIZ SEDEF": 300,
        "YILDIZ BLACKOUT": 300,
        "YILDIZ BLACKOUT SEDEF": 300,
        "PANAMA": 260,
        "PANAMA PEARL": 200,
        "LANCY": 300,
        "FOCUS BLACKOUT": 300,
        "FOCUS SEDEF BLACKOUT": 210,
        "MONACO BLACKOUT": 280,
        "LUGANO BLACKOUT": 200,
        "USTER BLACKOUT": 300,
        "BASEL BLACKOUT": 300,
        "BLACKOUT SCREEN": 300,
        "PES SCREEN": 300,
        "PES. SCREEN": 300,
        "SUN SCREEN": 300,
        "SIMPLE": 320,
        "TREND": 280,
        "PELMO": 280,
        "RODI": 280,
        "STİL": 200,
        "JACQUARD": 200,
        "PEPLUM": 280,
        "BRODE CLAROS": 280,
        "BRODE": 280
      },
      tulStor: {
        "TÜL STOR RTE": 280,
        "TÜL STOR YT": 280,
        "TÜL STOR BEAUTY": 300,
        "TÜL STOR ELITE": 300,
        "TÜL STOR KL": 280,
        "TÜL STOR ST": 280,
        "TÜL STOR YS": 280,
        "TÜL STOR CL": 280,
        "TÜL STOR BO": 280
      },
      zebra: {
        "ECO": 300,
        "SMART": 300,
        "URBAN DS": 300,
        "MODERN DECOR": 300,
        "CHARM": 320,
        "NEW CHARM": 320,
        "EDEN": 320,
        "IMAGINE": 320,
        "MONTARO": 280,
        "BAMBOO CURTAIN": 280,
        "PASSION": 280,
        "ARBON": 280,
        "KUGEL": 280,
        "RARE SİM": 320,
        "RARE DS": 280,
        "KETEN CRAFT": 300,
        "NEW WAVE": 320,
        "ST GALLEN": 280,
        "ST. GALLEN": 280,
        "BASKILI ZEBRA DÜZ": 320,
        "BASKILI ZEBRA BS": 280
      }
    };
    
    // Мапинг между сериите в калкулатора и имената на платовете в Excel файла
    const fabricSeriesMapping = {
      roletni: {
        "mat_linen": "MAT LINEN",
        "line_harmony": "LINE HARMONY",
        "glarus": "GLARUS",
        "yildiz_m": "YILDIZ",
        "yildiz_color": "YILDIZ",
        "yildiz_sedef": "YILDIZ SEDEF",
        "panama": "PANAMA",
        "panama_pearl": "PANAMA PEARL",
        "lancy": "LANCY",
        "yildiz_blackout": "YILDIZ BLACKOUT",
        "yildiz_blackout_sedef": "YILDIZ BLACKOUT SEDEF",
        "focus_blackout": "FOCUS BLACKOUT",
        "focus_sedef_blackout": "FOCUS SEDEF BLACKOUT",
        "monaco_blackout": "MONACO BLACKOUT",
        "lugano_blackout": "LUGANO BLACKOUT",
        "uster_blackout": "USTER BLACKOUT",
        "basel_blackout": "BASEL BLACKOUT",
        "blackout_screen": "BLACKOUT",
        "pes_screen": "PES SCREEN",
        "sun_screen": "SUN SCREEN",
        "simple": "SIMPLE",
        "trend": "TREND",
        "pelmo": "PELMO",
        "rodi": "RODI",
        "stil": "STİL",
        "jacquard": "JACQUARD",
        "peplum": "PEPLUM",
        "brode_claros": "BRODE CLAROS"
      },
      doubleRolo: {
        "yo": "TÜL STOR YO",
        "rte": "TÜL STOR RTE",
        "yt": "TÜL STOR YT",
        "beauty": "TÜL STOR BEAUTY",
        "elite": "TÜL STOR ELITE",
        "kl": "TÜL STOR KL",
        "st": "TÜL STOR ST",
        "linda": "TÜL STOR YS" // Приблизително
      },
      dayNight: {
        "eco": "ECO",
        "smart": "SMART",
        "urban": "URBAN DS",
        "modern": "MODERN DECOR",
        "charm_ge": "CHARM",
        "charm_gk": "CHARM",
        "charm_as": "CHARM",
        "eden": "EDEN",
        "imagine": "IMAGINE",
        "montaro": "MONTARO",
        "bamboo_curtain": "BAMBOO CURTAIN",
        "passion": "PASSION",
        "arbon": "ARBON",
        "kugel": "KUGEL",
        "rare": "RARE SİM",
        "keten_craft": "KETEN CRAFT",
        "new_wave": "NEW WAVE",
        "st_gallen": "ST GALLEN",
        "baskili_duz": "BASKILI ZEBRA DÜZ"
      }
    };
    
    // Функция за получаване на максималните размери на плата от Excel файла
    function getFabricMaxDimensions(type, seriesKey) {
      const mapping = fabricSeriesMapping[type];
      if (!mapping || !mapping[seriesKey]) return null;
      
      const fabricName = mapping[seriesKey];
      // Преобразуване на типа: roletni -> stor, doubleRolo -> tulStor, dayNight -> zebra
      let fabricType = type;
      if (type === "roletni") fabricType = "stor";
      else if (type === "doubleRolo") fabricType = "tulStor";
      else if (type === "dayNight") fabricType = "zebra";
      
      const fabricData = fabricMaxDimensions[fabricType];
      if (!fabricData || !fabricData[fabricName]) return null;
      
      return {
        maxWidth: fabricData[fabricName],
        maxHeight: fabricType === "zebra" ? null : fabricData[fabricName] // За zebra само ширината
      };
    }
    
    // Функция за актуализиране на таблицата с цени за Перде-Щора
    function updatePerdePriceTable() {
      const table = document.getElementById("perde-price-table");
      if (!table) return;
      
      const series = getPerdeSeries();
      const seriesOrder = ["dt", "nd", "dj-i", "dj-e", "dj-d", "sm", "br", "mc", "smf", "jp"];
      const deadlines = {
        dt: "7-10 р.дни",
        nd: "7-10 р.дни",
        "dj-i": "7-10 р.дни",
        "dj-e": "7-10 р.дни",
        "dj-d": "7-10 р.дни",
        sm: "7-10 р.дни",
        br: "7-10 р.дни",
        mc: "7-10 р.дни",
        smf: "7-10 р.дни",
        jp: "15-20 р.дни"
      };
      
      // Запазваме header-а
      let html = '<tr><th>Серия</th><th>Цена (€)</th><th>Ед.</th><th>Срок</th></tr>';
      
      // Добавяме редовете
      seriesOrder.forEach(key => {
        if (series[key]) {
          html += `<tr><td>${series[key].label}</td><td>${series[key].price.toFixed(2)}</td><td>M²</td><td>${deadlines[key]}</td></tr>`;
        }
      });
      
      table.innerHTML = html;
    }
    function updateRoletniPriceTable() {
      const table = document.getElementById("roletni-price-table");
      if (!table) return;
      let html = "<tr><th>Серия</th><th>Цена (€)</th><th>Ед.</th><th>Срок</th></tr>";
      Object.keys(roletniSeries).sort((a,b) => (roletniSeries[a].label || "").localeCompare(roletniSeries[b].label || "")).forEach(key => {
        const s = roletniSeries[key];
        html += `<tr><td>${s.label}</td><td>${s.price.toFixed(2)}</td><td>m²</td><td>7-10 р.дни</td></tr>`;
      });
      table.innerHTML = html;
    }
    function updateDayNightPriceTable() {
      const table = document.getElementById("daynight-price-table");
      if (!table) return;
      let html = "<tr><th>Серия</th><th>Цена (€)</th><th>Ед.</th><th>Срок</th></tr>";
      Object.keys(dayNightSeries).sort((a,b) => (dayNightSeries[a].label || "").localeCompare(dayNightSeries[b].label || "")).forEach(key => {
        const s = dayNightSeries[key];
        html += `<tr><td>${s.label}</td><td>${s.price.toFixed(2)}</td><td>m²</td><td>7-10 р.дни</td></tr>`;
      });
      table.innerHTML = html;
    }
    function updateDoubleRoloPriceTable() {
      const table = document.getElementById("double-rolo-price-table");
      if (!table) return;
      let html = "<tr><th>Серия</th><th>Цена (€)</th><th>Ед.</th><th>Срок</th></tr>";
      Object.keys(doubleRoloSeries).forEach(key => {
        const s = doubleRoloSeries[key];
        html += `<tr><td>${s.label}</td><td>${s.price.toFixed(2)}</td><td>m²</td><td>7-10 р.дни</td></tr>`;
      });
      table.innerHTML = html;
    }
    function updatePlisePriceTable() {
      const table = document.getElementById("plise-price-table");
      if (!table) return;
      let html = "<tr><th>Серия</th><th>Цена (€)</th><th>Ед.</th><th>Срок</th></tr>";
      Object.keys(pliseSeries).forEach(key => {
        const s = pliseSeries[key];
        html += `<tr><td>${s.label}</td><td>${s.price.toFixed(2)}</td><td>m²</td><td>7-10 р.дни</td></tr>`;
      });
      table.innerHTML = html;
    }
     const singleWhite = [
      ["28.0","28.7","30.1","30.8","32.2","32.9","34.3","35.0","36.4","37.1","38.5","39.2","40.6","41.3","42.7"],
      ["29.4","30.8","31.5","32.9","33.6","35.0","35.7","37.1","37.8","39.2","39.9","41.3","42.0","43.4","44.1"],
      ["30.8","32.2","32.9","34.3","35.7","36.4","37.8","38.5","39.9","40.6","42.0","42.7","44.1","44.8","46.2"],
      ["32.9","33.6","35.0","35.7","37.1","37.8","39.2","39.9","41.3","42.0","43.4","44.1","45.5","46.9","47.6"],
      ["34.3","35.7","36.4","37.8","38.5","39.9","40.6","42.0","42.7","44.1","44.8","46.2","46.9","48.3","49.0"],
      ["36.4","37.1","38.5","39.2","40.6","41.3","42.7","43.4","44.8","45.5","46.9","47.6","49.0","49.7","51.1"],
      ["37.8","39.2","39.9","41.3","42.0","43.4","44.1","45.5","46.2","47.6","48.3","49.7","50.4","51.8","52.5"],
      ["39.2","40.6","41.3","42.7","43.4","44.8","45.5","46.9","47.6","49.0","50.4","51.1","52.5","53.2","54.6"],
      ["41.3","42.0","43.4","44.1","45.5","46.2","47.6","48.3","49.7","50.4","51.8","52.5","53.9","54.6","56.0"],
      ["42.7","44.1","44.8","46.2","46.9","48.3","49.0","50.4","51.1","52.5","53.2","54.6","55.3","56.7","57.4"],
      ["44.8","45.5","46.9","47.6","49.0","49.7","51.1","51.8","53.2","53.9","55.3","56.0","57.4","58.1","59.5"],
      ["46.2","46.9","48.3","49.0","50.4","51.1","52.5","53.9","54.6","56.0","56.7","58.1","58.8","60.2","60.9"],
      ["47.6","49.0","49.7","51.1","51.8","53.2","53.9","55.3","56.0","57.4","58.1","59.5","60.9","61.6","63.0"],
      ["49.7","50.4","51.8","52.5","53.9","54.6","56.0","56.7","58.1","58.8","60.2","60.9","62.3","63.0","64.4"],
      ["51.1","52.5","53.2","54.6","55.3","56.7","57.4","58.8","59.5","60.9","61.6","63.0","63.7","65.1","65.8"],
      ["52.5","53.9","55.3","56.0","57.4","58.1","59.5","60.2","61.6","62.3","63.7","64.4","65.8","66.5","67.9"],
      ["54.6","55.3","56.7","57.4","58.8","59.5","60.9","61.6","63.0","64.4","65.1","66.5","67.2","68.6","69.3"]
    ];
    const doubleWhite = [
      ["41,44", "42,46", "43,49", "44,56", "45,65", "46,76", "47,90", "49,07", "50,27", "51,50", "52,76", "54,06", "55,38", "56,74", "58,13"],
      ["42,63", "43,68", "44,75", "45,85", "46,98", "48,14", "49,32", "50,54", "51,78", "53,05", "54,36", "55,70", "57,08", "58,48", "59,93"],
      ["43,87", "44,96", "46,07", "47,21", "48,38", "49,57", "50,80", "51,06", "53,35", "54,67", "56,03", "57,42", "58,84", "60,31", "61,81"],
      ["45,16", "46,29", "47,44", "48,62", "49,83", "51,08", "52,35", "53,65", "54,99", "56,36", "57,77", "59,21", "60,69", "62,21", "63,76"],
      ["46,51", "47,68", "48,88", "50,10", "51,36", "52,64", "53,96", "55,31", "56,70", "58,12", "59,58", "61,08", "62,62", "64,19", "65,81"],
      ["47,93", "49,13", "50,37", "51,64", "52,94", "54,28", "55,65", "57,05", "58,49", "59,97", "61,48", "63,03", "64,63", "66,26", "67,94"],
      ["49,40", "50,65", "51,94", "53,25", "54,60", "55,99", "57,41", "58,86", "60,35", "61,89", "63,46", "65,07", "66,73", "68,43", "70,17"],
      ["50,94", "52,24", "53,57", "54,93", "56,33", "57,77", "59,24", "60,75", "62,30", "63,89", "65,53", "67,20", "68,92", "70,68", "72,50"],
      ["52,54", "53,89", "55,27", "56,69", "58,14", "59,63", "61,16", "62,73", "64,34", "65,99", "67,68", "69,42", "71,21", "73,04", "74,93"],
      ["54,22", "55,62", "57,05", "58,52", "60,03", "61,57", "63,16", "64,79", "66,46", "68,18", "69,94", "71,74", "73,60", "75,50", "77,46"],
      ["55,97", "57,42", "58,90", "60,43", "62,00", "63,60", "65,25", "66,94", "68,68", "70,46", "72,29", "74,17", "76,09", "78,07", "80,11"]
    ];
    const singleColor = [
      ["29.4","30.1","31.5","32.2","33.6","35.0","35.7","37.1","37.8","39.2","40.6","41.3","42.7","43.4","44.8"],
      ["30.8","32.2","32.9","34.3","35.0","36.4","37.8","38.5","39.9","40.6","42.0","43.4","44.1","45.5","46.2"],
      ["32.9","33.6","35.0","35.7","37.1","38.5","39.2","40.6","41.3","42.7","44.1","44.8","46.2","46.9","48.3"],
      ["34.3","35.7","36.4","37.8","38.5","39.9","41.3","42.0","43.4","44.1","45.5","46.9","47.6","49.0","49.7"],
      ["36.4","37.1","38.5","39.2","40.6","42.0","42.7","44.1","44.8","46.2","47.6","48.3","49.7","50.4","51.8"],
      ["37.8","39.2","39.9","41.3","42.0","43.4","44.8","45.5","46.9","47.6","49.0","50.4","51.1","52.5","53.2"],
      ["39.9","40.6","42.0","42.7","44.1","45.5","46.2","47.6","48.3","49.7","51.1","51.8","53.2","53.9","55.3"],
      ["41.3","42.7","43.4","44.8","46.2","46.9","48.3","49.0","50.4","51.1","52.5","53.9","54.6","56.0","56.7"],
      ["43.4","44.1","45.5","46.2","47.6","49.0","49.7","51.1","51.8","53.2","54.6","55.3","56.7","57.4","58.8"],
      ["44.8","46.2","46.9","48.3","49.7","50.4","51.8","52.5","53.9","54.6","56.0","57.4","58.1","58.8","60.2"],
      ["46.9","47.6","49.0","49.7","51.1","52.5","53.2","54.6","55.3","56.7","58.1","58.8","60.2","60.2","62.3"],
      ["48.3","49.7","50.4","51.8","53.2","53.9","55.3","56.0","57.4","58.1","59.5","60.9","61.6","63.0","63.7"],
      ["50.4","51.1","52.5","53.2","54.6","56.0","56.7","58.1","58.8","63.7","65.1","65.8","63.7","64.4","65.8"],
      ["51.8","53.2","53.9","55.3","56.7","57.4","58.8","59.5","60.9","61.6","63.0","64.4","65.1","66.5","67.2"],
      ["53.9","54.6","56.0","56.7","58.1","59.5","60.2","61.6","62.3","63.7","65.1","65.8","67.2","67.9","69.3"],
      ["55.3","56.7","57.4","58.8","60.2","60.9","62.3","63.0","64.4","65.8","66.5","67.9","68.6","70.0","70.7"],
      ["57.4","58.1","59.5","60.2","61.6","63.0","63.7","65.1","65.8","67.2","68.6","69.3","70.7","71.4","72.8"]
    ];
    const doubleColor = [
      ["43.51","44.58","45.67","46.78","47.93","49.10","50.30","51.53","52.79","54.08","55.40","56.76","58.15","59.58","61.04"],
      ["44.76","45.86","46.99","48.15","49.33","50.54","51.79","53.06","54.37","55.71","57.08","58.49","59.93","61.41","62.93"],
      ["46.06","47.20","48.37","49.57","50.80","52.05","53.34","54.66","56.02","57.41","58.83","60.29","61.79","63.32","64.90"],
      ["47.42","48.60","49.81","51.05","52.33","53.63","54.97","56.33","57.74","59.18","60.66","62.17","63.72","65.32","66.95"],
      ["48.84","50.07","51.32","52.61","53.92","55.27","56.66","58.08","59.54","61.03","62.56","64.13","65.75","67.40","69.10"],
      ["50.32","51.59","52.89","54.22","55.59","56.99","58.43","59.90","61.41","62.96","64.55","66.18","67.86","69.58","71.34"],
      ["51.87","53.18","54.53","55.91","57.33","58.78","60.28","61.80","63.37","64.98","66.63","68.33","70.06","71.85","73.68"],
      ["53.48","54.85","56.25","57.68","59.15","60.66","62.20","63.79","65.42","67.09","68.80","70.56","72.37","74.22","76.12"],
      ["55.17","56.58","58.03","59.52","61.05","62.61","64.22","65.86","67.55","69.29","71.07","72.89","74.77","76.69","78.67"],
      ["56.93","58.40","59.90","61.44","63.03","64.65","66.32","68.03","69.78","71.58","73.43","75.33","77.28","79.28","81.33"],
      ["58.77","60.29","61.85","63.45","65.10","66.78","68.51","70.29","72.11","73.98","75.90","77.87","79.90","81.98","84.11"]
    ];
    const singleFlander = [
      ["32.9","34.3","35.7","37.1","38.5","39.9","40.6","42.0","43.4","44.8","46.2","46.9","48.3","49.7","51.1"],
      ["35.0","36.4","37.8","39.2","40.6","41.3","42.7","44.1","45.5","46.9","47.6","49.0","50.4","51.8","53.2"],
      ["37.1","38.5","39.9","41.3","42.0","43.4","44.8","46.2","47.6","49.0","49.7","51.1","52.5","53.9","55.3"],
      ["39.2","40.6","42.0","42.7","44.1","45.5","46.9","48.3","49.7","50.4","51.8","53.2","54.6","56.0","56.7"],
      ["41.3","42.7","44.1","44.8","46.2","47.6","49.0","50.4","51.1","52.5","53.9","55.3","56.7","58.1","58.8"],
      ["43.4","44.8","45.5","46.9","48.3","49.7","51.1","51.8","53.2","54.6","56.0","57.4","58.8","59.5","60.9"],
      ["45.5","46.2","47.6","49.0","50.4","51.8","53.2","53.9","55.3","56.7","58.1","59.5","60.2","61.6","63.0"],
      ["46.9","48.3","49.7","51.1","52.5","53.9","54.6","56.0","57.4","58.8","60.2","60.9","62.3","63.7","65.1"],
      ["49.0","50.4","51.8","53.2","54.6","55.3","56.7","58.1","59.5","60.9","62.3","63.0","64.4","65.8","66.5"],
      ["51.1","52.5","53.9","55.3","56.0","57.4","58.8","60.2","61.6","63.0","63.7","65.1","66.5","67.9","69.3"],
      ["53.2","54.6","56.0","57.4","58.1","59.5","60.9","62.3","63.7","64.4","65.8","67.2","68.6","70.0","71.4"],
      ["55.3","56.7","58.1","58.8","60.2","61.6","63.0","64.4","65.1","66.5","67.9","69.3","70.7","72.1","72.8"],
      ["57.4","58.8","59.5","60.9","62.3","63.7","65.1","66.5","67.2","68.6","70.0","71.4","72.8","73.5","74.9"],
      ["59.5","60.2","61.6","63.0","64.4","65.8","67.2","67.9","69.3","70.7","72.1","73.5","74.2","75.6","77.0"],
      ["61.6","62.3","63.7","65.1","66.5","67.9","68.6","70.0","71.4","72.8","74.2","75.6","76.3","77.7","79.1"],
      ["63.0","64.4","65.8","67.2","68.6","69.3","70.7","72.1","73.5","74.9","76.3","77.0","78.4","79.8","81.2"],
      ["65.1","66.5","67.9","69.3","70.7","71.4","72.8","74.2","75.6","77.0","77.7","79.1","80.5","81.9","82.6"]
    ];
    const doubleFlander = [
      ["59.68","61.14","62.63","64.16","65.73","67.34","68.98","70.67","72.39","74.17","75.98","77.84","79.75","81.71","83.71"],
      ["61.39","62.90","64.44","66.03","67.65","69.32","71.02","72.77","74.56","76.40","78.28","80.21","82.19","84.22","86.30"],
      ["63.17","64.74","66.34","67.98","69.66","71.39","73.16","74.97","76.82","78.73","80.68","82.68","84.73","86.84","89.00"],
      ["65.04","66.66","68.32","70.02","71.76","73.55","75.38","77.26","79.18","81.16","83.18","85.26","87.39","89.58","91.82"],
      ["66.98","68.66","70.38","72.14","73.95","75.81","77.70","79.65","81.65","83.70","85.80","87.96","90.17","92.44","94.76"],
      ["69.01","70.75","72.54","74.36","76.24","78.16","80.13","82.15","84.22","86.35","88.53","90.77","93.06","95.42","97.84"],
      ["71.13","72.94","74.79","76.68","78.61","80.62","82.66","84.76","86.91","89.12","91.38","93.70","96.06","98.53","101.05"],
      ["73.35","75.22","77.14","79.10","81.12","83.19","85.31","87.48","89.72","92.01","94.36","96.77","99.23","101.79","104.40"],
      ["75.66","77.60","79.59","81.63","83.72","85.87","88.07","90.33","92.64","95.02","97.46","99.97","102.54","105.18","107.89"],
      ["78.07","80.09","82.15","84.27","86.44","88.66","90.95","93.30","95.70","98.17","100.71","103.31","105.98","108.73","111.54"],
      ["80.59","82.68","84.82","87.02","89.27","91.59","93.96","96.39","98.89","101.46","104.09","106.80","109.58","112.43","115.35"]
    ];
        const korniziPriceList = [
      { name: "Корниз алуминиев двуканален 200см", measure: "брой", euro: 9.00 },
      { name: "Корниз алуминиев двуканален 250см", measure: "брой", euro: 11.00 },
      { name: "Корниз алуминиев двуканален 300см", measure: "брой", euro: 13.00 },
      { name: "Корниз алуминиев двуканален 350см", measure: "брой", euro: 15.00 },
      { name: "Корниз алуминиев двуканален 400см", measure: "брой", euro: 18.00 },
      { name: "Корниз алуминиев двуканален 600см", measure: "брой", euro: 26.00 },
      { name: "Корниз алуминиев триканален 200см", measure: "брой", euro: 11.50 },
      { name: "Корниз алуминиев триканален 250см", measure: "брой", euro: 14.50 },
      { name: "Корниз алуминиев триканален 300см", measure: "брой", euro: 17.00 },
      { name: "Корниз алуминиев триканален 350см", measure: "брой", euro: 20.00 },
      { name: "Корниз алуминиев триканален 400см", measure: "брой", euro: 23.00 },
      { name: "Корниз алуминиев триканален 600см", measure: "брой", euro: 35.00 },
      { name: "Корниз алуминиев двуканален с чело 200см", measure: "брой", euro: 12.00 },
      { name: "Корниз алуминиев двуканален с чело 250см", measure: "брой", euro: 15.00 },
      { name: "Корниз алуминиев двуканален с чело 300см", measure: "брой", euro: 18.00 },
      { name: "Корниз алуминиев двуканален с чело 350см", measure: "брой", euro: 20.00 },
      { name: "Корниз алуминиев двуканален с чело 400см", measure: "брой", euro: 24.00 },
      { name: "Корниз алуминиев двуканален с чело 600см", measure: "брой", euro: 37.00 },
      { name: "Корниз PVC двуканален 200см", measure: "брой", euro: 11.50 },
      { name: "Корниз PVC двуканален 250см", measure: "брой", euro: 14.00 },
      { name: "Корниз PVC двуканален 300см", measure: "брой", euro: 17.00 },
      { name: "Корниз PVC двуканален 350см", measure: "брой", euro: 20.00 },
      { name: "Корниз PVC двуканален 400см", measure: "брой", euro: 23.00 },
      { name: "Корниз PVC двуканален 600см", measure: "брой", euro: 35.00 },
      { name: "Корниз PVC триканален 200см", measure: "брой", euro: 14.00 },
      { name: "Корниз PVC триканален 250см", measure: "брой", euro: 17.50 },
      { name: "Корниз PVC триканален 300см", measure: "брой", euro: 21.00 },
      { name: "Корниз PVC триканален 350см", measure: "брой", euro: 24.50 },
      { name: "Корниз PVC триканален 400см", measure: "брой", euro: 28.00 },
      { name: "Корниз PVC триканален 600см", measure: "брой", euro: 42.00 },
      { name: "Корниз PVC двуканален с чело 200см", measure: "брой", euro: 14.00 },
      { name: "Корниз PVC двуканален с чело 250см", measure: "брой", euro: 17.50 },
      { name: "Корниз PVC двуканален с чело 300см", measure: "брой", euro: 21.00 },
      { name: "Корниз PVC двуканален с чело 350см", measure: "брой", euro: 24.50 },
      { name: "Корниз PVC двуканален с чело 400см", measure: "брой", euro: 28.00 },
      { name: "Корниз PVC двуканален с чело 600см", measure: "брой", euro: 42.00 },
      { name: "Аксесоар за корниз 2бр PVC стопер за алуминиев корниз", measure: "брой", euro: 0.70 },
      { name: "Аксесоар за корниз PVC 90° ъгъл за двуканален корниз", measure: "брой", euro: 7.00 },
      { name: "Аксесоар за корниз PVC 90° ъгъл за триканален корниз", measure: "брой", euro: 8.40 },
      { name: "Аксесоар за корниз к-т крайни тапи за PVC двуканален корниз", measure: "брой", euro: 5.60 },
      { name: "Аксесоар за корниз к-т крайни тапи за PVC триканален корниз", measure: "брой", euro: 7.00 },
      { name: "Аксесоар за корниз к-т крайни тапи за PVC двуканален корниз с чело", measure: "брой", euro: 5.60 },
      { name: "Аксесоар за корниз свръзка за PVC двуканален корниз", measure: "брой", euro: 2.80 },
      { name: "Аксесоар за корниз свръзка за PVC триканален корниз", measure: "брой", euro: 3.50 },
      { name: "Моторизиран корниз алуминиев едноканален с висящ мотор 0 - 350см", measure: "брой", euro: 224.00 },
      { name: "Моторизиран корниз алуминиев едноканален с висящ мотор 351 - 600см", measure: "брой", euro: 245.00 },
      { name: "Аксесоар за моторизиран корниз дистанционно за управление", measure: "брой", euro: 35.00 },
      { name: "Моторизиран механизъм за перде щора с еднопосочно и разделно събиране 0-350см", measure: "брой", euro: 294.00 },
      { name: "Моторизиран механизъм за перде щора само с разделно събиране 351-700см", measure: "брой", euro: 322.00 },
      { name: "Аксесоар за моторизиран механизъм дистанционно за управление", measure: "брой", euro: 30.00 },
      { name: "Моторизиран механизъм за роло / ден и нощ щора Ф47мм", measure: "брой", euro: 70.00 },
      { name: "Моторизиран механизъм за роло / ден и нощ щора Ф65мм", measure: "брой", euro: 98.00 },
      { name: "Моторизиран механизъм за плисе щора в рамка", measure: "брой", euro: 0, onRequest: true },
      { name: "Моторизиран механизъм за плисе щора Г-образен/таванен монтаж", measure: "брой", euro: 0, onRequest: true }
    ];
    function roundUpTo10(num) {
      return num < 50 ? 50 : Math.ceil(num / 10) * 10;
    }
    function getColorDisplay(color) {
      const displays = {
        white: 'Бял',
        brown: 'Кафяв',
        anthracite: 'Антрацит',
        'golden_oak': 'Златен дъб',
        walnut: 'Орех'
      };
      return displays[color] || color;
    }
    function showCalcError(el, message) {
      el.style.display = "block";
      el.style.background = "#fadbd8";
      el.style.color = "#c0392b";
      el.innerHTML = message;
    }
    function showCalcSuccess(el, content) {
      el.style.display = "block";
      el.style.background = "#eafaf1";
      el.style.color = "#1e8449";
      el.innerHTML = content;
    }
    function formatExtrasSummary(extras, mapping) {
      if (!extras.length) return "Екстри: Няма";
      return "Екстри: " + extras.map(key => mapping[key]?.label || key).join(", ");
    }
    function pushHistory(list, entry, elementId) {
      list.push(entry);
      if (list.length > 5) list.shift();
      const hist = document.getElementById(elementId);
      if (!hist) return;
      hist.innerHTML = "<strong>Последни резултати:</strong><br>" + list.slice().reverse().join("<br>");
    }
    function formatDimension(value) {
      if (isNaN(value)) return value;
      return Number(value).toFixed(1).replace(/\.0$/, '');
    }
    function calculateMini() {
      const wIn = document.getElementById("mini-width").value;
      const hIn = document.getElementById("mini-height").value;
      const fabric = document.getElementById("mini-fabric").value;
      const color = document.getElementById("mini-color").value;
      const control = document.getElementById("mini-control").value;
      const res = document.getElementById("mini-result");
      if (!wIn || !hIn || !fabric || !color || !control) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Попълнете всички полета!"; return; }
      let width = parseFloat(wIn), height = parseFloat(hIn);
      const max = maxDimensions.mini;
      if (width > max.maxWidth || height > max.maxHeight) { 
        res.style.display = "block"; 
        res.style.background = "#fadbd8"; 
        res.style.color = "#c0392b"; 
        res.innerHTML = `Максимални размери: ${max.maxWidth} см ширина × ${max.maxHeight} см височина!`; 
        return; 
      }
      const w = roundUpTo10(width), h = roundUpTo10(height);
      const base = miniPriceTable[h]?.[w];
      if (!base) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Грешка в таблицата."; return; }
      // #region agent log
      (function(){
        var raw = fabric, hasKey = Object.prototype.hasOwnProperty.call(miniFabricCoeff, raw), kVal = miniFabricCoeff[raw], keysSample = Object.keys(miniFabricCoeff).slice(0,5);
        fetch('http://127.0.0.1:7242/ingest/537fa1da-93c3-4ca3-9276-a16a3540c67b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'calculateMini',message:'Mini fabric lookup',data:{fabric:raw,fabricLength:raw?raw.length:0,hasKey:hasKey,kType:typeof kVal,keysSample:keysSample},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'H1-H2'})}).catch(function(){});
      })();
      // #endregion
      let k = miniFabricCoeff[fabric];
      if (!k) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден плат."; return; }
      if (color === 'brown') k *= 1.05;
      const final = base * k;
      const platName = fabric;
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      res.style.display = "block";
      res.style.background = "#eafaf1";
      res.style.color = "#1e8449";
      res.innerHTML = `
        <div>Размери: <span class="highlight">${width}×${height} см</span> → <strong>${w}×${h} см</strong></div>
        <div>Плат: <span class="highlight">${platName}</span> (×${k.toFixed(2)})</div>
        <div>Цвят: <span class="highlight">${getColorDisplay(color)}</span></div>
        <div>Управление: <span class="highlight">${controlLabel}</span></div>
        <div style="margin-top:12px; font-size:1.4em;">Цена: <strong>${final.toFixed(2)} €</strong></div>
      `;
      // Save result for cart
      lastMiniResult = {
        name: "Роло Мини",
        price: final,
        details: {
          "Размери": `${width}×${height} см → ${w}×${h} см`,
          "Плат": platName,
          "Цвят": getColorDisplay(color),
          "Управление": controlLabel,
          "Цена": `${final.toFixed(2)} €`
        }
      };
      document.getElementById("mini-add-cart").style.display = "block";
      miniHistory.push(`${width}×${height} → ${w}×${h} - ${platName} - ${getColorDisplay(color)} - ${final.toFixed(2)}€`);
      if (miniHistory.length > 5) miniHistory.shift();
      updateMiniHistory();
    }
    function updateMiniHistory() {
      const hist = document.getElementById("mini-history");
      hist.innerHTML = "<strong>Последни резултати:</strong><br>" + miniHistory.slice().reverse().join("<br>");
    }
    function calculateDN() {
      const wIn = document.getElementById("dn-width").value;
      const hIn = document.getElementById("dn-height").value;
      const fabric = document.getElementById("dn-fabric").value;
      const color = document.getElementById("dn-color").value;
      const control = document.getElementById("dn-control").value;
      const res = document.getElementById("dn-result");
      if (!wIn || !hIn || !fabric || !color || !control) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Попълнете всички полета!"; return; }
      let width = parseFloat(wIn), height = parseFloat(hIn);
      const max = maxDimensions.dn;
      if (width > max.maxWidth || height > max.maxHeight) { 
        res.style.display = "block"; 
        res.style.background = "#fadbd8"; 
        res.style.color = "#c0392b"; 
        res.innerHTML = `Максимални размери: ${max.maxWidth} см ширина × ${max.maxHeight} см височина!`; 
        return; 
      }
      const w = roundUpTo10(width), h = roundUpTo10(height);
      const base = dnPriceTable[h]?.[w];
      if (!base) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Грешка в таблицата."; return; }
      let k = dnFabricCoeff[fabric];
      if (!k) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден плат."; return; }
      if (color === 'brown') k *= 1.05;
      const final = base * k;
      const platName = fabric;
      res.style.display = "block";
      res.style.background = "#eafaf1";
      res.style.color = "#1e8449";
      res.innerHTML = `
        <div>Размери: <span class="highlight">${width}×${height} см</span> → <strong>${w}×${h} см</strong></div>
        <div>Плат: <span class="highlight">${platName}</span> (×${k.toFixed(2)})</div>
        <div>Цвят: <span class="highlight">${getColorDisplay(color)}</span></div>
        <div>Управление: <span class="highlight">${control === "left" ? "Ляво" : "Дясно"}</span></div>
        <div style="margin-top:12px; font-size:1.4em;">Цена: <strong>${final.toFixed(2)} €</strong></div>
      `;
      // Save result for cart
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      lastDnMiniResult = {
        name: "Ден и Нощ Мини",
        price: final,
        details: {
          "Размери": `${width}×${height} см → ${w}×${h} см`,
          "Плат": platName,
          "Цвят": getColorDisplay(color),
          "Управление": controlLabel,
          "Цена": `${final.toFixed(2)} €`
        }
      };
      document.getElementById("dn-add-cart").style.display = "block";
      dnHistory.push(`${width}×${height} → ${w}×${h} - ${platName} - ${getColorDisplay(color)} - ${final.toFixed(2)}€`);
      if (dnHistory.length > 5) dnHistory.shift();
      updateDnHistory();
    }
    function updateDnHistory() {
      const hist = document.getElementById("dn-history");
      hist.innerHTML = "<strong>Последни резултати:</strong><br>" + dnHistory.slice().reverse().join("<br>");
    }
    function calculateElegans() {
      const wIn = document.getElementById("elegans-width").value;
      const hIn = document.getElementById("elegans-height").value;
      const fabric = document.getElementById("elegans-fabric").value;
      const color = document.getElementById("elegans-color").value;
      const control = document.getElementById("elegans-control").value;
      const res = document.getElementById("elegans-result");
      if (!wIn || !hIn || !fabric || !color || !control) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Попълнете всички полета!"; return; }
      let width = parseFloat(wIn), height = parseFloat(hIn);
      const max = maxDimensions.elegans;
      if (width > max.maxWidth || height > max.maxHeight) { 
        res.style.display = "block"; 
        res.style.background = "#fadbd8"; 
        res.style.color = "#c0392b"; 
        res.innerHTML = `Максимални размери: ${max.maxWidth} см ширина × ${max.maxHeight} см височина!`; 
        return; 
      }
      const w = roundUpTo10(width), h = roundUpTo10(height);
      const base = elegansPriceTable[h]?.[w];
      if (!base) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Грешка в таблицата."; return; }
      const coeffs = elegansCoeff[fabric];
      if (!coeffs) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден плат."; return; }
      const k = coeffs[color];
      if (!k) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден цвят за този плат."; return; }
      const final = base * k;
      const platName = fabric;
      res.style.display = "block";
      res.style.background = "#eafaf1";
      res.style.color = "#1e8449";
      res.innerHTML = `
        <div>Размери: <span class="highlight">${width}×${height} см</span> → <strong>${w}×${h} см</strong></div>
        <div>Плат: <span class="highlight">${platName}</span> (×${k.toFixed(2)})</div>
        <div>Цвят: <span class="highlight">${getColorDisplay(color)}</span></div>
        <div>Управление: <span class="highlight">${control === "left" ? "Ляво" : "Дясно"}</span></div>
        <div style="margin-top:12px; font-size:1.4em;">Цена: <strong>${final.toFixed(2)} €</strong></div>
      `;
      // Save result for cart
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      lastElegansResult = {
        name: "Роло Елеганс 29mm",
        price: final,
        details: {
          "Размери": `${width}×${height} см → ${w}×${h} см`,
          "Плат": platName,
          "Цвят": getColorDisplay(color),
          "Управление": controlLabel,
          "Цена": `${final.toFixed(2)} €`
        }
      };
      document.getElementById("elegans-add-cart").style.display = "block";
      elegansHistory.push(`${width}×${height} → ${w}×${h} - ${platName} - ${getColorDisplay(color)} - ${final.toFixed(2)}€`);
      if (elegansHistory.length > 5) elegansHistory.shift();
      updateElegansHistory();
    }
    function updateElegansHistory() {
      const hist = document.getElementById("elegans-history");
      hist.innerHTML = "<strong>Последни резултати:</strong><br>" + elegansHistory.slice().reverse().join("<br>");
    }
    function calculateDNElegans() {
      const wIn = document.getElementById("dn-elegans-width").value;
      const hIn = document.getElementById("dn-elegans-height").value;
      const fabric = document.getElementById("dn-elegans-fabric").value;
      const color = document.getElementById("dn-elegans-color").value;
      const control = document.getElementById("dn-elegans-control").value;
      const res = document.getElementById("dn-elegans-result");
      if (!wIn || !hIn || !fabric || !color || !control) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Попълнете всички полета!"; return; }
      let width = parseFloat(wIn), height = parseFloat(hIn);
      const max = maxDimensions.dnnPlus; // Използва същите размери като dnnPlus
      if (width > max.maxWidth || height > max.maxHeight) { 
        res.style.display = "block"; 
        res.style.background = "#fadbd8"; 
        res.style.color = "#c0392b"; 
        res.innerHTML = `Максимални размери: ${max.maxWidth} см ширина × ${max.maxHeight} см височина!`; 
        return; 
      }
      const w = roundUpTo10(width), h = roundUpTo10(height);
      const base = dnElegansPriceTable[h]?.[w];
      if (!base) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Грешка в таблицата."; return; }
      const coeffs = dnElegansCoeff[fabric];
      if (!coeffs) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден плат."; return; }
      const k = coeffs[color];
      if (!k) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден цвят за този плат."; return; }
      const final = base * k;
      const platName = fabric;
      res.style.display = "block";
      res.style.background = "#eafaf1";
      res.style.color = "#1e8449";
      res.innerHTML = `
        <div>Размери: <span class="highlight">${width}×${height} см</span> → <strong>${w}×${h} см</strong></div>
        <div>Плат: <span class="highlight">${platName}</span> (×${k.toFixed(2)})</div>
        <div>Цвят: <span class="highlight">${getColorDisplay(color)}</span></div>
        <div>Управление: <span class="highlight">${control === "left" ? "Ляво" : "Дясно"}</span></div>
        <div style="margin-top:12px; font-size:1.4em;">Цена: <strong>${final.toFixed(2)} €</strong></div>
      `;
      // Save result for cart
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      lastDnElegansResult = {
        name: "Ден и Нощ Елеганс 29mm",
        price: final,
        details: {
          "Размери": `${width}×${height} см → ${w}×${h} см`,
          "Плат": platName,
          "Цвят": getColorDisplay(color),
          "Управление": controlLabel,
          "Цена": `${final.toFixed(2)} €`
        }
      };
      document.getElementById("dn-elegans-add-cart").style.display = "block";
      dnElegansHistory.push(`${width}×${height} → ${w}×${h} - ${platName} - ${getColorDisplay(color)} - ${final.toFixed(2)}€`);
      if (dnElegansHistory.length > 5) dnElegansHistory.shift();
      updateDnElegansHistory();
    }
    function updateDnElegansHistory() {
      const hist = document.getElementById("dn-elegans-history");
      hist.innerHTML = "<strong>Последни резултати:</strong><br>" + dnElegansHistory.slice().reverse().join("<br>");
    }
    function calculateRoloPlus() {
      const wIn = document.getElementById("rolo-plus-width").value;
      const hIn = document.getElementById("rolo-plus-height").value;
      const fabric = document.getElementById("rolo-plus-fabric").value;
      const color = document.getElementById("rolo-plus-color").value;
      const control = document.getElementById("rolo-plus-control").value;
      const res = document.getElementById("rolo-plus-result");
      if (!wIn || !hIn || !fabric || !color || !control) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Попълнете всички полета!"; return; }
      let width = parseFloat(wIn), height = parseFloat(hIn);
      const max = maxDimensions.roloPlus;
      if (width > max.maxWidth || height > max.maxHeight) { 
        res.style.display = "block"; 
        res.style.background = "#fadbd8"; 
        res.style.color = "#c0392b"; 
        res.innerHTML = `Максимални размери: ${max.maxWidth} см ширина × ${max.maxHeight} см височина!`; 
        return; 
      }
      const w = roundUpTo10(width), h = roundUpTo10(height);
      const base = roloPlusPriceTable[h]?.[w];
      if (!base) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Грешка в таблицата."; return; }
      const coeffs = roloPlusCoeff[fabric];
      if (!coeffs) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден плат."; return; }
      const k = coeffs[color];
      if (!k) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден цвят за този плат."; return; }
      const final = base * k;
      const platName = fabric;
      res.style.display = "block";
      res.style.background = "#eafaf1";
      res.style.color = "#1e8449";
      res.innerHTML = `
        <div>Размери: <span class="highlight">${width}×${height} см</span> → <strong>${w}×${h} см</strong></div>
        <div>Плат: <span class="highlight">${platName}</span> (×${k.toFixed(2)})</div>
        <div>Цвят: <span class="highlight">${getColorDisplay(color)}</span></div>
        <div>Управление: <span class="highlight">${control === "left" ? "Ляво" : "Дясно"}</span></div>
        <div style="margin-top:12px; font-size:1.4em;">Цена: <strong>${final.toFixed(2)} €</strong></div>
      `;
      // Save result for cart
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      lastRoloPlusResult = {
        name: "Роло Елеганс+ (45мм кутия)",
        price: final,
        details: {
          "Размери": `${width}×${height} см → ${w}×${h} см`,
          "Плат": platName,
          "Цвят": getColorDisplay(color),
          "Управление": controlLabel,
          "Цена": `${final.toFixed(2)} €`
        }
      };
      document.getElementById("rolo-plus-add-cart").style.display = "block";
      roloPlusHistory.push(`${width}×${height} → ${w}×${h} - ${platName} - ${getColorDisplay(color)} - ${final.toFixed(2)}€`);
      if (roloPlusHistory.length > 5) roloPlusHistory.shift();
      updateRoloPlusHistory();
    }
    function updateRoloPlusHistory() {
      const hist = document.getElementById("rolo-plus-history");
      hist.innerHTML = "<strong>Последни резултати:</strong><br>" + roloPlusHistory.slice().reverse().join("<br>");
    }
    function calculateDnnPlus() {
      const wIn = document.getElementById("dnn-plus-width").value;
      const hIn = document.getElementById("dnn-plus-height").value;
      const fabric = document.getElementById("dnn-plus-fabric").value;
      const color = document.getElementById("dnn-plus-color").value;
      const control = document.getElementById("dnn-plus-control").value;
      const res = document.getElementById("dnn-plus-result");
      if (!wIn || !hIn || !fabric || !color || !control) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Попълнете всички полета!"; return; }
      let width = parseFloat(wIn), height = parseFloat(hIn);
      const max = maxDimensions.dnnPlus;
      if (width > max.maxWidth || height > max.maxHeight) { 
        res.style.display = "block"; 
        res.style.background = "#fadbd8"; 
        res.style.color = "#c0392b"; 
        res.innerHTML = `Максимални размери: ${max.maxWidth} см ширина × ${max.maxHeight} см височина!`; 
        return; 
      }
      const w = roundUpTo10(width), h = roundUpTo10(height);
      const base = dnnPlusPriceTable[h]?.[w];
      if (!base) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Грешка в таблицата."; return; }
      const coeffs = dnnPlusCoeff[fabric];
      if (!coeffs) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден плат."; return; }
      const k = coeffs[color];
      if (!k) { res.style.display = "block"; res.style.background = "#fadbd8"; res.style.color = "#c0392b"; res.innerHTML = "Невалиден цвят за този плат."; return; }
      const final = base * k;
      const platName = fabric;
      res.style.display = "block";
      res.style.background = "#eafaf1";
      res.style.color = "#1e8449";
      res.innerHTML = `
        <div>Размери: <span class="highlight">${width}×${height} см</span> → <strong>${w}×${h} см</strong></div>
        <div>Плат: <span class="highlight">${platName}</span> (×${k.toFixed(2)})</div>
        <div>Цвят: <span class="highlight">${getColorDisplay(color)}</span></div>
        <div>Управление: <span class="highlight">${control === "left" ? "Ляво" : "Дясно"}</span></div>
        <div style="margin-top:12px; font-size:1.4em;">Цена: <strong>${final.toFixed(2)} €</strong></div>
      `;
      // Save result for cart
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      lastDnnPlusResult = {
        name: "Ден и Нощ Елеганс+ (45мм кутия)",
        price: final,
        details: {
          "Размери": `${width}×${height} см → ${w}×${h} см`,
          "Плат": platName,
          "Цвят": getColorDisplay(color),
          "Управление": controlLabel,
          "Цена": `${final.toFixed(2)} €`
        }
      };
      document.getElementById("dnn-plus-add-cart").style.display = "block";
      dnnPlusHistory.push(`${width}×${height} → ${w}×${h} - ${platName} - ${getColorDisplay(color)} - ${final.toFixed(2)}€`);
      if (dnnPlusHistory.length > 5) dnnPlusHistory.shift();
      updateDnnPlusHistory();
    }
    function updateDnnPlusHistory() {
      const hist = document.getElementById("dnn-plus-history");
      hist.innerHTML = "<strong>Последни резултати:</strong><br>" + dnnPlusHistory.slice().reverse().join("<br>");
    }
    function handleRoletniWidthChange() {}
    
    function handleRoletniHeightChange() {}
    function handleDayNightWidthChange() {}
    function handleDayNightHeightChange() {}
    
    function calculateRoletni() {
      const widthIn = parseFloat(document.getElementById("roletni-width").value);
      const heightIn = parseFloat(document.getElementById("roletni-height").value);
      const seriesKey = document.getElementById("roletni-series").value;
      const control = document.getElementById("roletni-control").value;
      let extras = Array.from(document.querySelectorAll(".roletni-extra:checked")).map(c => c.value);
      let selectedJumbo = document.querySelector("input[name='roletni-jumbo']:checked");
      if (selectedJumbo && !extras.includes(selectedJumbo.value)) {
        extras.push(selectedJumbo.value);
      }
      const res = document.getElementById("roletni-result");
      if (isNaN(widthIn) || isNaN(heightIn) || !seriesKey || !control) {
        showCalcError(res, "Попълнете всички полета!");
        return;
      }
      // Проверка за максимални размери от Excel файла (за конкретния плат)
      const fabricMax = getFabricMaxDimensions("roletni", seriesKey);
      let maxWidth = maxDimensions.roletni.maxWidth;
      let maxHeight = maxDimensions.roletni.maxHeight;
      if (fabricMax) {
        maxWidth = Math.min(maxWidth, fabricMax.maxWidth);
        maxHeight = Math.min(maxHeight, fabricMax.maxHeight);
      }
      if (widthIn > maxWidth) {
        showCalcError(res, `Максимална ширина за избрания плат: ${maxWidth} см.`);
        return;
      }
      if (heightIn > maxHeight) {
        showCalcError(res, `Максимална височина за избрания плат: ${maxHeight} см.`);
        return;
      }
      // Закръгляне на размерите
      let width = roundUpTo10(widthIn);
      let height = roundUpTo10(heightIn);
      // Минимум: 100 см ширина, 200 см височина
      if (width < 100) width = 100;
      if (height < 200) height = 200;
      
      // Автоматично избиране на джъмбо 47мм при ширина над 220 см
      if (widthIn > 220) {
        // Премахване на кутиите (не са възможни при ширина над 220 см)
        extras = extras.filter(key => key !== "box_closed" && key !== "box_fabric");
        // Отмятане на checkbox-овете за кутиите в UI
        const boxClosedCheckbox = document.querySelector(".roletni-extra[value='box_closed']");
        const boxFabricCheckbox = document.querySelector(".roletni-extra[value='box_fabric']");
        if (boxClosedCheckbox) boxClosedCheckbox.checked = false;
        if (boxFabricCheckbox) boxFabricCheckbox.checked = false;
        // Автоматично добавяне на джъмбо 47мм
        if (!extras.includes("jumbo47")) {
          extras.push("jumbo47");
          const jumbo47Radio = document.querySelector("input[name='roletni-jumbo'][value='jumbo47']");
          if (jumbo47Radio) jumbo47Radio.checked = true;
        }
      } else {
        const finalSelectedJumbo = document.querySelector("input[name='roletni-jumbo']:checked");
        if (finalSelectedJumbo && !extras.includes(finalSelectedJumbo.value)) {
          extras.push(finalSelectedJumbo.value);
        }
      }
      
      // #region agent log
      (function(){
        var sk = seriesKey, keys = Object.keys(roletniSeries), hasKey = Object.prototype.hasOwnProperty.call(roletniSeries, sk);
        fetch('http://127.0.0.1:7242/ingest/537fa1da-93c3-4ca3-9276-a16a3540c67b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'calculateRoletni',message:'Roletni series lookup',data:{seriesKey:sk,hasKey:hasKey,keysSample:keys.slice(0,8)},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'H6-H7'})}).catch(function(){});
      })();
      // #endregion
      const series = roletniSeries[seriesKey];
      if (!series) {
        showCalcError(res, "Невалидна серия.");
        return;
      }
      
      // Минимум за калкулация: до 1м ширина И до 2м височина = 2 кв.м
      let area = (width / 100) * (height / 100);
      if (widthIn <= 100 && heightIn <= 200) {
        area = 2; // Минимум 2 кв.м
      }
      
      let price = area * series.price;
      
      // Компонентите са на линеен метър (ширината)
      extras.forEach(key => {
        const extra = roletniExtras[key];
        if (!extra) return;
        if (extra.type === "per_meter") {
          price += (width / 100) * extra.value;
        } else if (extra.type === "per_piece") {
          price += extra.value;
        }
      });
      
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      const content = `
        <div>Размери: ${formatDimension(widthIn)}×${formatDimension(heightIn)} см → <strong>${width}×${height} см</strong></div>
        <div>Квадратура: <strong>${area.toFixed(2)} м²</strong></div>
        <div>Серия: <span class="highlight">${series.label}</span> (${series.price.toFixed(2)} €/m²)</div>
        <div>Управление: <span class="highlight">${controlLabel}</span></div>
        <div>${formatExtrasSummary(extras, roletniExtras)}</div>
        <div style="margin-top:12px;font-size:1.4em;">Цена: <strong>${price.toFixed(2)} €</strong></div>
      `;
      showCalcSuccess(res, content);
      // Save result for cart
      lastRoletniResult = {
        name: "Ролетни щори",
        price: price,
        details: {
          "Размери": `${formatDimension(widthIn)}×${formatDimension(heightIn)} см → ${width}×${height} см`,
          "Квадратура": `${area.toFixed(2)} м²`,
          "Серия": series.label,
          "Цена за м²": `${series.price.toFixed(2)} €`,
          "Управление": controlLabel,
          "Екстри": formatExtrasSummary(extras, roletniExtras) !== "Екстри: Няма" ? formatExtrasSummary(extras, roletniExtras) : "Няма екстри",
          "Цена": `${price.toFixed(2)} €`
        }
      };
      document.getElementById("roletni-add-cart").style.display = "block";
      pushHistory(roletniHistory, `Ролетни щори: ${formatDimension(widthIn)}×${formatDimension(heightIn)} → ${width}×${height} - ${price.toFixed(2)}€`, "roletni-history");
    }
    function calculateDayNight() {
      const widthIn = parseFloat(document.getElementById("day-night-width").value);
      const heightIn = parseFloat(document.getElementById("day-night-height").value);
      const seriesKey = document.getElementById("day-night-series").value;
      const control = document.getElementById("day-night-control").value;
      let extras = Array.from(document.querySelectorAll(".day-night-extra:checked")).map(c => c.value);
      let selectedJumbo = document.querySelector("input[name='day-night-jumbo']:checked");
      if (selectedJumbo && !extras.includes(selectedJumbo.value)) {
        extras.push(selectedJumbo.value);
      }
      const res = document.getElementById("day-night-result");
      if (isNaN(widthIn) || isNaN(heightIn) || !seriesKey || !control) {
        showCalcError(res, "Попълнете всички полета!");
        return;
      }
      // Проверка за максимални размери от Excel файла (за конкретния плат)
      // За zebra само ширината се проверява от Excel файла, височината остава същата
      const fabricMax = getFabricMaxDimensions("dayNight", seriesKey);
      let maxWidth = maxDimensions.dayNight.maxWidth;
      let maxHeight = maxDimensions.dayNight.maxHeight;
      if (fabricMax && fabricMax.maxWidth) {
        maxWidth = Math.min(maxWidth, fabricMax.maxWidth);
      }
      if (widthIn > maxWidth) {
        showCalcError(res, `Максимална ширина за избрания плат: ${maxWidth} см.`);
        return;
      }
      if (heightIn > maxHeight) {
        showCalcError(res, `Максимална височина: ${maxHeight} см.`);
        return;
      }
      // Закръгляне на размерите
      let width = roundUpTo10(widthIn);
      let height = roundUpTo10(heightIn);
      // Минимум: 100 см ширина, 200 см височина
      if (width < 100) width = 100;
      if (height < 200) height = 200;
      
      // Автоматично избиране на джъмбо 47мм при ширина над 220 см
      if (widthIn > 220) {
        // Премахване на кутиите (не са възможни при ширина над 220 см)
        extras = extras.filter(key => key !== "box_closed" && key !== "box_fabric");
        // Отмятане на checkbox-овете за кутиите в UI
        const boxClosedCheckbox = document.querySelector(".day-night-extra[value='box_closed']");
        const boxFabricCheckbox = document.querySelector(".day-night-extra[value='box_fabric']");
        if (boxClosedCheckbox) boxClosedCheckbox.checked = false;
        if (boxFabricCheckbox) boxFabricCheckbox.checked = false;
        // Автоматично добавяне на джъмбо 47мм
        if (!extras.includes("jumbo47")) {
          extras.push("jumbo47");
          const jumbo47Radio = document.querySelector("input[name='day-night-jumbo'][value='jumbo47']");
          if (jumbo47Radio) jumbo47Radio.checked = true;
        }
      } else {
        const finalSelectedJumbo = document.querySelector("input[name='day-night-jumbo']:checked");
        if (finalSelectedJumbo && !extras.includes(finalSelectedJumbo.value)) {
          extras.push(finalSelectedJumbo.value);
        }
      }
      
      const series = dayNightSeries[seriesKey];
      if (!series) {
        showCalcError(res, "Невалидна серия.");
        return;
      }
      
      // Минимум за калкулация: до 1м ширина И до 2м височина = 2 кв.м
      let area = (width / 100) * (height / 100);
      if (widthIn <= 100 && heightIn <= 200) {
        area = 2; // Минимум 2 кв.м
      }
      
      let price = area * series.price;
      
      // Компонентите са на линеен метър (ширината)
      extras.forEach(key => {
        const extra = dayNightExtras[key];
        if (!extra) return;
        if (extra.type === "per_meter") {
          price += (width / 100) * extra.value;
        } else if (extra.type === "per_piece") {
          price += extra.value;
        }
      });
      
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      const content = `
        <div>Размери: ${formatDimension(widthIn)}×${formatDimension(heightIn)} см → <strong>${width}×${height} см</strong></div>
        <div>Квадратура: <strong>${area.toFixed(2)} м²</strong></div>
        <div>Серия: <span class="highlight">${series.label}</span> (${series.price.toFixed(2)} €/m²)</div>
        <div>Управление: <span class="highlight">${controlLabel}</span></div>
        <div>${formatExtrasSummary(extras, dayNightExtras)}</div>
        <div style="margin-top:12px;font-size:1.4em;">Цена: <strong>${price.toFixed(2)} €</strong></div>
      `;
      showCalcSuccess(res, content);
      // Save result for cart
      lastDayNightResult = {
        name: "Щора Ден и Нощ",
        price: price,
        details: {
          "Размери": `${formatDimension(widthIn)}×${formatDimension(heightIn)} см → ${width}×${height} см`,
          "Квадратура": `${area.toFixed(2)} м²`,
          "Серия": series.label,
          "Цена за м²": `${series.price.toFixed(2)} €`,
          "Управление": controlLabel,
          "Екстри": formatExtrasSummary(extras, dayNightExtras) !== "Екстри: Няма" ? formatExtrasSummary(extras, dayNightExtras) : "Няма екстри",
          "Цена": `${price.toFixed(2)} €`
        }
      };
      document.getElementById("day-night-add-cart").style.display = "block";
      pushHistory(dayNightCalcHistory, `Щора "Ден и Нощ": ${formatDimension(widthIn)}×${formatDimension(heightIn)} → ${width}×${height} - ${price.toFixed(2)}€`, "day-night-history");
    }
    function calculateDoubleRolo() {
      const widthIn = parseFloat(document.getElementById("double-rolo-width").value);
      const heightIn = parseFloat(document.getElementById("double-rolo-height").value);
      const backFabric = document.getElementById("double-rolo-back-fabric").value;
      const transparentFabric = document.getElementById("double-rolo-transparent-fabric").value;
      const control = document.getElementById("double-rolo-control").value;
      let extras = Array.from(document.querySelectorAll(".double-rolo-extra:checked")).map(c => c.value);
      const res = document.getElementById("double-rolo-result");
      if (isNaN(widthIn) || isNaN(heightIn) || !backFabric || !transparentFabric || !control) {
        showCalcError(res, "Попълнете всички полета!");
        return;
      }
      
      // Проверка за максимални размери (като на ролетни щори)
      // Проверка за заден плат
      const backFabricMax = getFabricMaxDimensions("roletni", backFabric);
      // Проверка за прозрачен плат
      const transparentFabricMax = getFabricMaxDimensions("doubleRolo", transparentFabric);
      
      let maxWidth = maxDimensions.roletni.maxWidth;
      let maxHeight = maxDimensions.roletni.maxHeight;
      
      // Вземаме по-строгите ограничения от двата плата
      if (backFabricMax) {
        maxWidth = Math.min(maxWidth, backFabricMax.maxWidth);
        maxHeight = Math.min(maxHeight, backFabricMax.maxHeight || maxHeight);
      }
      if (transparentFabricMax) {
        maxWidth = Math.min(maxWidth, transparentFabricMax.maxWidth);
        maxHeight = Math.min(maxHeight, transparentFabricMax.maxHeight || maxHeight);
      }
      
      if (widthIn > maxWidth) {
        showCalcError(res, `Максимална ширина за избраните платове: ${maxWidth} см.`);
        return;
      }
      if (heightIn > maxHeight) {
        showCalcError(res, `Максимална височина за избраните платове: ${maxHeight} см.`);
        return;
      }
      
      // Закръгляне на размерите
      let width = roundUpTo10(widthIn);
      let height = roundUpTo10(heightIn);
      // Минимум: 100 см ширина, 200 см височина (като на ролетни щори)
      if (width < 100) width = 100;
      if (height < 200) height = 200;
      
      // Автоматично избиране на джъмбо 47мм при ширина над 220 см
      if (widthIn > 220) {
        // Премахване на кутиите (не са възможни при ширина над 220 см)
        extras = extras.filter(key => key !== "box_closed" && key !== "box_fabric");
        // Отмятане на checkbox-овете за кутиите в UI
        const boxClosedCheckbox = document.querySelector(".double-rolo-extra[value='box_closed']");
        const boxFabricCheckbox = document.querySelector(".double-rolo-extra[value='box_fabric']");
        if (boxClosedCheckbox) boxClosedCheckbox.checked = false;
        if (boxFabricCheckbox) boxFabricCheckbox.checked = false;
        // Автоматично добавяне на джъмбо 47мм
        if (!extras.includes("jumbo47")) {
          extras.push("jumbo47");
          const jumbo47Radio = document.querySelector("input[name='double-rolo-jumbo'][value='jumbo47']");
          if (jumbo47Radio) jumbo47Radio.checked = true;
        }
      } else {
        const finalSelectedJumbo = document.querySelector("input[name='double-rolo-jumbo']:checked");
        if (finalSelectedJumbo && !extras.includes(finalSelectedJumbo.value)) {
          extras.push(finalSelectedJumbo.value);
        }
      }
      
      // Минимум за калкулация: до 1м ширина И до 2м височина = 2 кв.м (като на ролетни щори)
      let area = (width / 100) * (height / 100);
      if (widthIn <= 100 && heightIn <= 200) {
        area = 2; // Минимум 2 кв.м
      }
      
      // Изчисляване на цената на м² за заден плат (от roletniSeries, като на ролетни щори)
      const backSeries = roletniSeries[backFabric];
      if (!backSeries) {
        showCalcError(res, "Невалиден заден плат.");
        return;
      }
      // Цена на м² за заден плат (директно от roletniSeries)
      const priceBackPerM2 = backSeries.price;
      
      // Изчисляване на цената на м² за прозрачен плат (от doubleRoloSeries)
      const transparentSeries = doubleRoloSeries[transparentFabric];
      if (!transparentSeries) {
        showCalcError(res, "Невалиден прозрачен плат.");
        return;
      }
      const priceTransparentPerM2 = transparentSeries.price;
      
      // Обща цена на платовете = (цена заден плат на м² + цена прозрачен плат на м²) × квадратура
      let price = (priceBackPerM2 + priceTransparentPerM2) * area;
      
      // Добавяне на екстри (като на ролетни щори)
      extras.forEach(key => {
        const extra = roletniExtras[key];
        if (!extra) return;
        if (extra.type === "per_meter") {
          price += (width / 100) * extra.value;
        } else if (extra.type === "per_piece") {
          price += extra.value;
        }
      });
      
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      const backFabricLabel = backSeries.label;
      const transparentFabricLabel = transparentSeries.label;
      const extrasSummary = formatExtrasSummary(extras, roletniExtras);
      
      let warningMessage = widthIn > 220 
        ? `<div style="margin-top:12px;font-size:1.1em;color:#D4AF37;font-weight:bold;">⚠️ При ширина над 220 см щората може да се изработи единствено без кутия (с шина)</div>`
        : "";
      
      const content = `
        <div style="text-align:center;">
          <div>Размери: ${formatDimension(widthIn)}×${formatDimension(heightIn)} см → <strong>${width}×${height} см</strong></div>
          <div>Квадратура: <strong>${area.toFixed(2)} м²</strong></div>
          <div>Заден плат: <span class="highlight">${backFabricLabel}</span> - <strong>${priceBackPerM2.toFixed(2)} €/м²</strong></div>
          <div>Прозрачен плат: <span class="highlight">${transparentFabricLabel}</span> - <strong>${priceTransparentPerM2.toFixed(2)} €/м²</strong></div>
          <div>Сума на платовете: <strong>${(priceBackPerM2 + priceTransparentPerM2).toFixed(2)} €/м²</strong></div>
          <div>Управление: <span class="highlight">${controlLabel}</span></div>
          <div>${extrasSummary}</div>
          ${warningMessage}
          <div style="margin-top:12px;font-size:1.4em;">Обща цена: <strong>${price.toFixed(2)} €</strong></div>
        </div>
      `;
      showCalcSuccess(res, content);
      // Save result for cart
      lastDoubleRoloResult = {
        name: "Двойно Роло",
        price: price,
        details: {
          "Размери": `${formatDimension(widthIn)}×${formatDimension(heightIn)} см → ${width}×${height} см`,
          "Квадратура": `${area.toFixed(2)} м²`,
          "Заден плат": backFabricLabel,
          "Цена заден плат": `${priceBackPerM2.toFixed(2)} €/м²`,
          "Прозрачен плат": transparentFabricLabel,
          "Цена прозрачен плат": `${priceTransparentPerM2.toFixed(2)} €/м²`,
          "Сума на платовете": `${(priceBackPerM2 + priceTransparentPerM2).toFixed(2)} €/м²`,
          "Управление": controlLabel,
          "Екстри": extrasSummary !== "Екстри: Няма" ? extrasSummary : "Няма екстри",
          "Цена": `${price.toFixed(2)} €`
        }
      };
      document.getElementById("double-rolo-add-cart").style.display = "block";
      pushHistory(doubleRoloHistory, `Двойно Роло: ${formatDimension(widthIn)}×${formatDimension(heightIn)} → ${width}×${height} - ${price.toFixed(2)}€`, "double-rolo-history");
    }
    function toggleDoublePlise() {
      const isDouble = document.getElementById("plise-double").checked;
      const seriesSelect = document.getElementById("plise-series");
      const thinSeriesSelect = document.getElementById("plise-thin-series");
      const profileColorSelect = document.getElementById("plise-profile-color");
      
      if (isDouble) {
        // Показваме менюто за тънък плат
        thinSeriesSelect.style.display = "block";
        
        // Променяме label-а на селекта за серия
        const firstOption = seriesSelect.querySelector("option[value='']");
        if (firstOption) {
          firstOption.textContent = "Изберете плътен плат...";
        }
        
        // Премахваме tulle и etna от селекта за плътен плат
        const tulleOption = seriesSelect.querySelector("option[value='tulle']");
        const etnaOption = seriesSelect.querySelector("option[value='etna']");
        if (tulleOption) tulleOption.style.display = "none";
        if (etnaOption) etnaOption.style.display = "none";
        
        // Ако е избран tulle или etna, го премахваме
        if (seriesSelect.value === "tulle" || seriesSelect.value === "etna") {
          seriesSelect.value = "";
        }
      } else {
        // Скриваме менюто за тънък плат
        thinSeriesSelect.style.display = "none";
        thinSeriesSelect.value = "";
        
        // Скриваме менюто за цвят на профила (ако не е нужно винаги)
        // profileColorSelect.style.display = "none";
        // profileColorSelect.value = "";
        
        // Връщаме label-а на селекта за серия
        const firstOption = seriesSelect.querySelector("option[value='']");
        if (firstOption) {
          firstOption.textContent = "Изберете серия...";
        }
        
        // Показваме отново tulle и etna
        const tulleOption = seriesSelect.querySelector("option[value='tulle']");
        const etnaOption = seriesSelect.querySelector("option[value='etna']");
        if (tulleOption) tulleOption.style.display = "block";
        if (etnaOption) etnaOption.style.display = "block";
      }
    }
    
    function calculatePlise() {
      const widthIn = parseFloat(document.getElementById("plise-width").value);
      const heightIn = parseFloat(document.getElementById("plise-height").value);
      const isDouble = document.getElementById("plise-double").checked;
      const seriesKey = document.getElementById("plise-series").value;
      const thinSeriesKey = isDouble ? document.getElementById("plise-thin-series").value : null;
      const profileColor = document.getElementById("plise-profile-color").value;
      
      let extras = Array.from(document.querySelectorAll(".plise-extra:checked")).map(c => c.value);
      const selectedProfile = document.querySelector("input[name='plise-profile']:checked");
      if (selectedProfile && !extras.includes(selectedProfile.value)) {
        extras.push(selectedProfile.value);
      }
      
      const res = document.getElementById("plise-result");
      
      // Валидация
      if (isNaN(widthIn) || isNaN(heightIn)) {
        showCalcError(res, "Попълнете размерите!");
        return;
      }
      
      if (isDouble) {
        if (!seriesKey || !thinSeriesKey) {
          showCalcError(res, "Попълнете всички полета за двойно плисе!");
          return;
        }
      } else {
        if (!seriesKey) {
          showCalcError(res, "Попълнете всички полета!");
          return;
        }
      }
      
      // Максимум от таблицата
      const max = maxDimensions.plise;
      if (widthIn > max.maxWidth) {
        showCalcError(res, `Максимална ширина: ${max.maxWidth} см.`);
        return;
      }
      if (heightIn > max.maxHeight) {
        showCalcError(res, `Максимална височина: ${max.maxHeight} см.`);
        return;
      }
      
      // Изчисляваме квадратурата с оригиналните размери
      const areaRaw = (widthIn / 100) * (heightIn / 100);
      let area;
      if (areaRaw < 1) {
        // Под 1 кв.м → закръгля на 1 кв.м
        area = 1;
      } else {
        // Над 1 кв.м → закръгля до 1-вия десетичен знак (нагоре)
        area = Math.ceil(areaRaw * 10) / 10;
      }
      
      let price = 0;
      let content = `<div>Размери: ${formatDimension(widthIn)}×${formatDimension(heightIn)} см</div>`;
      content += `<div>Квадратура: ${areaRaw.toFixed(4)} м² → <strong>${area.toFixed(1)} м²</strong></div>`;
      
      if (isDouble) {
        // Двойно плисе - изчисляваме цената за двата плата
        // #region agent log
        (function(){
          var sk=seriesKey, tsk=thinSeriesKey, keys=Object.keys(pliseSeries), hasT=Object.prototype.hasOwnProperty.call(pliseSeries,sk), hasThin=tsk?Object.prototype.hasOwnProperty.call(pliseSeries,tsk):false;
          fetch('http://127.0.0.1:7242/ingest/537fa1da-93c3-4ca3-9276-a16a3540c67b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'calculatePlise double',message:'Plise series lookup',data:{seriesKey:sk,thinSeriesKey:tsk,hasThick:hasT,hasThin:hasThin,keysSample:keys},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'H4-H5'})}).catch(function(){});
        })();
        // #endregion
        const thickSeries = pliseSeries[seriesKey];
        const thinSeries = pliseSeries[thinSeriesKey];
        
        if (!thickSeries || !thinSeries) {
          showCalcError(res, "Невалидна серия.");
          return;
        }
        
        const thickPrice = area * thickSeries.price;
        const thinPrice = area * thinSeries.price;
        price = thickPrice + thinPrice;
        
        content += `<div>Плътен плат: <span class="highlight">${thickSeries.label}</span> (${thickSeries.price.toFixed(2)} €/m²) = ${thickPrice.toFixed(2)} €</div>`;
        content += `<div>Тънък плат: <span class="highlight">${thinSeries.label}</span> (${thinSeries.price.toFixed(2)} €/m²) = ${thinPrice.toFixed(2)} €</div>`;
        
        if (profileColor) {
          const colorLabels = {
            white: "Бял",
            cream: "Крем",
            black: "Черен",
            anthracite: "Антрацит",
            brown: "Кафяв",
            grey: "Сив",
            bronze: "Бронз"
          };
          content += `<div>Цвят на профила: <span class="highlight">${colorLabels[profileColor]}</span></div>`;
        }
      } else {
        // Обикновено плисе
        // #region agent log
        (function(){
          var sk=seriesKey, keys=Object.keys(pliseSeries), hasKey=Object.prototype.hasOwnProperty.call(pliseSeries,sk);
          fetch('http://127.0.0.1:7242/ingest/537fa1da-93c3-4ca3-9276-a16a3540c67b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'calculatePlise single',message:'Plise series lookup',data:{seriesKey:sk,hasKey:hasKey,keysSample:keys},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'H4-H5'})}).catch(function(){});
        })();
        // #endregion
        const series = pliseSeries[seriesKey];
        if (!series) {
          showCalcError(res, "Невалидна серия.");
          return;
        }
        
        price = area * series.price;
        content += `<div>Серия: <span class="highlight">${series.label}</span> (${series.price.toFixed(2)} €/m²)</div>`;
        
        if (profileColor) {
          const colorLabels = {
            white: "Бял",
            cream: "Крем",
            black: "Черен",
            anthracite: "Антрацит",
            brown: "Кафяв",
            grey: "Сив",
            bronze: "Бронз"
          };
          content += `<div>Цвят на профила: <span class="highlight">${colorLabels[profileColor]}</span></div>`;
        }
      }
      
      // Добавяме екстрите
      extras.forEach(key => {
        const extra = pliseExtras[key];
        if (!extra) return;
        price += area * extra.value;
      });
      
      if (extras.length > 0) {
        content += `<div>${formatExtrasSummary(extras, pliseExtras)}</div>`;
      }
      
      content += `<div style="margin-top:12px;font-size:1.4em;">Цена: <strong>${price.toFixed(2)} €</strong></div>`;
      
      showCalcSuccess(res, content);
      // Save result for cart
      lastPliseResult = {
        name: "Плисе",
        price: price,
        details: {
          "Размери": `${formatDimension(widthIn)}×${formatDimension(heightIn)} см`,
          "Квадратура": `${area.toFixed(1)} м²`,
          "Тип": isDouble ? "Двойно" : "Обикновено",
          "Цена": `${price.toFixed(2)} €`
        }
      };
      document.getElementById("plise-add-cart").style.display = "block";
      const historyText = isDouble 
        ? `Двойно плисе: ${formatDimension(widthIn)}×${formatDimension(heightIn)} → ${area.toFixed(1)} м² - ${price.toFixed(2)}€`
        : `Плисе: ${formatDimension(widthIn)}×${formatDimension(heightIn)} → ${area.toFixed(1)} м² - ${price.toFixed(2)}€`;
      pushHistory(pliseCalcHistory, historyText, "plise-history");
    }
    function renderPerdeColorOptions(seriesKey = "") {
      const picker = document.getElementById("perde-color-picker");
      const swatchesWrap = document.getElementById("perde-color-swatches");
      const selectedText = document.getElementById("perde-color-selected");
      if (!picker || !swatchesWrap || !selectedText) return;
      
      if (!seriesKey) {
        perdeColoringRequired = false;
        picker.style.display = "none";
        picker.removeAttribute("data-series");
        resetLamelaColors();
        const summaryEl = document.getElementById("perde-lamela-summary");
        if (summaryEl) {
          summaryEl.textContent = "Разпределение: —";
        }
        return;
      }
      const normalizedKey = (seriesKey || "").toLowerCase();
      const palette = perdeSeriesColors[normalizedKey];
      
      swatchesWrap.innerHTML = "";
      selectedText.textContent = "Няма избран цвят";
      selectedPerdeColor = null;
      
      if (!palette || palette.length === 0) {
        perdeColoringRequired = false;
        picker.style.display = "none";
        picker.removeAttribute("data-series");
        resetLamelaColors();
        return;
      }
      
      const previousSeries = picker.dataset.series;
      if (!previousSeries || previousSeries !== normalizedKey) {
        resetLamelaColors();
      }
      picker.dataset.series = normalizedKey;
      picker.style.display = "block";
      perdeColoringRequired = true;
      
      palette.forEach(color => {
        const option = document.createElement("div");
        option.className = "perde-color-option";
        
        const swatch = document.createElement("div");
        swatch.className = "perde-color-swatch";
        swatch.style.backgroundColor = color.color;
        swatch.dataset.code = color.code;
        swatch.title = `${color.code}${color.name ? " • " + color.name : ""}`;
        swatch.textContent = color.code;
        swatch.addEventListener("click", () => selectPerdeColor(color, swatch));
        
        option.appendChild(swatch);
        swatchesWrap.appendChild(option);
      });
      
      // Calculate proper container width based on number of colors
      const numColors = palette.length;
      const numColumns = Math.ceil(numColors / 3);
      const swatchWidth = 70;
      const gap = 10;
      const calculatedWidth = (numColumns * swatchWidth) + ((numColumns - 1) * gap) + 32;
      picker.style.minWidth = `${calculatedWidth}px`;
    }
    
    function selectPerdeColor(color, swatchElement) {
      if (!color) return;
      selectedPerdeColor = { ...color };
      document.querySelectorAll(".perde-color-swatch").forEach(el => el.classList.remove("active"));
      if (swatchElement) {
        swatchElement.classList.add("active");
      }
      const selectedText = document.getElementById("perde-color-selected");
      if (selectedText) {
        selectedText.textContent = `${color.code}${color.name ? " – " + color.name : ""}`;
      }
    }
    
    function clearPerdeColors() {
      resetLamelaColors(true);
      selectedPerdeColor = null;
      document.querySelectorAll(".perde-color-swatch").forEach(el => el.classList.remove("active"));
      const selectedText = document.getElementById("perde-color-selected");
      if (selectedText) {
        selectedText.textContent = "Няма избран цвят";
      }
    }
    
    function resetLamelaColors(resetFirstFill = true) {
      lamelaColors = [];
      if (resetFirstFill) {
        lamelaFirstFillDone = false;
      }
      document.querySelectorAll(".lamela-item").forEach(el => setLamelaColorStyles(el, null));
      updateLamelaSummary();
    }
    
    function setLamelaColorStyles(element, colorData) {
      if (!element) return;
      if (!colorData) {
        element.style.background = "transparent";
        element.style.borderColor = "#CED4DA";
        element.removeAttribute("data-color-code");
        return;
      }
      element.style.background = colorData.color;
      element.style.borderColor = isDarkColor(colorData.color) ? "#F8F9FA" : "#1A1A1A";
      element.setAttribute("data-color-code", colorData.code);
    }
    
    function setLamelaColorAtIndex(index, colorData) {
      if (!Array.isArray(lamelaColors) || index < 0 || index >= lamelaColors.length) return;
      lamelaColors[index] = colorData ? { ...colorData } : null;
      const lamelaEl = document.querySelector(`.lamela-item[data-index="${index}"]`);
      if (lamelaEl) {
        setLamelaColorStyles(lamelaEl, lamelaColors[index]);
      }
    }
    
    function hasAllLamelaColors() {
      return Array.isArray(lamelaColors) && lamelaColors.length > 0 && lamelaColors.every(color => color && color.code);
    }
    
    function isLamelaColoringComplete() {
      if (!perdeColoringRequired) return true;
      return hasAllLamelaColors();
    }
    
    function ensureLamelaColoringComplete(showAlert = false) {
      const complete = isLamelaColoringComplete();
      if (!complete && showAlert) {
        alert("Моля оцветете всички ламели преди да добавите продукта в кошницата.");
      }
      return complete;
    }
    
    function getLamelaDistributionText() {
      if (!perdeColoringRequired || !hasAllLamelaColors()) return "";
      const segments = [];
      let currentCode = null;
      let count = 0;
      const pushSegment = () => {
        if (count > 0 && currentCode) {
          segments.push(`${count}-${currentCode.toUpperCase()}`);
        }
      };
      lamelaColors.forEach(color => {
        const code = color?.code || null;
        if (code === currentCode) {
          count++;
        } else {
          pushSegment();
          currentCode = code;
          count = code ? 1 : 0;
        }
      });
      pushSegment();
      return segments.join(", ");
    }
    
    function updateLamelaSummary() {
      const summaryEl = document.getElementById("perde-lamela-summary");
      if (!summaryEl) return;
      let summaryValue;
      if (!perdeColoringRequired) {
        summaryValue = "Не е приложимо";
      } else if (hasAllLamelaColors()) {
        summaryValue = getLamelaDistributionText() || "Не е завършено";
      } else if (lamelaColors.length > 0) {
        summaryValue = "Не е завършено";
      } else {
        summaryValue = "Изберете цветове";
      }
      summaryEl.textContent = `Разпределение: ${summaryValue}`;
      if (lastPerdeResult) {
        lastPerdeResult.details = lastPerdeResult.details || {};
        lastPerdeResult.details["Разпределение"] = summaryValue;
      }
    }
    
    function isDarkColor(hexColor) {
      if (!hexColor) return false;
      let hex = hexColor.replace("#", "");
      if (hex.length === 3) {
        hex = hex.split("").map(ch => ch + ch).join("");
      }
      const r = parseInt(hex.substring(0, 2), 16);
      const g = parseInt(hex.substring(2, 4), 16);
      const b = parseInt(hex.substring(4, 6), 16);
      if ([r, g, b].some(v => isNaN(v))) return false;
      const luminance = 0.299 * r + 0.587 * g + 0.114 * b;
      return luminance < 140;
    }
    
    function applyColorToLamela(index) {
      if (!perdeColoringRequired) return;
      if (!selectedPerdeColor) {
        const picker = document.getElementById("perde-color-picker");
        const selectedText = document.getElementById("perde-color-selected");
        if (picker && picker.style.display !== "none" && selectedText) {
          selectedText.textContent = "Изберете цвят и кликнете върху ламела.";
        }
        return;
      }
      if (!Array.isArray(lamelaColors) || lamelaColors.length === 0) {
        alert("Моля изчислете пердето, за да визуализирате ламелите преди оцветяване.");
        return;
      }
      const hasAnyColor = lamelaColors.some(color => color);
      if (!lamelaFirstFillDone || !hasAnyColor) {
        for (let i = 0; i < lamelaColors.length; i++) {
          setLamelaColorAtIndex(i, selectedPerdeColor);
        }
        lamelaFirstFillDone = true;
        updateLamelaSummary();
        return;
      }
      const targets = new Set([index]);
      if (symmetryEnabled && lamelaColors.length > 0) {
        const mirrorIndex = lamelaColors.length - 1 - index;
        targets.add(mirrorIndex);
      }
      targets.forEach(i => {
        if (i >= 0 && i < lamelaColors.length) {
          setLamelaColorAtIndex(i, selectedPerdeColor);
        }
      });
      updateLamelaSummary();
    }
    
    function clearLamelaColor(index) {
      if (!perdeColoringRequired || !Array.isArray(lamelaColors) || lamelaColors.length === 0) return;
      setLamelaColorAtIndex(index, null);
      if (!lamelaColors.some(color => color)) {
        lamelaFirstFillDone = false;
      }
      updateLamelaSummary();
    }
    
    // Calculate number of ламели based on width intervals from the provided table
    // Intervals: 2 ламели (30-36), 3 ламели (37-47), 4 ламели (48-57), etc.
    function calculateLameliCount(width, controlType = "standard") {
      if (!width || width <= 0) return 0;
      const standardIntervals = [
        { min: 30, max: 36, count: 2 },
        { min: 37, max: 47, count: 3 },
        { min: 48, max: 57, count: 4 },
        { min: 58, max: 68, count: 5 },
        { min: 69, max: 78, count: 6 },
        { min: 79, max: 89, count: 7 },
        { min: 90, max: 99, count: 8 },
        { min: 100, max: 110, count: 9 },
        { min: 111, max: 120, count: 10 },
        { min: 121, max: 131, count: 11 },
        { min: 132, max: 141, count: 12 },
        { min: 142, max: 152, count: 13 },
        { min: 153, max: 162, count: 14 },
        { min: 163, max: 173, count: 15 },
        { min: 174, max: 183, count: 16 },
        { min: 184, max: 194, count: 17 },
        { min: 195, max: 204, count: 18 },
        { min: 205, max: 215, count: 19 },
        { min: 216, max: 225, count: 20 },
        { min: 226, max: 236, count: 21 },
        { min: 237, max: 246, count: 22 },
        { min: 247, max: 257, count: 23 },
        { min: 258, max: 267, count: 24 },
        { min: 268, max: 278, count: 25 },
        { min: 279, max: 288, count: 26 },
        { min: 289, max: 299, count: 27 },
        { min: 300, max: 309, count: 28 },
        { min: 310, max: 320, count: 29 },
        { min: 321, max: 330, count: 30 },
        { min: 331, max: 341, count: 31 }
      ];
      const splitIntervals = [
        { min: 30, max: 38, count: 2 },
        { min: 39, max: 59, count: 4 },
        { min: 60, max: 80, count: 6 },
        { min: 81, max: 101, count: 8 },
        { min: 102, max: 122, count: 10 },
        { min: 123, max: 143, count: 12 },
        { min: 144, max: 164, count: 14 },
        { min: 165, max: 185, count: 16 },
        { min: 186, max: 206, count: 18 },
        { min: 207, max: 227, count: 20 },
        { min: 228, max: 248, count: 22 },
        { min: 249, max: 269, count: 24 },
        { min: 270, max: 290, count: 26 },
        { min: 291, max: 311, count: 28 },
        { min: 312, max: 332, count: 30 },
        { min: 333, max: 353, count: 32 }
      ];
      
      const intervals = controlType === "razdelno" ? splitIntervals : standardIntervals;
      
      // Find the interval that contains the width
      for (let i = 0; i < intervals.length; i++) {
        if (width >= intervals[i].min && width <= intervals[i].max) {
          return intervals[i].count;
        }
      }
      
      // If width is less than minimum, return minimum count
      const minInterval = intervals[0];
      const maxInterval = intervals[intervals.length - 1];
      if (width < minInterval.min) return minInterval.count;
      
      // If width is greater than maximum, return maximum count
      if (width > maxInterval.max) return maxInterval.count;
      
      // Default fallback
      return 0;
    }
    
    /* 
    // Visualize ламели
    function visualizeLameli(count, width) {
      const visualizationDiv = document.getElementById("perde-lameli-visualization");
      const countSpan = document.getElementById("perde-lameli-count");
      const containerDiv = document.getElementById("perde-lameli-container");
      
      if (!visualizationDiv || !countSpan || !containerDiv) return;
      
      if (count <= 0) {
        visualizationDiv.style.display = "none";
        resetLamelaColors();
        return;
      }
      
      // Update count
      countSpan.textContent = count;
      
      // Clear container
      containerDiv.innerHTML = "";
      
      if (!Array.isArray(lamelaColors)) {
        lamelaColors = [];
      }
      lamelaColors = lamelaColors.slice(0, count);
      while (lamelaColors.length < count) {
        lamelaColors.push(null);
      }
      
      // Create visual representation of each ламел
      // Calculate approximate width per ламел
      const widthPerLamela = (width / count).toFixed(1);
      
      for (let i = 1; i <= count; i++) {
        const lamelaDiv = document.createElement("div");
        lamelaDiv.className = "lamela-item";
        lamelaDiv.title = `Ламел ${i} • ~${widthPerLamela} см`;
        const index = i - 1;
        lamelaDiv.dataset.index = index;
        lamелаDiv.addEventListener("click", () => applyColorToLamela(index));
        lamелаDiv.addEventListener("dblclick", () => clearLamelaColor(index));
        lamelaDiv.addEventListener("contextmenu", (event) => {
          event.preventDefault();
          clearLamelaColor(index);
        });
        if (lamелаColors[index]) {
          setLamelaColorStyles(lamelaDiv, lamелаColors[index]);
        }
        containerDiv.appendChild(lamelaDiv);
      }
      
      // Show visualization
      visualizationDiv.style.display = "block";
    }
    */

    // Override with color-aware lameli visualization (fixes Unicode identifier issues above)
    function visualizeLameli(count, width) {
      const visualizationDiv = document.getElementById("perde-lameli-visualization");
      const countSpan = document.getElementById("perde-lameli-count");
      const containerDiv = document.getElementById("perde-lameli-container");
      if (!visualizationDiv || !countSpan || !containerDiv) return;
      if (count <= 0) {
        visualizationDiv.style.display = "none";
        resetLamelaColors();
        return;
      }
      countSpan.textContent = count;
      containerDiv.innerHTML = "";
      lamelaColors = new Array(count).fill(null);
      lamelaFirstFillDone = false;
      const widthPerLamela = (width / count).toFixed(1);
      for (let i = 1; i <= count; i++) {
        const lamelaDiv = document.createElement("div");
        lamelaDiv.className = "lamela-item";
        lamelaDiv.title = `Ламел ${i} • ~${widthPerLamela} см`;
        const index = i - 1;
        lamelaDiv.dataset.index = index;
        lamelaDiv.addEventListener("click", () => applyColorToLamela(index));
        lamelaDiv.addEventListener("dblclick", () => clearLamelaColor(index));
        lamelaDiv.addEventListener("contextmenu", (event) => {
          event.preventDefault();
          clearLamelaColor(index);
        });
        if (lamelaColors[index]) {
          setLamelaColorStyles(lamelaDiv, lamelaColors[index]);
        }
        containerDiv.appendChild(lamelaDiv);
      }
      visualizationDiv.style.display = "block";
      updateLamelaSummary();
    }
    
    function calculatePerde() {
      const widthIn = parseFloat(document.getElementById("perde-width").value);
      const heightIn = parseFloat(document.getElementById("perde-height").value);
      const seriesKey = document.getElementById("perde-series").value;
      const control = document.getElementById("perde-control").value;
      const shapeType = document.querySelector("input[name='perde-shape']:checked");
      const nonStandard = shapeType && shapeType.value === "skosheni";
      const res = document.getElementById("perde-result");
      if (isNaN(widthIn) || isNaN(heightIn) || !seriesKey || !control) {
        showCalcError(res, "Попълнете всички полета!");
        return;
      }
      // Максимум от таблицата
      const max = maxDimensions.perde;
      if (widthIn > max.maxWidth || heightIn > max.maxHeight) {
        showCalcError(res, `Максимални размери: ${max.maxWidth} см ширина × ${max.maxHeight} см височина.`);
        return;
      }
      let width = roundUpTo10(widthIn);
      let height = roundUpTo10(heightIn);
      if (width < 100) width = 100;
      if (height < 200) height = 200;
      if (seriesKey === "jp" && height < 300) height = 300;
      const series = getPerdeSeries()[seriesKey];
      if (!series) {
        showCalcError(res, "Невалидна серия.");
        return;
      }
      if (typeof renderPerdeColorOptions === "function") renderPerdeColorOptions(seriesKey);
      var palette = perdeSeriesColors[seriesKey.toLowerCase()];
      perdeColoringRequired = !!(palette && palette.length > 0);
      const colorLabel = selectedPerdeColor ? `${selectedPerdeColor.code}${selectedPerdeColor.name ? ` (${selectedPerdeColor.name})` : ""}` : null;
      const colorLine = colorLabel ? `<div>Цвят: <span class="highlight">${colorLabel}</span></div>` : "";
      const area = (width / 100) * (height / 100);
      let price = area * series.price;
      if (nonStandard) price *= 1.3;
      const controlLabels = {
        "kum_vuzheto": "Събиране към въжето",
        "sreshtu_vuzheto": "Събиране срещу въжето",
        "razdelno": "Разделно събиране"
      };
      const controlLabel = controlLabels[control] || control;
      const extrasLabel = nonStandard ? "Екстри: Скосени (+30%)" : "Екстри: Няма";
      const lamelaDistribution = getLamelaDistributionText();
      const lamelaSummaryValue = !perdeColoringRequired ? "Не е приложимо" : (lamelaDistribution || "Не е завършено");
      const lamelaSummaryLine = perdeColoringRequired ? `<div>Разпределение: <span class="highlight">${lamelaSummaryValue}</span></div>` : "";
      const content = `
        <div>Размери: ${formatDimension(widthIn)}×${formatDimension(heightIn)} см → <strong>${width}×${height} см</strong></div>
        <div>Серия: <span class="highlight">${series.label}</span> (${series.price.toFixed(2)} €/m²)</div>
        ${colorLine}
        <div>Събиране: <span class="highlight">${controlLabel}</span></div>
        <div>${extrasLabel}</div>
        ${lamelaSummaryLine}
        <div style="margin-top:12px;font-size:1.4em;">Цена: <strong>${price.toFixed(2)} €</strong></div>
      `;
      showCalcSuccess(res, content);
      
      // Calculate and visualize ламели
      const lameliCount = calculateLameliCount(widthIn, control);
      visualizeLameli(lameliCount, widthIn);
      
      // Save result for cart
      lastPerdeResult = {
        name: "Перде-Щора",
        price: price,
        details: {
          "Размери": `${formatDimension(widthIn)}×${formatDimension(heightIn)} см → ${width}×${height} см`,
          "Серия": series.label,
          "Цвят": colorLabel || "Не е избран",
          "Цена за м²": `${series.price.toFixed(2)} €`,
          "Събиране": controlLabel,
          "Тип": nonStandard ? "Скосени" : "Стандартно",
          "Квадратура": `${area.toFixed(2)} м²`,
          "Брой ламели": `${lameliCount}`
        }
      };
      if (perdeColoringRequired) {
        lastPerdeResult.details["Разпределение"] = lamelaSummaryValue;
      }
      document.getElementById("perde-add-cart").style.display = "block";
      pushHistory(perdeCalcHistory, `Перде-Щора: ${formatDimension(widthIn)}×${formatDimension(heightIn)} → ${width}×${height} - ${price.toFixed(2)}€`, "perde-history");
    }
    function calculateDreveni() {
      const widthIn = parseFloat(document.getElementById("dreveni-width").value);
      const heightIn = parseFloat(document.getElementById("dreveni-height").value);
      const type = document.getElementById("dreveni-type").value;
      const control = document.getElementById("dreveni-control").value;
      const res = document.getElementById("dreveni-result");
      
      if (isNaN(widthIn) || isNaN(heightIn) || widthIn <= 0 || heightIn <= 0 || !type || !control) {
        showCalcError(res, "Попълнете всички полета!");
        return;
      }
      const maxWidth = 300;
      if (widthIn > maxWidth) {
        showCalcError(res, `Максимална ширина: ${maxWidth} см.`);
        return;
      }
      
      // Изчисляваме площта в квадратни метри
      const areaRaw = (widthIn / 100) * (heightIn / 100);
      let area;
      if (areaRaw < 1) {
        area = 1;
      } else {
        area = Math.ceil(areaRaw * 10) / 10;
      }
      
      // Цена: 66 €/m²
      const pricePerM2 = 66;
      let price = area * pricePerM2;
      
      const extras = Array.from(document.querySelectorAll(".dreveni-extra:checked"));
      let extrasSummary = "Екстри: Няма";
      if (extras.length > 0) {
        const summaryParts = [];
        extras.forEach(extra => {
          const value = parseFloat(extra.dataset.value || "0");
          if (isNaN(value) || value === 0) return;
          price += area * value;
          const label = extra.dataset.label || "Екстра";
          summaryParts.push(`${label} (+${value.toFixed(2)} €/м²)`);
        });
        if (summaryParts.length > 0) {
          extrasSummary = `Екстри: ${summaryParts.join(", ")}`;
        }
      }
      
      const controlLabel = control === "left" ? "Ляво" : "Дясно";
      const content = `
        <div>Размери: <strong>${formatDimension(widthIn)}×${formatDimension(heightIn)} см</strong></div>
        <div>Вид: <span class="highlight">${type}</span></div>
        <div>Квадратура: ${areaRaw.toFixed(2)} м² → <strong>${area.toFixed(1)} м²</strong></div>
        <div>Цена: <strong>${pricePerM2.toFixed(2)} €/м²</strong></div>
        <div>Управление: <span class="highlight">${controlLabel}</span></div>
        <div>${extrasSummary}</div>
        <div style="margin-top:12px;font-size:1.4em;">Обща цена: <strong>${price.toFixed(2)} €</strong></div>
      `;
      showCalcSuccess(res, content);
      // Save result for cart
      lastDreveniResult = {
        name: "Дървени Щори",
        price: price,
        details: {
          "Размери": `${formatDimension(widthIn)}×${formatDimension(heightIn)} см`,
          "Вид": type,
          "Квадратура": `${area.toFixed(1)} м²`,
          "Цена за м²": `${pricePerM2.toFixed(2)} €`,
          "Управление": controlLabel,
          "Екстри": extrasSummary !== "Екстри: Няма" ? extrasSummary : "Няма екстри"
        }
      };
      document.getElementById("dreveni-add-cart").style.display = "block";
      pushHistory(dreveniHistory, `Дървени Щори: ${formatDimension(widthIn)}×${formatDimension(heightIn)} → ${area.toFixed(1)} м² - ${price.toFixed(2)}€`, "dreveni-history");
    }
    function getHeightIndex(height, type) {
      if (type === 'single') {
        if (height <= 70) return 0;
        return Math.min(16, Math.floor((height - 71) / 10) + 1);
      }
      const minH = 141;
      if (height < minH) return 0;
      return Math.min(Math.floor((height - minH) / 10), 10);
    }
    function getWidthIndex(width, type) {
      if (type === 'single') {
        if (width <= 50) return 0;
        return Math.min(14, Math.floor((width - 51) / 10) + 1);
      }
      const minW = 111;
      if (width < minW) return 0;
      return Math.min(Math.floor((width - minW) / 10), 14);
    }
    function calculate() {
      const type = document.getElementById("type").value;
      const profile = document.getElementById("profile").value;
      const wStr = document.getElementById("width").value;
      const hStr = document.getElementById("height").value;
      const result = document.getElementById("result");
      const w = parseFloat(wStr);
      const h = parseFloat(hStr);
      if (isNaN(w) || isNaN(h) || w <= 0 || h <= 0) {
        result.innerHTML = "Въведете валидни размери!";
        result.style.display = "block";
        return;
      }
      // Максимум от таблицата
      const max = type === "single" ? maxDimensions.mosquito : maxDimensions.mosquitoDouble;
      if (w > max.maxWidth) {
        result.innerHTML = `Максимална ширина: ${max.maxWidth} см.`;
        result.style.display = "block";
        result.style.background = "#fadbd8";
        result.style.color = "#c0392b";
        return;
      }
      if (h > max.maxHeight) {
        result.innerHTML = `Максимална височина: ${max.maxHeight} см.`;
        result.style.display = "block";
        result.style.background = "#fadbd8";
        result.style.color = "#c0392b";
        return;
      }
      let data;
      if (type === "single") {
        if (profile === "white") data = singleWhite;
        else if (profile === "color") data = singleColor;
        else if (profile === "flander") data = singleFlander;
      } else if (type === "double") {
        if (profile === "white") data = doubleWhite;
        else if (profile === "color") data = doubleColor;
        else if (profile === "flander") data = doubleFlander;
      }
      if (!data) { result.innerHTML = "Невалиден тип!"; result.style.display = "block"; return; }
      const wIndex = getWidthIndex(w, type);
      const hIndex = getHeightIndex(h, type);
      if (hIndex >= data.length || wIndex >= data[0].length) {
        result.innerHTML = "Размери извън таблицата!";
        result.style.display = "block";
        return;
      }
      let priceStr = data[hIndex][wIndex];
      priceStr = priceStr.replace(',', '.').replace('€', '');
      const price = parseFloat(priceStr);
      result.innerHTML = `Цена: <strong>${price.toFixed(2)} €</strong>`;
      result.style.display = "block";
      result.style.background = "#eafaf1";
      result.style.color = "#1e8449";
      // Save result for cart
      const typeLabel = type === "single" ? "Еднокрилен" : "Двукрилен";
      const profileLabel = profile === "white" ? "Бял профил" : profile === "color" ? "Цветен профил" : "Фладер";
      lastMosquitoResult = {
        name: "Комарник",
        price: price,
        details: {
          "Тип": typeLabel,
          "Профил": profileLabel,
          "Размери": `${w}×${h} см`,
          "Цена": `${price.toFixed(2)} €`
        }
      };
      document.getElementById("mosquito-add-cart").style.display = "block";
      history.push(`${type} ${profile}: ${w}×${h} → ${price.toFixed(2)}€`);
      if (history.length > 5) history.shift();
      updateHistory();
    }
    function updateHistory() {
      const hist = document.getElementById("history");
      hist.innerHTML = "<strong>Последни резултати:</strong><br>" + history.slice().reverse().join("<br>");
    }
    async function downloadProductAsImage(contentId, productName) {
      const section = document.getElementById(contentId);
      if (!section) {
        alert("Секцията не е намерена.");
        return;
      }
      
      // Use desktop width for consistent rendering (1200px matches accordion max-width)
      const containerWidth = 1200;
      
      // Create container
      const container = document.createElement("div");
      container.style.padding = "20px";
      container.style.background = "#fff";
      container.style.width = containerWidth + "px";
      container.style.minWidth = containerWidth + "px";
      container.style.maxWidth = containerWidth + "px";
      container.style.position = "absolute";
      container.style.left = "0";
      container.style.top = "0";
      container.style.zIndex = "9999";
      container.style.boxSizing = "border-box";
      
      // Add title
      const title = document.createElement("h2");
      title.textContent = productName;
      title.style.textAlign = "center";
      title.style.marginBottom = "20px";
      title.style.fontSize = "22px";
      title.style.fontWeight = "bold";
      title.style.width = "100%";
      title.style.boxSizing = "border-box";
      container.appendChild(title);
      
      // Clone content
      const clone = section.cloneNode(true);
      clone.style.display = "block";
      clone.style.maxHeight = "none";
      clone.style.overflow = "visible";
      clone.style.width = "100%";
      clone.style.boxSizing = "border-box";
      
      // Remove unwanted elements
      clone.querySelectorAll(".calculator, .history, .calc-result, .pdf-button, .download-button, .button-group").forEach(el => el.remove());
      
      // Fix tables and containers for mobile
      clone.querySelectorAll("table").forEach(table => {
        table.style.width = "100%";
        table.style.maxWidth = "100%";
        table.style.tableLayout = "auto";
        table.style.boxSizing = "border-box";
        table.style.wordWrap = "break-word";
        table.querySelectorAll("th, td").forEach(cell => {
          cell.style.wordWrap = "break-word";
          cell.style.overflowWrap = "break-word";
          cell.style.maxWidth = "100%";
        });
      });
      
      clone.querySelectorAll(".table-container").forEach(container => {
        container.style.width = "100%";
        container.style.maxWidth = "100%";
        container.style.overflow = "visible";
        container.style.boxSizing = "border-box";
      });
      
      clone.querySelectorAll("h3").forEach(h3 => {
        h3.style.width = "100%";
        h3.style.boxSizing = "border-box";
      });
      
      container.appendChild(clone);
      document.body.appendChild(container);
      
      // Wait for rendering
      await new Promise(resolve => setTimeout(resolve, 800));
      
      // Force reflow
      container.offsetHeight;
      
      try {
        // Load html2canvas if needed
        if (typeof html2canvas === "undefined") {
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
          document.head.appendChild(script);
          await new Promise((resolve, reject) => {
            script.onload = resolve;
            script.onerror = reject;
            setTimeout(reject, 10000);
          });
        }
        
        // Get actual dimensions
        const actualWidth = Math.max(container.scrollWidth, container.offsetWidth, containerWidth);
        const actualHeight = Math.max(container.scrollHeight, container.offsetHeight);
        
        // Create canvas with proper dimensions - use desktop width for consistent rendering
        const canvas = await html2canvas(container, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          logging: false,
          width: actualWidth,
          height: actualHeight,
          windowWidth: actualWidth,
          windowHeight: actualHeight,
          x: 0,
          y: 0
        });
        
        // Download
        const link = document.createElement('a');
        link.download = `${productName.replace(/\s+/g, '-')}.png`;
        link.href = canvas.toDataURL('image/png');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        document.body.removeChild(container);
      } catch (err) {
        console.error("Error:", err);
        if (container.parentNode) {
          document.body.removeChild(container);
        }
        alert("Грешка: " + err.message);
      }
    }
    
    async function downloadAllTablesAsImage() {
      alert("Започва генериране на изображение... Моля изчакайте.");
      
      // Create container for all content
      const container = document.createElement("div");
      container.style.padding = "20px";
      container.style.background = "#fff";
      container.style.width = "100%";
      container.style.position = "absolute";
      container.style.left = "0";
      container.style.top = "0";
      container.style.zIndex = "9999";
      
      // Add title
      const title = document.createElement("h1");
      title.textContent = "ЦЕНОВИ ЛИСТИ ЗА ДИСТРИБУТОРИ - ВСИЧКИ ТАБЛИЦИ";
      title.style.textAlign = "center";
      title.style.marginBottom = "30px";
      title.style.fontSize = "24px";
      title.style.fontWeight = "bold";
      container.appendChild(title);
      
      // Collect all tables
      document.querySelectorAll(".accordion").forEach((accordion) => {
        const accordionHeader = accordion.querySelector(".accordion-header");
        const accordionTitle = accordionHeader ? accordionHeader.textContent.trim() : "";
        const tables = accordion.querySelectorAll("table");
        
        if (tables.length > 0) {
          const sectionDiv = document.createElement("div");
          sectionDiv.style.marginBottom = "40px";
          
          const sectionTitle = document.createElement("h2");
          sectionTitle.textContent = accordionTitle;
          sectionTitle.style.fontSize = "20px";
          sectionTitle.style.fontWeight = "bold";
          sectionTitle.style.marginBottom = "20px";
          sectionDiv.appendChild(sectionTitle);
          
          tables.forEach((table) => {
            const tableClone = table.cloneNode(true);
            tableClone.style.marginBottom = "25px";
            sectionDiv.appendChild(tableClone);
          });
          
          container.appendChild(sectionDiv);
        }
      });
      
      document.body.appendChild(container);
      
      // Wait for rendering
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      try {
        // Load html2canvas if not available
        if (typeof html2canvas === "undefined") {
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
          document.head.appendChild(script);
          await new Promise((resolve, reject) => {
            script.onload = resolve;
            script.onerror = reject;
            setTimeout(reject, 10000); // 10 second timeout
          });
        }
        
        // Use html2canvas directly
        console.log("Rendering with html2canvas...");
        const canvas = await html2canvas(container, {
          scale: 1,
          useCORS: true,
          allowTaint: true,
          logging: true,
          width: container.scrollWidth,
          height: container.scrollHeight
        });
        
        console.log("Canvas created:", canvas.width, "x", canvas.height);
        
        // Download as PNG
        const link = document.createElement('a');
        link.download = 'всички-таблици.png';
        link.href = canvas.toDataURL('image/png');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        document.body.removeChild(container);
        alert("Изображението е изтеглено успешно!");
      } catch (err) {
        console.error("Error:", err);
        if (container.parentNode) {
          document.body.removeChild(container);
        }
        alert("Грешка: " + err.message + ". Проверете конзолата за подробности.");
      }
    }
    
    async function downloadAllTables() {
      if (typeof html2pdf === "undefined") {
        alert("PDF функционалността не е достъпна. Проверете интернет връзката.");
        return;
      }
      
      // Create main container for all content - must be visible for html2canvas
      const mainContainer = document.createElement("div");
      mainContainer.setAttribute("data-pdf-container", "true");
      mainContainer.style.padding = "10mm";
      mainContainer.style.background = "#fff";
      mainContainer.style.boxSizing = "border-box";
      mainContainer.style.position = "absolute";
      mainContainer.style.left = "0";
      mainContainer.style.top = "0";
      mainContainer.style.width = "auto";
      mainContainer.style.height = "auto";
      mainContainer.style.overflow = "visible";
      // Keep it visible but off-screen
      mainContainer.style.transform = "translateX(-200%)";
      mainContainer.style.zIndex = "1";
      
      // Add main title
      const mainTitle = document.createElement("h1");
      mainTitle.textContent = "ЦЕНОВИ ЛИСТИ ЗА ДИСТРИБУТОРИ - ВСИЧКИ ТАБЛИЦИ";
      mainTitle.style.textAlign = "center";
      mainTitle.style.marginBottom = "30px";
      mainTitle.style.fontSize = "20pt";
      mainTitle.style.fontWeight = "bold";
      mainTitle.setAttribute("data-bookmark", "true");
      mainContainer.appendChild(mainTitle);
      
      // Collect all sections
      const sections = [];
      let totalTables = 0;
      document.querySelectorAll(".accordion").forEach((accordion) => {
        const accordionHeader = accordion.querySelector(".accordion-header");
        const accordionTitle = accordionHeader ? accordionHeader.textContent.trim() : "";
        const tables = accordion.querySelectorAll("table");
        
        if (tables.length > 0) {
          totalTables += tables.length;
          // Create section wrapper
          const sectionWrapper = document.createElement("div");
          sectionWrapper.setAttribute("data-section", accordionTitle);
          sectionWrapper.style.marginBottom = "40px";
          sectionWrapper.style.pageBreakInside = "auto"; // Allow page breaks between sections
          sectionWrapper.style.pageBreakAfter = "auto";
          sectionWrapper.style.breakInside = "auto";
          
          // Add section title with page break control
          const sectionTitle = document.createElement("h2");
          sectionTitle.textContent = accordionTitle;
          sectionTitle.style.marginTop = "30px";
          sectionTitle.style.marginBottom = "20px";
          sectionTitle.style.fontSize = "16pt";
          sectionTitle.style.fontWeight = "bold";
          sectionTitle.style.pageBreakAfter = "avoid";
          sectionTitle.style.breakAfter = "avoid";
          sectionTitle.setAttribute("data-bookmark", "true");
          sectionWrapper.appendChild(sectionTitle);
          
          // Clone and style tables with page break protection
          tables.forEach((table, tableIndex) => {
            const tableClone = table.cloneNode(true);
            tableClone.style.fontSize = "7pt";
            tableClone.style.width = "100%";
            tableClone.style.tableLayout = "auto";
            tableClone.style.borderCollapse = "collapse";
            tableClone.style.marginBottom = "25px";
            tableClone.style.overflow = "visible";
            tableClone.style.pageBreakInside = "avoid";
            tableClone.style.breakInside = "avoid";
            
            // Wrap table in a div to ensure it stays together
            const tableDiv = document.createElement("div");
            tableDiv.style.pageBreakInside = "avoid";
            tableDiv.style.breakInside = "avoid";
            tableDiv.style.pageBreakAfter = tableIndex === tables.length - 1 ? "auto" : "avoid";
            tableDiv.style.breakAfter = tableIndex === tables.length - 1 ? "auto" : "avoid";
            tableDiv.style.marginBottom = "25px";
            
            tableClone.querySelectorAll("th, td").forEach(cell => {
              cell.style.padding = "5px 3px";
              cell.style.fontSize = "7pt";
              cell.style.whiteSpace = "nowrap";
              cell.style.overflow = "visible";
              cell.style.textOverflow = "clip";
            });
            
            tableDiv.appendChild(tableClone);
            sectionWrapper.appendChild(tableDiv);
          });
          
          mainContainer.appendChild(sectionWrapper);
          sections.push(accordionTitle);
        }
      });
      
      if (sections.length === 0 || totalTables === 0) {
        alert("Няма таблици за експорт. Намерени секции: " + sections.length + ", таблици: " + totalTables);
        return;
      }
      
      console.log("PDF Export: Found", sections.length, "sections with", totalTables, "tables total");
      
      // Calculate required width - check all tables more accurately
      let maxRequiredWidth = 0;
      mainContainer.querySelectorAll("table").forEach(table => {
        const colCount = table.querySelectorAll("th").length || table.querySelectorAll("tr:first-child td").length;
        // More accurate estimation: 
        // - Small columns (numbers): ~12mm each
        // - Medium columns (text): ~18mm each  
        // - Wide columns (headers): ~25mm each
        // Add 20% buffer for safety
        const baseWidth = colCount <= 5 ? colCount * 25 : colCount <= 10 ? colCount * 20 : colCount * 18;
        const estimatedWidth = Math.max(350, baseWidth * 1.2); // 20% buffer
        maxRequiredWidth = Math.max(maxRequiredWidth, estimatedWidth);
      });
      
      // Set container width (ensure enough space, allow up to 600mm for very wide tables)
      const containerWidth = Math.min(Math.max(350, maxRequiredWidth), 600);
      mainContainer.style.width = containerWidth + "mm";
      mainContainer.style.minWidth = containerWidth + "mm";
      mainContainer.style.maxWidth = containerWidth + "mm";
      
      document.body.appendChild(mainContainer);
      
      // Wait for rendering and force reflow - longer wait for large content
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      // Force layout recalculation multiple times
      mainContainer.offsetHeight;
      mainContainer.scrollHeight;
      await new Promise(resolve => setTimeout(resolve, 300));
      
      // Get actual content dimensions in pixels
      const contentWidth = mainContainer.offsetWidth || mainContainer.scrollWidth;
      const contentHeight = mainContainer.offsetHeight || mainContainer.scrollHeight;
      
      console.log("Container dimensions:", contentWidth, "x", contentHeight, "px");
      console.log("Container has", mainContainer.querySelectorAll("table").length, "tables");
      
      // Verify tables are actually rendered
      const firstTable = mainContainer.querySelector("table");
      if (firstTable) {
        console.log("First table dimensions:", firstTable.offsetWidth, "x", firstTable.offsetHeight);
        console.log("First table has", firstTable.querySelectorAll("tr").length, "rows");
      }
      
      // Use html2pdf with custom page size
      const removeContainer = () => {
        if (mainContainer.parentNode) {
          mainContainer.parentNode.removeChild(mainContainer);
        }
      };
      
      // Verify we have content
      if (contentWidth === 0 || contentHeight === 0) {
        const tableCount = mainContainer.querySelectorAll("table").length;
        alert("Грешка: Съдържанието не е рендирано правилно. Ширина: " + contentWidth + "px, Височина: " + contentHeight + "px, Таблици: " + tableCount);
        removeContainer();
        return;
      }
      
      // Calculate page dimensions in mm
      // html2canvas renders at device pixel ratio, so we need to account for that
      const scale = 2;
      const pxToMm = 0.264583; // 1px = 0.264583mm at 96dpi
      const widthMM = Math.max(210, Math.ceil((contentWidth * pxToMm) + 20)); // Min A4 width, add padding
      const heightMM = Math.max(297, Math.ceil((contentHeight * pxToMm) + 20)); // Min A4 height, add padding
      
      try {
        // Use landscape A4 for wide tables
        const useLandscape = widthMM > 297;
        const pageWidth = useLandscape ? 297 : 210; // A4 dimensions in mm
        const pageHeight = useLandscape ? 210 : 297;
        
        // Remove transform and make container fully visible for html2canvas
        mainContainer.style.transform = "none";
        mainContainer.style.position = "absolute";
        mainContainer.style.left = "0";
        mainContainer.style.top = "0";
        mainContainer.style.width = containerWidth + "mm";
        mainContainer.style.zIndex = "1";
        mainContainer.style.opacity = "1";
        
        // Wait for styles to apply and force reflow
        await new Promise(resolve => setTimeout(resolve, 500));
        mainContainer.offsetHeight; // Force reflow
        
        console.log("Starting PDF generation with dimensions:", contentWidth, "x", contentHeight);
        console.log("Container width set to:", containerWidth, "mm");
        
        // Verify container is visible and has content
        const finalWidth = mainContainer.offsetWidth;
        const finalHeight = mainContainer.offsetHeight;
        const tableCount = mainContainer.querySelectorAll("table").length;
        console.log("Final container check - Width:", finalWidth, "Height:", finalHeight, "Tables:", tableCount);
        
        if (finalWidth === 0 || finalHeight === 0) {
          alert("Грешка: Контейнерът не е видим. Ширина: " + finalWidth + "px, Височина: " + finalHeight + "px");
          removeContainer();
          return;
        }
        
        // Use html2pdf but with outputPdf to get the PDF data and verify it
        console.log("Starting PDF generation...");
        
        try {
          // First, try to get the PDF as blob to verify it's being created
          const pdfBlob = await html2pdf().set({
            margin: [0, 0, 0, 0],
            html2canvas: { 
              scale: 1.5,
              useCORS: true,
              allowTaint: true,
              logging: false,
              letterRendering: true,
              scrollX: 0,
              scrollY: 0
            },
            jsPDF: { 
              unit: "mm", 
              format: [pageWidth, pageHeight],
              orientation: useLandscape ? "landscape" : "portrait",
              compress: true
            },
            pagebreak: { 
              mode: ['css', 'legacy'],
              avoid: ['table', 'div[style*="page-break-inside: avoid"]']
            }
          }).from(mainContainer).outputPdf('blob');
          
          console.log("PDF blob created, size:", pdfBlob.size, "bytes");
          
          if (pdfBlob.size < 1000) {
            console.warn("PDF is too small, might be empty!");
          }
          
          // Save the PDF
          const url = URL.createObjectURL(pdfBlob);
          const link = document.createElement('a');
          link.href = url;
          link.download = "всички-таблици.pdf";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
          
          console.log("PDF saved successfully");
          removeContainer();
        } catch (err) {
          console.error("Error with outputPdf, trying save() instead:", err);
          
          // Fallback to save() method
          await html2pdf().set({
            margin: [0, 0, 0, 0],
            filename: "всички-таблици.pdf",
            html2canvas: { 
              scale: 1.5,
              useCORS: true,
              allowTaint: true,
              logging: false,
              letterRendering: true,
              scrollX: 0,
              scrollY: 0
            },
            jsPDF: { 
              unit: "mm", 
              format: [pageWidth, pageHeight],
              orientation: useLandscape ? "landscape" : "portrait",
              compress: true
            },
            pagebreak: { 
              mode: ['css', 'legacy'],
              avoid: ['table', 'div[style*="page-break-inside: avoid"]']
            }
          }).from(mainContainer).save();
          
          console.log("PDF saved with save() method");
          removeContainer();
        }
      } catch (err) {
        console.error("PDF generation error:", err);
        removeContainer();
        alert("Грешка при генериране на PDF: " + err.message);
      }
    }
    
    async function downloadAllTablesManual() {
      if (typeof html2pdf === "undefined") {
        alert("PDF функционалността не е достъпна.");
        return;
      }
      
      const confirmDownload = confirm("Този метод ще генерира отделен PDF файл за всеки продукт. Искате ли да продължите?");
      if (!confirmDownload) return;
      
      // Collect all sections
      const sections = [];
      document.querySelectorAll(".accordion").forEach((accordion) => {
        const accordionHeader = accordion.querySelector(".accordion-header");
        const accordionTitle = accordionHeader ? accordionHeader.textContent.trim() : "";
        const tables = accordion.querySelectorAll("table");
        
        if (tables.length > 0) {
          sections.push({
            title: accordionTitle,
            element: accordion
          });
        }
      });
      
      if (sections.length === 0) {
        alert("Няма таблици за експорт.");
        return;
      }
      
      alert(`Ще се генерират ${sections.length} PDF файла. Моля изчакайте...`);
      
      // Generate PDF for each section separately
      for (let i = 0; i < sections.length; i++) {
        const section = sections[i];
        
        // Find the content div for this section
        const contentDiv = section.element.querySelector('[id$="-content"]');
        if (!contentDiv) {
          console.warn(`No content div found for ${section.title}`);
          continue;
        }
        
        // Clone the content
        const clone = contentDiv.cloneNode(true);
        clone.style.display = "block";
        clone.style.maxHeight = "none";
        clone.style.overflow = "visible";
        clone.querySelectorAll(".calculator, .history, .calc-result, .pdf-button").forEach(el => el.remove());
        
        // Determine page size
        const firstTable = clone.querySelector("table");
        const colCount = firstTable ? (firstTable.querySelectorAll("th").length || firstTable.querySelectorAll("tr:first-child td").length) : 0;
        const useLandscape = colCount > 10;
        
        // Create wrapper
        const wrapper = document.createElement("div");
        wrapper.style.padding = "10mm";
        wrapper.style.background = "#fff";
        wrapper.style.width = useLandscape ? "297mm" : "210mm";
        wrapper.style.position = "absolute";
        wrapper.style.left = "0";
        wrapper.style.top = "0";
        wrapper.appendChild(clone);
        document.body.appendChild(wrapper);
        
        // Wait for rendering
        await new Promise(resolve => setTimeout(resolve, 300));
        
        try {
          await html2pdf().set({
            margin: [0, 0, 0, 0],
            filename: `${section.title.replace(/\s+/g, '-')}.pdf`,
            html2canvas: {
              scale: 1.5,
              useCORS: true,
              allowTaint: true,
              logging: false
            },
            jsPDF: {
              unit: "mm",
              format: "a4",
              orientation: useLandscape ? "landscape" : "portrait",
              compress: true
            },
            pagebreak: {
              mode: ['css', 'legacy'],
              avoid: ['table']
            }
          }).from(wrapper).save();
          
          console.log(`PDF generated for: ${section.title}`);
        } catch (err) {
          console.error(`Error generating PDF for ${section.title}:`, err);
        }
        
        // Remove wrapper
        document.body.removeChild(wrapper);
        
        // Small delay between downloads
        await new Promise(resolve => setTimeout(resolve, 500));
      }
      
      alert(`Готово! Генерирани са ${sections.length} PDF файла.`);
    }
    
    function setupPdfButtons() {
      if (typeof html2pdf === "undefined") return;
      document.querySelectorAll(".pdf-button").forEach(btn => {
        btn.addEventListener("click", () => {
          const targetId = btn.dataset.target;
          const section = document.getElementById(targetId);
          if (!section) return;
          if (typeof html2pdf === "undefined") {
            alert("PDF функционалността не е достъпна. Проверете интернет връзката.");
            return;
          }
          const clone = section.cloneNode(true);
          clone.style.display = "block";
          clone.style.maxHeight = "none";
          clone.style.overflow = "visible";
          clone.querySelectorAll(".calculator, .history, .calc-result, .pdf-button").forEach(el => el.remove());
          
          let hasWideTable = false;
          clone.querySelectorAll("table").forEach(tbl => {
            const colCount = tbl.querySelectorAll("th").length || tbl.querySelectorAll("tr:first-child td").length;
            if (colCount > 10) hasWideTable = true;
            
            tbl.style.pageBreakInside = "avoid";
            tbl.style.breakInside = "avoid";
            tbl.style.fontSize = "6pt";
            tbl.style.width = "100%";
            tbl.style.minWidth = "auto";
            tbl.style.maxWidth = "100%";
            tbl.style.tableLayout = "fixed";
            tbl.style.borderCollapse = "collapse";
            tbl.querySelectorAll("th, td").forEach(cell => {
              cell.style.padding = "3px 2px";
              cell.style.fontSize = "6pt";
              cell.style.minWidth = "auto";
              cell.style.maxWidth = "none";
              cell.style.whiteSpace = "nowrap";
              cell.style.overflow = "visible";
              cell.style.textOverflow = "clip";
            });
          });
          
          // Improved table-container handling - no wrapping needed
          clone.querySelectorAll(".table-container").forEach(container => {
            container.style.overflow = "visible";
            container.style.width = "100%";
            container.style.maxWidth = "100%";
            container.style.pageBreakInside = "avoid";
            container.style.breakInside = "avoid";
            container.style.boxSizing = "border-box";
            // Ensure the table inside also has proper styles
            const tbl = container.querySelector("table");
            if (tbl) {
              tbl.style.pageBreakInside = "avoid";
              tbl.style.breakInside = "avoid";
            }
          });
          
          // Ensure each major section starts on a new page
          clone.querySelectorAll("h3").forEach((h3, index) => {
            if (index === 0) {
              h3.style.pageBreakBefore = "auto";
            } else {
              h3.style.pageBreakBefore = "always";
              h3.style.breakBefore = "page";
            }
            h3.style.pageBreakAfter = "avoid";
            h3.style.breakAfter = "avoid";
          });
          
          clone.querySelectorAll("h3, .notes, .box-gallery, .examples-gallery").forEach(el => {
            el.style.pageBreakInside = "avoid";
            el.style.breakInside = "avoid";
          });
          
          const wrapper = document.createElement("div");
          wrapper.style.padding = "0";
          wrapper.style.background = "#fff";
          wrapper.style.width = hasWideTable ? "297mm" : "210mm";
          wrapper.style.margin = "0";
          wrapper.style.fontSize = "9pt";
          wrapper.style.boxSizing = "border-box";
          clone.style.padding = "3mm";
          clone.style.boxSizing = "border-box";
          clone.style.width = "100%";
          wrapper.appendChild(clone);
          document.body.appendChild(wrapper);
          
          const removeWrapper = () => {
            if (wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
          };
          
          html2pdf().set({
            margin: [0, 0, 0, 0],
            filename: `${targetId}.pdf`,
            html2canvas: { 
              scale: 2, 
              useCORS: true, 
              allowTaint: true,
              logging: false,
              letterRendering: true,
              width: hasWideTable ? 1123 : 794,
              height: hasWideTable ? 794 : 1123,
              windowWidth: hasWideTable ? 1123 : 794
            },
            jsPDF: { 
              unit: "mm", 
              format: "a4", 
              orientation: hasWideTable ? "landscape" : "portrait",
              compress: true
            },
            pagebreak: { 
              mode: ['avoid-all', 'css', 'legacy'],
              before: '.page-break-before',
              after: '.page-break-after',
              avoid: ['table', '.table-container', 'h3', '.notes', '.box-gallery', '.examples-gallery'],
              keepWithNext: ['h3']
            }
          }).from(wrapper).save().then(removeWrapper).catch(removeWrapper);
        });
      });
    }
    function closeInfo() {
      document.getElementById("infoScreen").style.display = "none";
      document.getElementById("loginScreen").style.display = "block";
      setTimeout(() => document.getElementById("username").focus(), 100);
    }
    async function downloadAllPagesAsImages() {
      // Pages ordered as they appear in the HTML file
      const pages = [
        { id: 'infoScreen', name: '01-Информация', isInfo: true },
        { id: 'rolo-mini-content', name: '02-Роло-Мини', isInfo: false },
        { id: 'dn-mini-content', name: '03-Ден-и-Нощ-Мини', isInfo: false },
        { id: 'elegans-content', name: '04-Роло-Елеганс-29mm', isInfo: false },
        { id: 'dn-elegans-content', name: '05-Ден-и-Нощ-Елеганс-29mm', isInfo: false },
        { id: 'rolo-plus-content', name: '06-Роло-Елеганс-45мм-кутия', isInfo: false },
        { id: 'dnn-plus-content', name: '07-Ден-и-Нощ-Елеганс-45мм-кутия', isInfo: false },
        { id: 'roletni-content', name: '08-Ролетни-щори', isInfo: false },
        { id: 'day-night-content', name: '09-Щора-Ден-и-Нощ', isInfo: false },
        { id: 'double-rolo-content', name: '10-Двойно-Роло', isInfo: false },
        { id: 'plise-content', name: '11-Плисе', isInfo: false },
        { id: 'perde-content', name: '12-Перде-щора', isInfo: false },
        { id: 'mosquito-content', name: '13-Комарници', isInfo: false },
        { id: 'kornizi-content', name: '14-Корнизи-и-механизми', isInfo: false },
        { id: 'dreveni-content', name: '15-Дървени-Щори', isInfo: false }
      ];
      
      const confirmDownload = confirm(`Ще се създаде ZIP файл с ${pages.length} PNG изображения. Искате ли да продължите?`);
      if (!confirmDownload) return;
      
      // Load html2canvas if needed
      if (typeof html2canvas === "undefined") {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
        document.head.appendChild(script);
        await new Promise((resolve, reject) => {
          script.onload = resolve;
          script.onerror = reject;
          setTimeout(reject, 10000);
        });
      }
      
      if (typeof JSZip === "undefined") {
        alert("ZIP функционалността не е достъпна. Проверете интернет връзката.");
        return;
      }
      
      alert(`Започва генериране на ${pages.length} PNG изображения. Моля изчакайте...`);
      
      const zip = new JSZip();
      const folder = zip.folder("Ценови-Листи-2026");
      
      for (let i = 0; i < pages.length; i++) {
        const page = pages[i];
        try {
          let pngBlob = null;
          
          if (page.isInfo) {
            pngBlob = await generateInfoPagePNG();
          } else {
            pngBlob = await generateProductPagePNG(page.id, page.name);
          }
          
          if (pngBlob) {
            const fileName = `${page.name}.png`;
            folder.file(fileName, pngBlob);
          }
        } catch (error) {
          console.error(`Error generating PNG for ${page.name}:`, error);
        }
      }
      
      // Generate ZIP file
      const zipBlob = await zip.generateAsync({ type: "blob" });
      const url = URL.createObjectURL(zipBlob);
      const link = document.createElement("a");
      link.download = "Ценови-Листи-2026.zip";
      link.href = url;
      link.click();
      URL.revokeObjectURL(url);
      
      alert(`Готово! ZIP файлът с ${pages.length} PNG изображения е свален.`);
    }
    
    async function generateInfoPagePNG() {
      const infoScreen = document.getElementById("infoScreen");
      if (!infoScreen) return null;
      
      // Load html2canvas if needed
      if (typeof html2canvas === "undefined") {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
        document.head.appendChild(script);
        await new Promise((resolve, reject) => {
          script.onload = resolve;
          script.onerror = reject;
          setTimeout(reject, 10000);
        });
      }
      
      // Clone and prepare for PDF
      const clone = infoScreen.cloneNode(true);
      clone.style.display = "block";
      clone.style.position = "relative";
      clone.style.width = "600px";
      clone.style.boxSizing = "border-box";
      
      // Remove buttons
      clone.querySelectorAll(".close-info, .info-button, .download-button").forEach(el => el.remove());
      
      // Ensure h2 is visible
      const h2 = clone.querySelector("h2");
      if (h2) {
        h2.style.background = "linear-gradient(90deg, #1A1A1A, #4A4A4A)";
        h2.style.webkitBackgroundClip = "text";
        h2.style.backgroundClip = "text";
        h2.style.color = "transparent";
      }
      
      // Create temporary container
      const container = document.createElement("div");
      container.style.padding = "40px 30px";
      container.style.background = "#FDFDFD";
      container.style.width = "600px";
      container.style.position = "absolute";
      container.style.left = "-9999px";
      container.style.top = "0";
      container.appendChild(clone);
      document.body.appendChild(container);
      
      // Wait for rendering and images to load
      await new Promise(resolve => setTimeout(resolve, 800));
      
      // Ensure images are loaded
      const images = container.querySelectorAll("img");
      await Promise.all(Array.from(images).map(img => {
        return new Promise((resolve) => {
          if (img.complete) {
            resolve();
          } else {
            img.onload = resolve;
            img.onerror = resolve;
            setTimeout(resolve, 2000);
          }
        });
      }));
      
      try {
        // Generate PNG image with html2canvas
        const canvas = await html2canvas(container, {
          scale: 2,
          useCORS: true,
          logging: false,
          backgroundColor: "#FDFDFD",
          width: container.offsetWidth,
          height: container.offsetHeight
        });
        
        // Convert canvas to PNG blob
        return new Promise((resolve, reject) => {
          canvas.toBlob((blob) => {
            document.body.removeChild(container);
            if (blob) {
              resolve(blob);
            } else {
              reject(new Error('Failed to generate PNG blob'));
            }
          }, 'image/png');
        });
      } catch (error) {
        document.body.removeChild(container);
        throw error;
      }
    }
    
    async function generateProductPagePNG(contentId, productName) {
      const section = document.getElementById(contentId);
      if (!section) return null;
      
      // Load html2canvas if needed
      if (typeof html2canvas === "undefined") {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
        document.head.appendChild(script);
        await new Promise((resolve, reject) => {
          script.onload = resolve;
          script.onerror = reject;
          setTimeout(reject, 10000);
        });
      }
      
      const containerWidth = 1200;
      const container = document.createElement("div");
      container.style.padding = "20px";
      container.style.background = "#fff";
      container.style.width = containerWidth + "px";
      container.style.position = "absolute";
      container.style.left = "-9999px";
      container.style.top = "0";
      container.style.boxSizing = "border-box";
      
      const title = document.createElement("h2");
      // Remove numbering prefix from display name (e.g., "02-Роло-Мини" -> "Роло Мини")
      const displayName = productName.replace(/^\d+-/, '').replace(/-/g, ' ');
      title.textContent = displayName;
      title.style.textAlign = "center";
      title.style.marginBottom = "20px";
      title.style.fontSize = "22px";
      title.style.fontWeight = "bold";
      container.appendChild(title);
      
      const clone = section.cloneNode(true);
      clone.style.display = "block";
      clone.style.maxHeight = "none";
      clone.style.overflow = "visible";
      clone.style.width = "100%";
      clone.querySelectorAll(".calculator, .history, .calc-result, .pdf-button, .download-button, .button-group").forEach(el => el.remove());
      
      clone.querySelectorAll("table").forEach(table => {
        table.style.width = "100%";
        table.style.maxWidth = "100%";
      });
      
      container.appendChild(clone);
      document.body.appendChild(container);
      
      // Wait for rendering and images to load
      await new Promise(resolve => setTimeout(resolve, 800));
      
      // Ensure images are loaded
      const images = container.querySelectorAll("img");
      await Promise.all(Array.from(images).map(img => {
        return new Promise((resolve) => {
          if (img.complete) {
            resolve();
          } else {
            img.onload = resolve;
            img.onerror = resolve;
            setTimeout(resolve, 2000);
          }
        });
      }));
      
      try {
        // Generate PNG image with html2canvas
        const canvas = await html2canvas(container, {
          scale: 2,
          useCORS: true,
          logging: false,
          backgroundColor: "#fff",
          width: container.offsetWidth,
          height: container.offsetHeight
        });
        
        // Convert canvas to PNG blob
        return new Promise((resolve, reject) => {
          canvas.toBlob((blob) => {
            document.body.removeChild(container);
            if (blob) {
              resolve(blob);
            } else {
              reject(new Error('Failed to generate PNG blob'));
            }
          }, 'image/png');
        });
      } catch (error) {
        document.body.removeChild(container);
        throw error;
      }
    }
    async function downloadInfoPageAsImage() {
      const infoScreen = document.getElementById("infoScreen");
      if (!infoScreen) {
        alert("Информационната страница не е намерена.");
        return;
      }
      
      // Use desktop width for consistent rendering
      const containerWidth = 600;
      
      // Create container
      const container = document.createElement("div");
      container.style.padding = "40px 30px";
      container.style.background = "#FDFDFD";
      container.style.border = "1px solid #E9ECEF";
      container.style.borderRadius = "16px";
      container.style.width = containerWidth + "px";
      container.style.minWidth = containerWidth + "px";
      container.style.maxWidth = containerWidth + "px";
      container.style.position = "absolute";
      container.style.left = "0";
      container.style.top = "0";
      container.style.zIndex = "9999";
      container.style.boxSizing = "border-box";
      container.style.textAlign = "center";
      
      // Clone info screen content
      const clone = infoScreen.cloneNode(true);
      clone.style.display = "block";
      clone.style.position = "relative";
      clone.style.width = "100%";
      clone.style.boxSizing = "border-box";
      
      // Remove close button and all action buttons (including download button)
      clone.querySelectorAll(".close-info, .info-button, .download-button").forEach(el => el.remove());
      
      // Ensure h2 title is visible and properly styled
      const h2 = clone.querySelector("h2");
      if (h2) {
        h2.style.display = "block";
        h2.style.visibility = "visible";
        h2.style.opacity = "1";
        // Force gradient to render properly for html2canvas
        h2.style.background = "linear-gradient(90deg, #1A1A1A, #4A4A4A)";
        h2.style.webkitBackgroundClip = "text";
        h2.style.backgroundClip = "text";
        h2.style.color = "transparent";
        h2.style.width = "100%";
        h2.style.textAlign = "center";
      }
      
      // Ensure all images are loaded
      const images = clone.querySelectorAll("img");
      await Promise.all(Array.from(images).map(img => {
        return new Promise((resolve) => {
          if (img.complete) {
            resolve();
          } else {
            img.onload = resolve;
            img.onerror = resolve;
            setTimeout(resolve, 2000);
          }
        });
      }));
      
      container.appendChild(clone);
      document.body.appendChild(container);
      
      // Wait for rendering
      await new Promise(resolve => setTimeout(resolve, 800));
      
      // Force reflow
      container.offsetHeight;
      
      try {
        // Load html2canvas if needed
        if (typeof html2canvas === "undefined") {
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
          document.head.appendChild(script);
          await new Promise((resolve, reject) => {
            script.onload = resolve;
            script.onerror = reject;
            setTimeout(reject, 10000);
          });
        }
        
        // Get actual dimensions
        const actualWidth = Math.max(container.scrollWidth, container.offsetWidth, containerWidth);
        const actualHeight = Math.max(container.scrollHeight, container.offsetHeight);
        
        // Create canvas
        const canvas = await html2canvas(container, {
          width: actualWidth,
          height: actualHeight,
          scale: 2,
          useCORS: true,
          logging: false,
          backgroundColor: "#FDFDFD"
        });
        
        // Convert to blob and download
        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.download = "Информация.png";
          link.href = url;
          link.click();
          URL.revokeObjectURL(url);
          
          // Clean up
          document.body.removeChild(container);
        }, "image/png");
      } catch (error) {
        console.error("Error generating image:", error);
        alert("Грешка при генериране на изображение. Моля опитайте отново.");
        document.body.removeChild(container);
      }
    }
    function toggleAccordion(header) {
      const content = header.nextElementSibling;
      const isOpen = content.classList.contains("open");
      document.querySelectorAll(".accordion-content").forEach(c => c.classList.remove("open"));
      if (!isOpen) content.classList.add("open");
      if (!isOpen && header && header.textContent && header.textContent.indexOf("Перде") !== -1) {
        var sel = document.getElementById("perde-series");
        if (sel && typeof renderPerdeColorOptions === "function") renderPerdeColorOptions(sel.value || "");
      }
    }
    function login() {
      const user = document.getElementById("username").value.trim().toLowerCase();
      const pass = document.getElementById("password").value;
      if (users[user] && users[user] === pass) {
        currentUser = user; // Запазва текущия потребител
        document.getElementById("loginScreen").style.display = "none";
        const priceList = document.getElementById("priceList");
        priceList.style.display = "flex";
        priceList.style.flexDirection = "column";
        priceList.style.alignItems = "center";
        priceList.style.gap = "30px";
        initTables();
        updatePerdePriceTable(); // Актуализира таблицата с цени за Перде-Щора
        var perdeSel = document.getElementById("perde-series");
        if (perdeSel && typeof renderPerdeColorOptions === "function") renderPerdeColorOptions(perdeSel.value || "");
        updateRoletniPriceTable();
        updateDayNightPriceTable();
        updateDoubleRoloPriceTable();
        updatePlisePriceTable();
      } else {
        document.getElementById("errorMsg").style.display = "block";
        setTimeout(() => document.getElementById("errorMsg").style.display = "none", 3000);
      }
    }
    function handleLoginEnter(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        login();
      }
    }
    function generateTable(tableId, priceTable, title) {
      const table = document.getElementById(tableId);
      const heights = Object.keys(priceTable).map(Number).sort((a,b)=>a-b);
      const widths = Object.keys(priceTable[heights[0]]).map(Number).sort((a,b)=>a-b);
      let html = `<tr><th colspan="${widths.length+1}" style="background:#1A1A1A;color:white;">${title}</th></tr>`;
      html += `<tr><th>Височина \\ Ширина</th>${widths.map(w=>`<th>${w}</th>`).join('')}</tr>`;
      heights.forEach(h => {
        const row = widths.map(w => priceTable[h][w].toFixed(2) + '€');
        html += `<tr><th>${h}</th>${row.map(c => `<td>${c}</td>`).join('')}</tr>`;
      });
      table.innerHTML = html;
    }
    function initTables() {
      generateTable("rolo-mini-table", miniPriceTable, "Роло Мини");
      generateTable("dn-mini-table", dnPriceTable, "Ден и Нощ Мини");
      generateTable("elegans-table", elegansPriceTable, "Роло Елеганс 29mm ");
      generateTable("dn-elegans-table", dnElegansPriceTable, "Ден и Нощ Елеганс 29mm ");
      generateTable("rolo-plus-table", roloPlusPriceTable, "Роло Елеганс+ (45мм кутия)");
      generateTable("dnn-plus-table", dnnPlusPriceTable, "Ден и Нощ Елеганс+ (45мм кутия)");
      generateSingleWhiteTable();
      generateDoubleWhiteTable();
      generateSingleColorTable();
      generateDoubleColorTable();
      generateSingleFlanderTable();
      generateDoubleFlanderTable();
      generateKorniziTable();
    }
    function generateKorniziTable() {
      const table = document.getElementById("kornizi-table");
      if (!table) return;
      let html = "<tr><th>Наименование</th><th>Мярка</th><th>Цена (€)</th><th>Бележки</th><th></th></tr>";
      korniziPriceList.forEach(function(row, i) {
        const euroStr = row.onRequest ? "По запитване" : (typeof row.euro === "number" ? row.euro.toFixed(2) : row.euro);
        html += `<tr><td>${row.name}</td><td>${row.measure}</td><td>${euroStr}</td><td><input type="text" id="kornizi-notes-${i}" class="kornizi-notes-input" placeholder="Номер на плат / бележки"></td><td><button type="button" class="kornizi-add-btn" onclick="addKorniziRowToCart(${i})" title="Добави в кошницата">+</button></td></tr>`;
      });
      table.innerHTML = html;
    }
    function addKorniziRowToCart(index) {
      const row = korniziPriceList[index];
      if (!row) return;
      const price = row.onRequest ? 0 : (typeof row.euro === "number" ? row.euro : parseFloat(String(row.euro).replace(",", ".")));
      const notesEl = document.getElementById("kornizi-notes-" + index);
      const notes = notesEl ? notesEl.value.trim() : "";
      const details = { "Мярка": row.measure, "Цена": row.onRequest ? "По запитване" : (price.toFixed(2) + " €") };
      if (notes) details["Бележки"] = notes;
      addToCart(row.name, price, details);
    }
    function generateSingleWhiteTable() {
      const table = document.getElementById("single-white-table");
      const heights = ["0-70","71-80","81-90","91-100","101-110","111-120","121-130","131-140","141-150","151-160","161-170","171-180","181-190","191-200","201-210","211-220","221-230"];
      const widths = ["0-50","51-60","61-70","71-80","81-90","91-100","101-110","111-120","121-130","131-140","141-150","151-160","161-170","171-180","181-190"];
      let html = `<tr><th colspan="${widths.length+1}" style="background:#1A1A1A;color:white;">Еднокрилен – Бял профил</th></tr>`;
      html += `<tr><th>Височина \\ Ширина</th>${widths.map(w=>`<th>${w}</th>`).join('')}</tr>`;
      heights.forEach((h, hi) => {
        if (hi < singleWhite.length) {
          const row = singleWhite[hi].map(p => p.replace(',', '.') + '€');
          html += `<tr><th>${h}</th>${row.map(c => `<td>${c}</td>`).join('')}</tr>`;
        }
      });
      table.innerHTML = html;
    }
    function generateDoubleWhiteTable() {
      const table = document.getElementById("double-white-table");
      const heights = ["141-150","151-160","161-170","171-180","181-190","191-200","201-210","211-220","221-230","231-240","241-250"];
      const widths = ["111-120","121-130","131-140","141-150","151-160","161-170","171-180","181-190","191-200","201-210","211-220","221-230","231-240","241-250","251-260"];
      let html = `<tr><th colspan="${widths.length+1}" style="background:#1A1A1A;color:white;">Двукрилен – Бял профил</th></tr>`;
      html += `<tr><th>Височина \\ Ширина</th>${widths.map(w=>`<th>${w}</th>`).join('')}</tr>`;
      heights.forEach((h, hi) => {
        if (hi < doubleWhite.length) {
          const row = doubleWhite[hi].map(p => p.replace(',', '.') + '€');
          html += `<tr><th>${h}</th>${row.map(c => `<td>${c}</td>`).join('')}</tr>`;
        }
      });
      table.innerHTML = html;
    }
    function generateSingleColorTable() {
      const table = document.getElementById("single-color-table");
      const heights = ["0-70","71-80","81-90","91-100","101-110","111-120","121-130","131-140","141-150","151-160","161-170","171-180","181-190","191-200","201-210","211-220","221-230"];
      const widths = ["0-50","51-60","61-70","71-80","81-90","91-100","101-110","111-120","121-130","131-140","141-150","151-160","161-170","171-180","181-190"];
      let html = `<tr><th colspan="${widths.length+1}" style="background:#1A1A1A;color:white;">Еднокрилен – Цветни</th></tr>`;
      html += `<tr><th>Височина \\ Ширина</th>${widths.map(w=>`<th>${w}</th>`).join('')}</tr>`;
      heights.forEach((h, hi) => {
        if (hi < singleColor.length) {
          const row = singleColor[hi].map(p => p + '€');
          html += `<tr><th>${h}</th>${row.map(c => `<td>${c}</td>`).join('')}</tr>`;
        }
      });
      table.innerHTML = html;
    }
    function generateDoubleColorTable() {
      const table = document.getElementById("double-color-table");
      const heights = ["141-150","151-160","161-170","171-180","181-190","191-200","201-210","211-220","221-230","231-240","241-250"];
      const widths = ["111-120","121-130","131-140","141-150","151-160","161-170","171-180","181-190","191-200","201-210","211-220","221-230","231-240","241-250","251-260"];
      let html = `<tr><th colspan="${widths.length+1}" style="background:#1A1A1A;color:white;">Двукрилен – Цветни</th></tr>`;
      html += `<tr><th>Височина \\ Ширина</th>${widths.map(w=>`<th>${w}</th>`).join('')}</tr>`;
      heights.forEach((h, hi) => {
        if (hi < doubleColor.length) {
          const row = doubleColor[hi].map(p => p + '€');
          html += `<tr><th>${h}</th>${row.map(c => `<td>${c}</td>`).join('')}</tr>`;
        }
      });
      table.innerHTML = html;
    }
    function generateSingleFlanderTable() {
      const table = document.getElementById("single-flander-table");
      const heights = ["0-70","71-80","81-90","91-100","101-110","111-120","121-130","131-140","141-150","151-160","161-170","171-180","181-190","191-200","201-210","211-220","221-230"];
      const widths = ["0-50","51-60","61-70","71-80","81-90","91-100","101-110","111-120","121-130","131-140","141-150","151-160","161-170","171-180","181-190"];
      let html = `<tr><th colspan="${widths.length+1}" style="background:#1A1A1A;color:white;">Еднокрилен – Фладер</th></tr>`;
      html += `<tr><th>Височина \\ Ширина</th>${widths.map(w=>`<th>${w}</th>`).join('')}</tr>`;
      heights.forEach((h, hi) => {
        if (hi < singleFlander.length) {
          const row = singleFlander[hi].map(p => p + '€');
          html += `<tr><th>${h}</th>${row.map(c => `<td>${c}</td>`).join('')}</tr>`;
        }
      });
      table.innerHTML = html;
    }
    function generateDoubleFlanderTable() {
      const table = document.getElementById("double-flander-table");
      const heights = ["141-150","151-160","161-170","171-180","181-190","191-200","201-210","211-220","221-230","231-240","241-250"];
      const widths = ["111-120","121-130","131-140","141-150","151-160","161-170","171-180","181-190","191-200","201-210","211-220","221-230","231-240","241-250","251-260"];
      let html = `<tr><th colspan="${widths.length+1}" style="background:#1A1A1A;color:white;">Двукрилен – Фладер</th></tr>`;
      html += `<tr><th>Височина \\ Ширина</th>${widths.map(w=>`<th>${w}</th>`).join('')}</tr>`;
      heights.forEach((h, hi) => {
        if (hi < doubleFlander.length) {
          const row = doubleFlander[hi].map(p => p + '€');
          html += `<tr><th>${h}</th>${row.map(c => `<td>${c}</td>`).join('')}</tr>`;
        }
      });
      table.innerHTML = html;
    }
    const modal = document.getElementById("fullscreen-modal");
    const modalImg = document.getElementById("fullscreen-content");
    const closeModal = document.querySelector(".close-modal");
    document.querySelectorAll("img").forEach(img => {
      if (!img.getAttribute("crossorigin")) {
        img.setAttribute("crossorigin", "anonymous");
      }
      img.addEventListener("click", () => {
        modal.style.display = "flex";
        modalImg.src = img.src;
      });
    });
    closeModal.addEventListener("click", () => {
      modal.style.display = "none";
    });
    modal.addEventListener("click", (e) => {
      if (e.target === modal) modal.style.display = "none";
    });
    window.onload = () => {
      document.getElementById("infoScreen").style.display = "block";
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("priceList").style.display = "none";
      
      // Автоматично избиране на затворена кутия при избор на облечена кутия за ролетни щори
      const roletniBoxFabric = document.querySelector(".roletni-extra[value='box_fabric']");
      const roletniBoxClosed = document.querySelector(".roletni-extra[value='box_closed']");
      if (roletniBoxFabric && roletniBoxClosed) {
        roletniBoxFabric.addEventListener("change", function() {
          if (this.checked) {
            roletniBoxClosed.checked = true;
          }
        });
      }
      
      // Взаимно изключване на кутиите за ден и нощ
      const dayNightBoxFabric = document.querySelector(".day-night-extra[value='box_fabric']");
      const dayNightBoxClosed = document.querySelector(".day-night-extra[value='box_closed']");
      if (dayNightBoxFabric && dayNightBoxClosed) {
        dayNightBoxFabric.addEventListener("change", function() {
          if (this.checked) {
            dayNightBoxClosed.checked = false;
          }
        });
      }
      
      // Автоматично избиране на затворена кутия при избор на облечена кутия за двойно роло
      const doubleRoloBoxFabric = document.querySelector(".double-rolo-extra[value='box_fabric']");
      const doubleRoloBoxClosed = document.querySelector(".double-rolo-extra[value='box_closed']");
      if (doubleRoloBoxFabric && doubleRoloBoxClosed) {
        doubleRoloBoxFabric.addEventListener("change", function() {
          if (this.checked) {
            doubleRoloBoxClosed.checked = true;
          }
        });
      }
      
      // Real-time ламели visualization for перде щора
      const perdeWidthInput = document.getElementById("perde-width");
      const perdeControlSelect = document.getElementById("perde-control");
      const lameliVisualizationDiv = document.getElementById("perde-lameli-visualization");
      function updateLameliPreview() {
        if (!perdeWidthInput) return;
        const width = parseFloat(perdeWidthInput.value);
        const controlValue = perdeControlSelect ? perdeControlSelect.value || "standard" : "standard";
        if (!isNaN(width) && width > 0) {
          const lameliCount = calculateLameliCount(width, controlValue);
          visualizeLameli(lameliCount, width);
        } else if (lameliVisualizationDiv) {
          lameliVisualizationDiv.style.display = "none";
          resetLamelaColors();
        }
      }
      if (perdeWidthInput) {
        perdeWidthInput.addEventListener("input", updateLameliPreview);
      }
      if (perdeControlSelect) {
        perdeControlSelect.addEventListener("change", updateLameliPreview);
      }
      const symmetryToggle = document.getElementById("perde-symmetry-toggle");
      if (symmetryToggle) {
        symmetryEnabled = symmetryToggle.checked;
        symmetryToggle.addEventListener("change", () => {
          symmetryEnabled = symmetryToggle.checked;
        });
      }
      const perdeSeriesSelect = document.getElementById("perde-series");
      if (perdeSeriesSelect) {
        const updateColorOptions = () => renderPerdeColorOptions(perdeSeriesSelect.value || "");
        perdeSeriesSelect.addEventListener("change", updateColorOptions);
        updateColorOptions();
      }
    };
    // Auto-focus username field when user starts typing on login screen
    document.addEventListener("keydown", (e) => {
      const loginScreen = document.getElementById("loginScreen");
      const usernameField = document.getElementById("username");
      if (loginScreen && loginScreen.style.display !== "none" && 
          document.activeElement !== usernameField && 
          document.activeElement !== document.getElementById("password") &&
          e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
        usernameField.focus();
      }
    });
  </script>
</body>
</html>
